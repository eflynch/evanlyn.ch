{"version":3,"sources":["dist/konopas.js"],"names":["KonOpas","set","this","id","lc","tag_categories","default_duration","time_show_am_pm","abbrev_00_minutes","always_show_participants","max_items_per_page","non_ascii_people","people_per_screen","use_server","log_messages","cache_refresh_interval_mins","views","i","_log","i18n","txt","key","data","bind","translate_html","alert","Array","prototype","indexOf","filter","map","Date","now","window","store","Store","stars","Stars","server","Server","item","Item","info","Info","onhashchange","set_view","pl","document","getElementsByClassName","length","addEventListener","popup_open","_el","refresh_cache","msg","lvl","console","error","warn","log","getElementById","_new_elem","tag","cl","text","hide","e","createElement","className","textContent","style","display","G","en","n","c","d","k","Error","o","isNaN","v","p","l","other","s","Program","weekday_n","0","1","2","3","4","5","6","weekday_short_n","month_n","7","8","9","10","11","time_diff","true","search_example","no_ko_id","old_browser","item_not_found","item_tags","tags","track","type","star_export_this","star_export_share","star_import_this","star_import_diff","one","star_import_bad","star_set","add_n","discard_n","star_add","star_export_link","star_hint","star_no_memory","FFcookies","IOSprivate","filter_sum_id","filter_sum","undefined","day_link","hidden_link","server_cmd_fail","post_author","ical_login","ical_link","ical_hint","ical_make","login_why","set_program","list","opt","program","Prog","set_people","people","Part","view","location","hash","substr","tabs","classList","remove","add","show","body","t_interval","cache","applicationCache","status","UPDATEREADY","onclick","reload","UNCACHED","setInterval","update","lu","lu_time","self","cache_manifest","parentNode","getAttribute","protocol","x","XMLHttpRequest","onload","getResponseHeader","show_updated","open","send","toggle_collapse","span","getElementsByTagName","pretty_time_diff","title","toLocaleString","ev","event","target","tmp","innerHTML","list_click","scrollIntoView","navigator","userAgent","match","scroll","top","day","day_txt","t_el","s_el","times","onscroll","scroll_time","show_extra","html","a","konopas","el","ID","it","forEach","t","cat","tgt","split","shift","join","link","push","T","hash_encode","name","desc","extra","cal","ics","uuid","starttime","date","time","endtime","addEvent","room","download","stopPropagation","appendChild","new","_loc_str","loc","slice","mins","pretty_time","time_sum","frame","star","org","organizer","isspecial","cloneNode","show_list","ls","_day_link","day_links","N","day_lengths","D","parse_date","getDay","scrollTo","_now","frag","createDocumentFragment","prev_date","prev_time","_list_item","show_all","hide_ended","t1","n_hidden","pretty_date","t0","setAttribute","n_listed","days","day_now","data_date","insertBefore","firstChild","LS","removeChild","expand_all","items","exp_txt","star_els","toggle","prog_view","d_s","d_n","d_click","li","dt","focus_day","d_set","div","len","ul","show_filter_sum","is_link","test","tagName","toLowerCase","href","S","st_len","scroll_top","pageYOffset","offsetTop","day0","day1","sortname","replace","make_ascii","sort","b","localeCompare","set_ranges","bin_size","_range_set","nr","startChar","charAt","name_range","participant","update_view","_firstletter","toUpperCase","fn","ln","ranges","ends","start","n_bins","Math","round","n_up","n_down","String","fromCharCode","charCodeAt","nl_type","name_in_range","n0","range","show_one","p_name","clean_name","links","img","clean_links","onLine","bio","prog","lp","p_id","ll","querySelectorAll","cmd","some","get","contains","hash_decode","pa","r","trim","Function","oThis","TypeError","aArgs","call","arguments","fToBind","fNOP","fBound","apply","concat","toLocaleDateString","_orig_toLocaleDateString","locale","options","w","getDate","m","getMonth","year","getFullYear","normalize","str","toString","norm_map","A","AA","AE","AO","AU","AV","AY","B","C","DZ","Dz","E","F","H","I","J","K","L","LJ","Lj","M","NJ","Nj","O","OI","OO","OU","P","Q","R","TZ","U","V","VY","W","X","Y","Z","aa","ae","ao","au","av","ay","dz","f","g","h","hv","j","lj","nj","oi","ou","oo","q","tz","u","vy","y","z","elemCtrProto","HTMLElement","Element","objCtr","Object","strTrim","arrIndexOf","DOMEx","message","code","DOMException","checkTokenAndGetIndex","token","ClassList","elem","trimmedClasses","classes","_updateClassName","classListProto","classListGetter","index","splice","defineProperty","classListPropDesc","enumerable","configurable","ex","number","__defineGetter__","_sort","Number","valueOf","pf","filter_change","nextElementSibling","sf","onsubmit","oninput","onreset","set_filters","init_filters","pt","preventDefault","excl","RegExp","get_filters","hash_only","filters","area","query","h_set","tag_re","hasOwnProperty","silent","history","replaceState","value","popups","day-sidebar","day-narrow","_d","_txt","_ul","_li","par","labels","regexp","_compare","af","_a","_b","bb","_ul2","prefix","root","hiddenFilterCategories","_fill","promote","exclude","re","min_count","keys","categories","list_in","list_out","filter_el","areas","loc_level","t_s","set_category","d_re","d_d","short","long","fs","cb","unset","id_only","TITLE","disabled","ALL","tag_str","area_str","query_str","TAG","_filter","prev","glob_to_re","every","host","el_id","err_el_id","localStorage","VarStore","connected","getItem","ical","prog_data","prog_server_mtime","err_el","disconnect","exec","decodeURIComponent","logout","url","CMD","onmessage","origin","JSON","parse","cb_ok","prog_mtime","mtime","add_prog","add_star","set_prog","star_list","show_ical_link","p_el","A_TAG","i_el","encodeURIComponent","script","done","src","async","onerror","onreadystatechange","readyState","setItem","write","stringify","parseInt","cb_fail","cb_info","email","jsErrLog","cb_token","cb_login","cb_my_prog","sync","cb_my_votes","cb_pub_data","cb_show_comments","cb_ical_link","sessionStorage","read","QUOTA_EXCEEDED_ERR","floor","new_data","local_mod","redraw","server_add","server_rm","set_raw","set_len","stars_len","limit","WHY","SERVER","set_link","arrays_equal","THIS","SHORT","link_to_short_url","QR","link_to_qr_code","n_same","array_overlap","n_new","n_bad","PREV","NEW","SAME","BAD","URL","el_set","el_add","node","attr","pat","re_re","terms","removeItem","span_parts","ok","photo","fb","encodeURI","twitter","tw","which","src_el","pop_el","nextSibling","wrap_el","pop_title","getComputedStyle","getPropertyValue","pre0","_pretty_time","h12","getHours","getMinutes","abs","T_UNIT","T_PAST","day_str","weekday","month","t0_str","m_str"],"mappings":"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","file":"dist/konopas.min.js","sourcesContent":["/**\n * KonOpas -- http://konopas.org/ & https://github.com/eemeli/konopas\n * Copyright (c) 2013-2015 by Eemeli Aro <eemeli@gmail.com>\n * \n * Permission to use, copy, modify, and/or distribute this software for any\n * purpose with or without fee is hereby granted, provided that the above\n * copyright notice and this permission notice appear in all copies.\n * \n * The software is provided \"as is\" and the author disclaims all warranties\n * with regard to this software including all implied warranties of\n * merchantability and fitness. In no event shall the author be liable for\n * any special, direct, indirect, or consequential damages or any damages\n * whatsoever resulting from loss of use, data or profits, whether in an\n * action of contract, negligence or other tortious action, arising out of\n * or in connection with the use or performance of this software.\n * @license\n */\n\"use strict\";\n(function(G){G['i18n']={lc:{\"en\":function(n){return n===1?\"one\":\"other\"}},\nc:function(d,k){if(!d)throw new Error(\"MessageFormat: Data required for '\"+k+\"'.\")},\nn:function(d,k,o){if(isNaN(d[k]))throw new Error(\"MessageFormat: '\"+k+\"' isn't a number.\");return d[k]-(o||0)},\nv:function(d,k){i18n.c(d,k);return d[k]},\np:function(d,k,o,l,p){i18n.c(d,k);return d[k] in p?p[d[k]]:(k=i18n.lc[l](d[k]-o),k in p?p[k]:p.other)},\ns:function(d,k,p){i18n.c(d,k);return d[k] in p?p[d[k]]:p.other}}\ni18n[\"en\"]={\n\"Program\":function(d){return \"Programme\"},\n\"weekday_n\":function(d){return i18n.p(d,\"N\",0,\"en\",{\"0\":\"Sunday\",\"1\":\"Monday\",\"2\":\"Tuesday\",\"3\":\"Wednesday\",\"4\":\"Thursday\",\"5\":\"Friday\",\"6\":\"Saturday\",\"other\":\"???\"})},\n\"weekday_short_n\":function(d){return i18n.p(d,\"N\",0,\"en\",{\"0\":\"Sun\",\"1\":\"Mon\",\"2\":\"Tue\",\"3\":\"Wed\",\"4\":\"Thu\",\"5\":\"Fri\",\"6\":\"Sat\",\"other\":\"???\"})},\n\"month_n\":function(d){return i18n.p(d,\"N\",0,\"en\",{\"0\":\"January\",\"1\":\"February\",\"2\":\"March\",\"3\":\"April\",\"4\":\"May\",\"5\":\"June\",\"6\":\"July\",\"7\":\"August\",\"8\":\"September\",\"9\":\"October\",\"10\":\"November\",\"11\":\"December\",\"other\":\"???\"})},\n\"time_diff\":function(d){return i18n.v(d,\"T\")+\" \"+i18n.p(d,\"T_UNIT\",0,\"en\",{\"0\":\"seconds\",\"1\":\"minutes\",\"2\":\"hours\",\"3\":\"days\",\"4\":\"weeks\",\"5\":\"months\",\"6\":\"years\",\"other\":\"???\"})+\" \"+i18n.s(d,\"T_PAST\",{\"true\":\"ago\",\"other\":\"from now\"})},\n\"search_example\":function(d){return \"For example, you could try <b>\"+i18n.v(d,\"X\")+\"</b>\"},\n\"no_ko_id\":function(d){return \"No ID set! Please assign konopas_set.id a unique identifier.\"},\n\"old_browser\":function(d){return \"Unfortunately, your browser doesn't support some of the Javascript features required by KonOpas. To use, please try a different browser.\"},\n\"item_not_found\":function(d){return \"Programme id <b>\"+i18n.v(d,\"ID\")+\"</b> not found!\"},\n\"item_tags\":function(d){return i18n.s(d,\"T\",{\"tags\":\"Tags\",\"track\":\"Track\",\"type\":\"Type\",\"other\":i18n.v(d,\"T\")})},\n\"star_export_this\":function(d){return \"Your current selection is encoded in <a href=\\\"\"+i18n.v(d,\"THIS\")+\"\\\" target=\\\"_blank\\\">this page's URL</a>, which you may open elsewhere to share your selection.\"},\n\"star_export_share\":function(d){return \"For easier sharing, you can also generate a <a href=\\\"\"+i18n.v(d,\"SHORT\")+\"\\\">shorter link</a> or a <a href=\\\"\"+i18n.v(d,\"QR\")+\"\\\">QR code</a>.\"},\n\"star_import_this\":function(d){return \"Your previously selected items are shown with a highlighted interior, while those imported via <a href=\\\"\"+i18n.v(d,\"THIS\")+\"\\\">this link</a> have a highlighted border.\"},\n\"star_import_diff\":function(d){return \"Your previous selection \"+i18n.p(d,\"PREV\",0,\"en\",{\"0\":\"was empty\",\"one\":\"had one item\",\"other\":\"had \"+i18n.n(d,\"PREV\")+\" items\"})+\", and the imported selection has \"+i18n.p(d,\"NEW\",0,\"en\",{\"0\":\"no new items\",\"one\":\"one new item\",\"other\":i18n.n(d,\"NEW\")+\" new items\"})+\" \"+i18n.p(d,\"SAME\",0,\"en\",{\"0\":\"\",\"one\":\"and one which was already selected\",\"other\":\"and \"+i18n.n(d,\"SAME\")+\" which were already selected\"})+\".\"},\n\"star_import_bad\":function(d){return i18n.p(d,\"BAD\",0,\"en\",{\"0\":\"\",\"one\":\"One of the imported items had an invalid ID.\",\"other\":i18n.n(d,\"BAD\")+\" of the imported items had invalid IDs.\"})},\n\"star_set\":function(d){return \"Set my selection to the imported selection\"},\n\"add_n\":function(d){return \"add \"+i18n.v(d,\"N\")},\n\"discard_n\":function(d){return \"discard \"+i18n.v(d,\"N\")},\n\"star_add\":function(d){return \"Add the \"+i18n.p(d,\"N\",0,\"en\",{\"one\":\"new item\",\"other\":i18n.n(d,\"N\")+\" new items\"})+\" to my selection\"},\n\"star_export_link\":function(d){return \"<a href=\\\"\"+i18n.v(d,\"URL\")+\"\\\">Export selection</a> (\"+i18n.p(d,\"N\",0,\"en\",{\"one\":\"one item\",\"other\":i18n.n(d,\"N\")+\" items\"})+\")\"},\n\"star_hint\":function(d){return \"To \\\"star\\\" a programme item, click on the square next to it. Your selections will be remembered, and shown in this view. You currently don't have any programme items selected, so this list is empty.\"},\n\"star_no_memory\":function(d){return i18n.s(d,\"WHY\",{\"FFcookies\":\"It looks like you're using a Firefox browser with cookies disabled, so \",\"IOSprivate\":\"It looks like you're using an iOS or Safari browser in private mode, so \",\"other\":\"For some reason,\"})+\" your <a href=\\\"http://en.wikipedia.org/wiki/Web_storage\\\">localStorage</a> is not enabled, and therefore your selection will not be remembered between sessions. \"+i18n.s(d,\"SERVER\",{\"true\":\"Please <span class=\\\"js-link\\\" onclick=\\\"var e=_el('login-popup-link');if(e)e.click();\\\">login</span> to enable persistent storage.\",\"other\":\"\"})},\n\"filter_sum_id\":function(d){return \"Listing \"+i18n.p(d,\"N\",0,\"en\",{\"one\":\"one item: \"+i18n.v(d,\"TITLE\"),\"other\":i18n.n(d,\"N\")+\" items with id \"+i18n.v(d,\"ID\")})},\n\"filter_sum\":function(d){return \"Listing \"+i18n.p(d,\"N\",0,\"en\",{\"one\":\"one\",\"other\":i18n.v(d,\"ALL\")+\" \"+i18n.n(d,\"N\")})+\" \"+i18n.s(d,\"LIVE\",{\"undefined\":\"\",\"other\":\"current and future\"})+\" \"+i18n.v(d,\"TAG\")+\" \"+i18n.p(d,\"N\",0,\"en\",{\"one\":\"item\",\"other\":\"items\"})+\" \"+i18n.s(d,\"DAY\",{\"undefined\":\"\",\"other\":\"on \"+i18n.v(d,\"DAY\")+\" \"+i18n.s(d,\"TIME\",{\"undefined\":\"\",\"other\":\"after \"+i18n.v(d,\"TIME\")})})+\" \"+i18n.s(d,\"AREA\",{\"undefined\":\"\",\"other\":\"in \"+i18n.v(d,\"AREA\")})+\" \"+i18n.s(d,\"Q\",{\"undefined\":\"\",\"other\":\"matching the query \"+i18n.v(d,\"Q\")})},\n\"day_link\":function(d){return \"Show \"+i18n.v(d,\"N\")+\" matching items from \"+i18n.p(d,\"D\",0,\"en\",{\"0\":\"Sunday\",\"1\":\"Monday\",\"2\":\"Tuesday\",\"3\":\"Wednesday\",\"4\":\"Thursday\",\"5\":\"Friday\",\"6\":\"Saturday\",\"other\":\"???\"})},\n\"hidden_link\":function(d){return \"Show \"+i18n.v(d,\"N\")+\" more matching items with an end time before \"+i18n.v(d,\"T\")+\" on \"+i18n.p(d,\"D\",0,\"en\",{\"0\":\"Sunday\",\"1\":\"Monday\",\"2\":\"Tuesday\",\"3\":\"Wednesday\",\"4\":\"Thursday\",\"5\":\"Friday\",\"6\":\"Saturday\",\"other\":\"???\"})},\n\"server_cmd_fail\":function(d){return \"The command \\\"\"+i18n.v(d,\"CMD\")+\"\\\" failed.\"},\n\"post_author\":function(d){return i18n.v(d,\"N\")+\" posted…\"},\n\"ical_login\":function(d){return \"To make your selection available in external calendars, please <span class=\\\"js-link\\\" onclick=\\\"var e=_el('login-popup-link');if(e)e.click();\\\">login</span>.\"},\n\"ical_link\":function(d){return \"Your selection is available as an iCal (.ics) calendar at:\"},\n\"ical_hint\":function(d){return \"Note that changes you make in this guide may not show up immediately in your external calendar software.\"},\n\"ical_make\":function(d){return \"To view your selection in your calendar app, you may also <br class=\\\"wide-only\\\">\"+i18n.v(d,\"A_TAG\")+\"make it available</a> in iCal (.ics) calendar format\"},\n\"login_why\":function(d){return \"Once you've verified your e-mail address, you'll be able to sync your data between different clients (including external calendars). After signing in, no information will be transmitted to these external services.\"}}\n})(this);\nfunction KonOpas(set) {\n\tthis.id = '';\n\tthis.lc = 'en';\n\tthis.tag_categories = false;\n\tthis.default_duration = 60;\n\tthis.time_show_am_pm = false;\n\tthis.abbrev_00_minutes = true; // only for am/pm time\n\tthis.always_show_participants = false;\n\tthis.max_items_per_page = 200;\n\tthis.non_ascii_people = false; // setting true enables correct but slower sort\n\tthis.people_per_screen = 100;\n\tthis.use_server = false;\n\tthis.log_messages = true;\n\tthis.cache_refresh_interval_mins = 60;\n\tthis.views = [ \"star\", \"prog\", \"part\", \"info\" ];\n\tif (typeof set == 'object') for (var i in set) this[i] = set[i];\n\n\tif (!this.log_messages) _log = function(){};\n\tif (i18n[this.lc]) {\n\t\ti18n.txt = function(key, data){ return key in i18n[this.lc] ? i18n[this.lc][key](data) : key; }.bind(this);\n\t\ti18n.translate_html(i18n[this.lc], 'data-txt');\n\t} else alert('Locale \"' + this.lc + '\" not found.');\n\tif (!this.id) alert(i18n.txt('no_ko_id'));\n\tif (!Array.prototype.indexOf || !Array.prototype.filter || !Array.prototype.map\n\t\t|| !Date.now || !('localStorage' in window)) alert(i18n.txt('old_browser'));\n\n\tthis.store = new KonOpas.Store(this.id);\n\tthis.stars = new KonOpas.Stars(this.id);\n\tthis.server = this.use_server && KonOpas.Server && new KonOpas.Server(this.id, this.stars);\n\tthis.item = new KonOpas.Item();\n\tthis.info = new KonOpas.Info();\n\twindow.onhashchange = this.set_view.bind(this);\n\tvar pl = document.getElementsByClassName('popup-link');\n\tfor (var i = 0; i < pl.length; ++i) pl[i].addEventListener('click', KonOpas.popup_open);\n\tif (_el('refresh')) window.addEventListener('load', this.refresh_cache.bind(this), false);\n}\n\nKonOpas.prototype.set_program = function(list, opt) { this.program = new KonOpas.Prog(list, opt); }\nKonOpas.prototype.set_people = function(list) { this.people = new KonOpas.Part(list, this); }\n\nKonOpas.prototype.set_view = function() {\n\tvar view = window.location.hash.substr(1, 4), tabs = _el('tabs');\n\tif (!this.program || !this.program.list.length) {\n\t\tview = 'info';\n\t\ttabs.style.display = 'none';\n\t\tthis.info.show();\n\t\tif (this.server) this.server.error('Programme loading failed!');\n\t} else {\n\t\ttabs.style.display = 'block';\n\t\tif (!this.people || !this.people.list.length) {\n\t\t\ttabs.classList.add('no-people');\n\t\t\tif (view == 'part') view = '';\n\t\t} else {\n\t\t\ttabs.classList.remove('no-people');\n\t\t}\n\t\tswitch (view) {\n\t\t\tcase 'part': this.people.show();  break;\n\t\t\tcase 'star': this.stars.show();   break;\n\t\t\tcase 'info': this.info.show();    break;\n\t\t\tdefault:     this.program.show(); view = 'prog';\n\t\t}\n\t}\n\tfor (var i = 0; i < this.views.length; ++i) {\n\t\tdocument.body.classList[view == this.views[i] ? 'add' : 'remove'](this.views[i]);\n\t}\n\tif (_el('load_disable')) _el('load_disable').style.display = 'none';\n}\n\nKonOpas.prototype.refresh_cache = function() {\n\tvar t_interval = this.cache_refresh_interval_mins * 60000,\n\t    cache = window.applicationCache;\n\tif (!t_interval || (t_interval < 0)) return;\n\tcache.addEventListener('updateready', function() {\n\t\tif (cache.status == cache.UPDATEREADY) {\n\t\t\t_el('refresh').classList.add('enabled');\n\t\t\t_el('refresh').onclick = function() { window.location.reload(); };\n\t\t}\n\t}, false);\n\tif (cache.status != cache.UNCACHED) {\n\t\twindow.setInterval(function() { cache.update(); }, t_interval);\n\t}\n}\nKonOpas.Info = function() {\n\tthis.lu = _el('last-updated');\n\tthis.lu_time = 0;\n\tvar self = this, cache_manifest = document.body.parentNode.getAttribute('manifest');\n\tif (this.lu && cache_manifest && ((location.protocol == 'http:') || (location.protocol == 'https:'))) {\n\t\tvar x = new XMLHttpRequest();\n\t\tx.onload = function() {\n\t\t\tself.lu_time = new Date(this.getResponseHeader(\"Last-Modified\"));\n\t\t\tself.show_updated();\n\t\t};\n\t\tx.open('GET', cache_manifest, true);\n\t\tx.send();\n\t}\n\tvar cl = _el('info_view').getElementsByClassName('collapse');\n\tfor (var i = 0; i < cl.length; ++i) {\n\t\tcl[i].onclick = KonOpas.toggle_collapse;\n\t}\n}\n\nKonOpas.Info.prototype.show_updated = function() {\n\tif (!this.lu || !this.lu_time) return;\n\tvar span = this.lu.getElementsByTagName('span')[0];\n\tspan.textContent = KonOpas.pretty_time_diff(this.lu_time);\n\tspan.title = this.lu_time.toLocaleString();\n\tspan.onclick = function(ev) {\n\t\tvar self = (ev || window.event).target;\n\t\tvar tmp = self.title;\n\t\tself.title = self.textContent;\n\t\tself.textContent = tmp;\n\t};\n\tthis.lu.style.display = 'inline';\n}\n\nKonOpas.Info.prototype.show = function() {\n\t_el(\"prog_ls\").innerHTML = \"\";\n\tthis.show_updated();\n}\n\nKonOpas.Item = function() {\n\t_el('prog_ls').onclick = KonOpas.Item.list_click;\n\tif (_el('scroll_link')) {\n\t\t_el('scroll_link').onclick = function() { _el('top').scrollIntoView(); return false; };\n\t\tif (window.navigator && navigator.userAgent.match(/Android [12]/)) {\n\t\t\t_el('time').style.display = 'none';\n\t\t\t_el('scroll').style.display = 'none';\n\t\t} else {\n\t\t\tthis.scroll = {\n\t\t\t\t'i': 0, 'top': 0,\n\t\t\t\t'day': '', 'day_txt': '',\n\t\t\t\t't_el': _el('time'), 's_el': _el('scroll'),\n\t\t\t\t'times': document.getElementsByClassName('new_time')\n\t\t\t};\n\t\t\twindow.onscroll = this.scroll_time.bind(this);\n\t\t}\n\t}\n}\n\nKonOpas.Item.show_extra = function(item, id) {\n\tfunction _tags(it) {\n\t\tif (!it.tags || !it.tags.length) return '';\n\t\tvar o = {};\n\t\tit.tags.forEach(function(t) {\n\t\t\tvar cat = 'tags';\n\t\t\tvar tgt = KonOpas.Prog.hash({'tag': t});\n\t\t\tvar a = t.split(':');\n\t\t\tif (a.length > 1) { cat = a.shift(); t = a.join(':'); }\n\t\t\tvar link = '<a href=\"' + tgt + '\">' + t + '</a>'\n\t\t\tif (o[cat]) o[cat].push(link);\n\t\t\telse o[cat] = [link];\n\t\t});\n\t\tvar a = []; for (var k in o) a.push(i18n.txt('item_tags', {'T':k}) + ': ' + o[k].join(', '));\n\t\treturn '<div class=\"discreet\">' + a.join('<br>') + '</div>\\n';\n\t}\n\tfunction _people(it) {\n\t\tif (!it.people || !it.people.length) return '';\n\t\tvar a = it.people.map(!konopas.people || !konopas.people.list.length\n\t\t\t? function(p) { return p.name; }\n\t\t\t: function(p) { return \"<a href=\\\"#part/\" + KonOpas.hash_encode(p.id) + \"\\\">\" + p.name + \"</a>\"; }\n\t\t);\n\t\treturn '<div class=\"item-people\">' + a.join(', ') + '</div>\\n';\n\t}\n\n\tif (_el(\"e\" + id)) return;\n\tvar html = \"\";\n\tvar a = konopas.program.list.filter(function(el) { return el.id == id; });\n\tif (a.length < 1) html = i18n.txt('item_not_found', {'ID':id});\n\telse {\n\t\thtml = _tags(a[0]) + _people(a[0]);\n\t\tif (a[0].desc) html += \"<p>\" + a[0].desc;\n\t\thtml += '<a href=\"#prog/id:' + a[0].id + '\" class=\"permalink\" title=\"' + i18n.txt('Permalink') + '\"></a>';\n\t}\n\tvar extra = _new_elem('div', 'extra');\n\textra.id = 'e' + id;\n\textra.innerHTML = html;\n\n\tvar cal = _new_elem('div', 'callink');\n\tcal.onclick = function(e){\n\t\tvar c = window.ics(uuid());\n\t\tvar starttime = new Date(a[0].date + \" \" + a[0].time + \" GMT+1\");\n\t\tvar endtime = new Date(a[0].date + \"T\" + a[0].time + \" GMT+1\");\n\t\tc.addEvent(a[0].title, a[0].desc, a[0].room, starttime, endtime);\n\t\tc.download(\"coy13-event\");\n\t\te.stopPropagation();\n\t}\n\textra.appendChild(cal);\n\titem.appendChild(extra);\n}\n\nKonOpas.Item.new = function(it) {\n// This function is horrible... why is it..\n\n// namespace.functionName = function(data){\n    \n//     var state = new State();\n\n//     namespace.functionName = function(data){\n//         mutate(state); \t\t\t// mutate must be idempotent\n//         return copy(state);\n//     }\n//     return functionName(data);\n// }\n\n// instead of...\n\n// namespace.functionName = function(data){\n//     var state = new State();\n//     mutate(state) \t\t\t// mutate must be idempotent\n//     return state;\n// }\n\n\tfunction _loc_str(it) {\n\t\tvar s = '';\n\t\tif (it.loc && it.loc.length) {\n\t\t\ts = it.loc[0];\n\t\t\tif (it.loc.length > 1) s += ' (' + it.loc.slice(1).join(', ') + ')';\n\t\t}\n\t\tif (it.mins && (it.mins != konopas.default_duration)) {\n\t\t\tif (s) s += ', ';\n\t\t\ts += KonOpas.pretty_time(it.time, konopas) + ' - ' + KonOpas.pretty_time(KonOpas.time_sum(it.time, it.mins), konopas);\n\t\t}\n\t\treturn s;\n\t}\n\tvar frame = _new_elem('div', 'item_frame');\n\tvar star  = frame.appendChild(_new_elem('div', 'item_star'));\n\tvar item  = frame.appendChild(_new_elem('div', 'item'));\n\tvar title = item.appendChild(_new_elem('div', 'title'));\n\t// Hack to add Organizer element\n\tvar org = item.appendChild(_new_elem('div', 'organizer'))\n\tvar loc   = item.appendChild(_new_elem('div', 'loc'));\n\n\t\n\n\tKonOpas.Item.new = function(it) {\n\t\tstar.id = 's' + it.id;\n\t\titem.id = 'p' + it.id;\n\t\ttitle.textContent = it.title;\n\t\tloc.textContent = _loc_str(it);\n\t\torg.textContent = it.organizer;\n\n\t\t// You have to assign it both ways because we are modifying\n\t\t// a single node that is closured in each time we call this\n\t\t// function before cloning it... This is horrible.\n\t\tif (it.isspecial){\n\t\t\tframe.className = \"item_frame special\";\n\t\t} else {\n\t\t\tframe.className = \"item_frame\";\n\t\t}\n\t\treturn frame.cloneNode(true);\n\t};\n\treturn KonOpas.Item.new(it);\n}\n\nKonOpas.Item.show_list = function(ls, opt) {\n\tvar\t_now = Date.now(),\n\t\tday_lengths = {}, day_links = {},\n\t\tfrag = document.createDocumentFragment(),\n\t\tprev_date = '', prev_time = '',\n\t\t_list_item = function(p) {\n\t\t\tif (opt.day && p.date) {\n\t\t\t\tday_lengths[p.date] = (day_lengths[p.date] || 0) + 1;\n\t\t\t}\n\t\t\tif (opt.show_all || !opt.day || !p.date || (p.date == opt.day)) {\n\t\t\t\tif (this.hide_ended && p.t1 && (p.t1 < opt.now)) { ++opt.n_hidden; return; }\n\t\t\t\tif (p.date != prev_date) {\n\t\t\t\t\tprev_date = p.date;\n\t\t\t\t\tprev_time = '';\n\t\t\t\t\tfrag.appendChild(_new_elem('div', 'new_day', KonOpas.pretty_date(p.t0 || p.date, konopas))).id = 'dt_' + p.date;\n\t\t\t\t}\n\t\t\t\tif (p.time != prev_time) {\n\t\t\t\t\tprev_time = p.time;\n\t\t\t\t\tfrag.appendChild(document.createElement('hr'));\n\t\t\t\t\tfrag.appendChild(_new_elem('div', 'new_time', KonOpas.pretty_time(p.t0 || p.time, konopas)))\n\t\t\t\t\t\t.setAttribute('data-day', p.date);\n\t\t\t\t}\n\t\t\t\tfrag.appendChild(KonOpas.Item.new(p));\n\t\t\t\t++opt.n_listed;\n\t\t\t}\n\t\t};\n\tif (!opt) opt = {};\n\topt.show_all = (ls.length <= konopas.max_items_per_page);\n\topt.n_hidden = 0; opt.n_listed = 0;\n\topt.now = new Date(_now + 10*60000 - _now % (10*60000));\n\tif (!opt.day || !konopas.program.days[opt.day]) {\n\t\tvar day_now = KonOpas.data_date(opt.now);\n\t\tif (konopas.program.days[day_now]) opt.day = day_now;\n\t\telse { opt.day = ''; for (opt.day in konopas.program.days) break; }\n\t}\n\tif (ls.length > (opt.id ? 1 : 0)) {\n\t\tfrag.appendChild(_new_elem('div', 'item_expander', '» '))\n\t\t\t.appendChild(_new_elem('a', 'js-link', i18n.txt('Expand all')))\n\t\t\t.id = 'item_expander_link';\n\t}\n\tls.forEach(_list_item, {hide_ended:opt.hide_ended});\n\tif (!opt.n_listed && opt.n_hidden) {\n\t\tday_lengths = {};\n\t\topt.n_hidden = 0; opt.n_listed = 0;\n\t\tprev_date = ''; prev_time = '';\n\t\tls.forEach(_list_item, {hide_ended:false});\n\t}\n\n\tfunction _day_link(t) {\n\t\tvar d = day_links[t],\n\t\t    txt = i18n.txt('day_link', {\n\t\t\t\t'N': day_lengths[d],\n\t\t\t\t'D': KonOpas.parse_date(d).getDay()\n\t\t\t}),\n\t\t    link = _new_elem('a', 'day-link js-link', txt);\n\t\tlink.id = t + '_day_link';\n\t\tlink.onclick = function() {\n\t\t\tif (t == 'next') window.scrollTo(0, 0);\n\t\t\topt.day = d;\n\t\t\tKonOpas.Item.show_list(ls, opt);\n\t\t};\n\t\treturn link;\n\t}\n\tfunction _hidden_link() {\n\t\tvar\ttxt = i18n.txt('hidden_link', {\n\t\t\t\t'N': opt.n_hidden,\n\t\t\t\t'T': KonOpas.pretty_time(opt.now, konopas),\n\t\t\t\t'D': opt.now.getDay()\n\t\t\t}),\n\t\t    link = _new_elem('a', 'day-link js-link', txt);\n\t\tlink.id = 'hidden_day_link';\n\t\tlink.onclick = function() {\n\t\t\topt.hide_ended = false;\n\t\t\topt.day = KonOpas.data_date(opt.now);\n\t\t\tKonOpas.Item.show_list(ls, opt);\n\t\t};\n\t\treturn link;\n\t}\n\tif (opt.day && !opt.show_all) for (var d in day_lengths) if (d in konopas.program.days) {\n\t\tif (d < opt.day) day_links['prev'] = d;\n\t\telse if ((d > opt.day) && !day_links['next']) day_links['next'] = d;\n\t}\n\tif (day_links['prev'] && !opt.n_hidden) frag.insertBefore(_day_link('prev'), frag.firstChild);\n\tif (day_links['next']) frag.appendChild(_day_link('next'));\n\tif (opt.n_hidden) frag.insertBefore(_hidden_link(), frag.firstChild);\n\n\tvar LS = _el('prog_ls');\n\twhile (LS.firstChild) LS.removeChild(LS.firstChild);\n\tLS.appendChild(frag);\n\n\tvar expand_all = _el(\"item_expander_link\");\n\tif (expand_all) expand_all.onclick = function() {\n\t\tvar items = LS.getElementsByClassName(\"item\");\n\t\tvar exp_txt = i18n.txt('Expand all');\n\t\tif (expand_all.textContent == exp_txt) {\n\t\t\tfor (var i = 0, l = items.length; i < l; ++i) {\n\t\t\t\titems[i].parentNode.classList.add(\"expanded\");\n\t\t\t\tKonOpas.Item.show_extra(items[i], items[i].id.substr(1));\n\t\t\t}\n\t\t\texpand_all.textContent = i18n.txt('Collapse all');\n\t\t} else {\n\t\t\tfor (var i = 0, l = items.length; i < l; ++i) {\n\t\t\t\titems[i].parentNode.classList.remove(\"expanded\");\n\t\t\t}\n\t\t\texpand_all.textContent = exp_txt;\n\t\t}\n\t};\n\n\tvar star_els = LS.getElementsByClassName(\"item_star\");\n\tfor (var i = 0, l = star_els.length; i < l; ++i) {\n\t\tstar_els[i].onclick = function() { konopas.stars.toggle(this, this.id.substr(1)); return false; };\n\t}\n\n\tkonopas.stars.list().forEach(function(s){\n\t\tvar el = _el('s' + s);\n\t\tif (el) el.classList.add('has_star');\n\t});\n\n\tif (opt.id) {\n\t\tvar it = document.getElementById('p' + opt.id);\n\t\tif (it) {\n\t\t\tit.parentNode.classList.add(\"expanded\");\n\t\t\tKonOpas.Item.show_extra(it, opt.id);\n\t\t\tif (ls.length > 1) it.scrollIntoView();\n\t\t}\n\t}\n\n\tif (opt.prog_view) {\n\t\tvar d_s = _el('day-sidebar'), d_n = _el('day-narrow'),\n\t\t    d_click = function(ev) {\n\t\t\t\tvar li = (ev || window.event).target,\n\t\t\t\t    d = li.getAttribute('data-day');\n\t\t\t\tif (!d) return;\n\t\t\t\topt.day = d;\n\t\t\t\tif (opt.show_all) {\n\t\t\t\t\tvar dt = _el('dt_' + d);\n\t\t\t\t\tif (dt) {\n\t\t\t\t\t\tdt.scrollIntoView();\n\t\t\t\t\t\tKonOpas.Prog.focus_day(d);\n\t\t\t\t\t} else if (d < KonOpas.data_date(opt.now)) {\n\t\t\t\t\t\topt.hide_ended = false;\n\t\t\t\t\t\tKonOpas.Item.show_list(ls, opt);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\topt.hide_ended = true;\n\t\t\t\t\tKonOpas.Item.show_list(ls, opt);\n\t\t\t\t}\n\t\t\t},\n\t\t    d_set = function(div, len) {\n\t\t\t\tvar ul = document.createElement('ul');\n\t\t\t\tul.className = 'day-list';\n\t\t\t\tul.onclick = d_click;\n\t\t\t\tfor (var d in konopas.program.days) {\n\t\t\t\t\tvar li = document.createElement('li');\n\t\t\t\t\tli.textContent = konopas.program.days[d][len] + ' (' + (day_lengths[d] || 0) + ')';\n\t\t\t\t\tli.setAttribute('data-day', d);\n\t\t\t\t\tif (d == opt.day) li.className = 'selected';\n\t\t\t\t\tul.appendChild(li);\n\t\t\t\t}\n\t\t\t\tdiv.innerHTML = '';\n\t\t\t\tdiv.appendChild(ul);\n\t\t\t};\n\t\tif (d_s) d_set(d_s, 'long');\n\t\tif (d_n) d_set(d_n, 'short');\n\t\tkonopas.program.show_filter_sum(ls, opt);\n\t}\n\n\tkonopas.item.scroll.i = 0;\n\twindow.onscroll && window.onscroll();\n}\n\nKonOpas.Item.list_click = function(ev) {\n\tvar el = (ev || window.event).target,\n\t    is_link = false;\n\twhile (el && !/\\bitem(_|$)/.test(el.className)) {\n\t\tif (el.id == 'prog_ls') return;\n\t\tif ((el.tagName.toLowerCase() == 'a') && el.href) is_link = true;\n\t\tel = el.parentNode;\n\t\tif (!el) return;\n\t}\n\tif (el && el.id && (el.id[0] == 'p') && !is_link) {\n\t\tif (el.parentNode.classList.toggle(\"expanded\")) {\n\t\t\tKonOpas.Item.show_extra(el, el.id.substr(1));\n\t\t}\n\t}\n}\n\nKonOpas.Item.prototype.scroll_time = function() {\n\tvar S = this.scroll,\n\t\tst_len = S.times.length,\n\t    scroll_top = window.pageYOffset + 20; // to have more time for change behind new_time\n\tif (!S.t_el || !st_len) return;\n\tif (scroll_top < S.times[0].offsetTop) {\n\t\tS.i = 0;\n\t\tS.top = S.times[0].offsetTop;\n\t\tS.t_el.style.display = 'none';\n\t\tvar day0 = S.times[0].getAttribute('data-day');\n\t\tif (day0 != S.day) {\n\t\t\tKonOpas.Prog.focus_day(day0);\n\t\t\tS.day = day0;\n\t\t}\n\t} else {\n\t\tvar i = S.top ? S.i : 1;\n\t\tif (i >= st_len) i = st_len - 1;\n\t\tif (scroll_top > S.times[i].offsetTop) {\n\t\t\twhile ((i < st_len) && (scroll_top > S.times[i].offsetTop)) ++i;\n\t\t\t--i;\n\t\t} else {\n\t\t\twhile ((i >= 0) && (scroll_top < S.times[i].offsetTop)) --i;\n\t\t}\n\t\tif (i < 0) i = 0;\n\t\tif ((i == 0) || (i != S.i)) {\n\t\t\tS.i = i;\n\t\t\tS.top = S.times[i].offsetTop;\n\t\t\tvar day0 = S.times[i].getAttribute('data-day'),\n\t\t\t    day1 = ((i + 1 < st_len) && S.times[i+1].getAttribute('data-day')) || day0;\n\t\t\tS.t_el.textContent = konopas.program.days[day0]['short'] + '\\n' + S.times[i].textContent;\n\t\t\tS.t_el.style.display = 'block';\n\t\t\tif (day1 != S.day) {\n\t\t\t\tKonOpas.Prog.focus_day(day1);\n\t\t\t\tS.day = day1;\n\t\t\t}\n\t\t}\n\t}\n\tif (S.s_el) S.s_el.style.display = S.t_el.style.display;\n}\nKonOpas.Part = function(list, opt) {\n\tthis.list = list || [];\n\tthis.list.forEach(function(p){\n\t\tp.sortname = ((p.name[1] || '') + '  ' + p.name[0]).toLowerCase().replace(/^[\\s/()]+/, '');\n\t\tif (!opt.non_ascii_people) p.sortname = p.sortname.make_ascii();\n\t});\n\tthis.list.sort(opt.non_ascii_people\n\t\t? function(a, b) { return a.sortname.localeCompare(b.sortname, opt.lc); }\n\t\t: function(a, b) { return a.sortname < b.sortname ? -1 : a.sortname > b.sortname; });\n\tthis.set_ranges(opt.people_per_screen || 0);\n}\n\nKonOpas.Part.prototype.set_ranges = function(bin_size) {\n\tvar\tself = this,\n\t\t_ranges = function(a, bin_size) {\n\t\t\tvar\tends = [], start = ' ',\n\t\t\t\tn_bins = bin_size ? Math.round(a.length / bin_size) : 0,\n\t\t\t\t_prev_matches = function(a, i) { return (i > 0) && (a[i - 1] == a[i]); },\n\t\t\t\t_next_matches = function(a, i) { return (i < a.length - 1) && (a[i + 1] == a[i]); };\n\t\t\tfor (var i = 1; i <= n_bins; ++i) {\n\t\t\t\tvar e = Math.round(i * a.length / n_bins), n_up = 0, n_down = 0;\n\t\t\t\tif (e < 0) e = 0;\n\t\t\t\tif (e >= a.length) e = a.length - 1;\n\t\t\t\twhile (_next_matches(a, e + n_up)) ++n_up;\n\t\t\t\tif (n_up) while (_prev_matches(a, e - n_down)) ++n_down;\n\t\t\t\tif (n_up <= n_down) e += n_up;\n\t\t\t\telse if (e > n_down) e -= n_down + 1;\n\t\t\t\tif (!ends.length || (ends[ends.length - 1] != a[e])) ends.push(a[e]);\n\t\t\t}\n\t\t\tends.forEach(function(e, i){\n\t\t\t\tif (e > start) ends[i] = start + e;\n\t\t\t\tif (e >= start) start = String.fromCharCode(e.charCodeAt(0) + 1);\n\t\t\t});\n\t\t\treturn ends;\n\t\t},\n\t\t_range_set = function(div, nr) {\n\t\t\tvar ul = _new_elem('ul', 'name-list');\n\t\t\tnr.forEach(function(n){\n\t\t\t\tvar startChar = n.charAt(0);\n\t\t\t\tif (startChar == ' ') startChar = 'A';\n\t\t\t\tvar li = _new_elem('li', '', startChar);\n\t\t\t\tif (n.length > 1) li.textContent += ' - ' + n.charAt(1);\n\t\t\t\tli.setAttribute('data-range', n);\n\t\t\t\tul.appendChild(li);\n\t\t\t});\n\t\t\tdiv.appendChild(ul);\n\t\t\tdiv.onclick = (function(ev) {\n\t\t\t\tvar name_range = (ev || window.event).target.getAttribute('data-range');\n\t\t\t\tif (name_range) {\n\t\t\t\t\tkonopas.store.set('part', { 'name_range': name_range, 'participant': '' });\n\t\t\t\t\twindow.location.hash = '#part';\n\t\t\t\t\tthis.update_view(name_range, '');\n\t\t\t\t}\n\t\t\t}).bind(self);\n\t\t},\n\t\t_firstletter = function(name) {\n\t\t\treturn name.replace(/^[\\s/(]+/, '').charAt(0).toUpperCase()\n\t\t}\n\n\tvar fn = [], ln = [];\n\n\tthis.list.forEach(function(p){\n\t\tif (p.name && p.name.length) {\n\t\t\tfn.push(_firstletter(p.name[0]));\n\t\t\tif (p.name.length >= 2) ln.push(_firstletter(p.name[1]) || _firstletter(p.name[0]));\n\t\t}\n\t});\n\n\tthis.ranges = _ranges(ln.length ? ln : fn, bin_size);\n\t_range_set(_el('part-sidebar'), this.ranges);\n\t_range_set(_el('part-narrow'), this.ranges);\n\n\tvar nl_type =  fn.length &&  ln.length ? ''\n\t            :  fn.length && !ln.length ? 'fn-only'\n\t            : !fn.length &&  ln.length ? 'ln-only'\n\t            : 'error';\n\tif (nl_type) _el('part_names').classList.add(nl_type);\n}\n\nKonOpas.Part.name_in_range = function(n0, range) {\n\tswitch (range.length) {\n\t\tcase 1:  return (n0 == range[0]);\n\t\tcase 2:  return konopas.non_ascii_people\n\t\t\t? (n0.localeCompare(range[0], konopas.lc) >= 0) && (n0.localeCompare(range[1], konopas.lc) <= 0)\n\t\t\t: ((n0 >= range[0]) && (n0 <= range[1]));\n\t\tdefault: return (range.indexOf(n0) >= 0);\n\t}\n}\n\nKonOpas.Part.prototype.show_one = function(i) {\n\tvar p = this.list[i],\n\t    p_name = KonOpas.clean_name(p, false),\n\t    links = '',\n\t    img = '',\n\t    pl = KonOpas.clean_links(p);\n\tif (pl) {\n\t\tlinks += '<dl class=\"linklist\">';\n\t\tfor (var type in pl) if (type != 'img') {\n\t\t\tvar tgt = pl[type].tgt, txt = pl[type].txt || tgt;\n\t\t\tlinks += '<dt>' + type + ':<dd>' + '<a href=\"' + tgt + '\">' + txt + '</a>';\n\t\t}\n\t\tlinks += '</dl>';\n\t\tif (pl.img && navigator.onLine) {\n\t\t\timg = '<a class=\"part_img\" href=\"' + pl.img.tgt + '\"><img src=\"' + pl.img.tgt + '\" alt=\"' + i18n.txt('Photo') + ': ' + p_name + '\"></a>';\n\t\t}\n\t}\n\t_el(\"part_names\").innerHTML = '';\n\t_el(\"part_info\").innerHTML =\n\t\t  '<h2 id=\"part_title\">' + p_name + '</h2>'\n\t\t+ ((p.bio || img) ? ('<p>' + img + p.bio) : '')\n\t\t+ links;\n\tKonOpas.Item.show_list(konopas.program.list.filter(function(it) { return p.prog.indexOf(it.id) >= 0; }));\n\t_el(\"top\").scrollIntoView();\n}\n\nKonOpas.Part.prototype.show_list = function(name_range) {\n\tvar lp = !name_range ? this.list : this.list.filter(function(p) {\n\t\tvar n0 = p.sortname[0].toUpperCase();\n\t\treturn KonOpas.Part.name_in_range(n0, name_range);\n\t});\n\t_el('part_names').innerHTML = lp.map(function(p) {\n\t\treturn '<li><a href=\"#part/' + KonOpas.hash_encode(p.id) + '\">' + KonOpas.clean_name(p, true) + '</a></li>';\n\t}).join('');\n\t_el('part_info').innerHTML = '';\n\t_el('prog_ls').innerHTML = '';\n}\n\nKonOpas.Part.prototype.update_view = function(name_range, participant) {\n\tvar\tp_id = participant.substr(1),\n\t\tll = document.querySelectorAll('.name-list > li');\n\tif (!name_range) name_range = this.ranges && this.ranges[0] || '';\n\tfor (var i = 0; i < ll.length; ++i) {\n\t\tvar cmd = (ll[i].getAttribute('data-range') == name_range) ? 'add' : 'remove';\n\t\tll[i].classList[cmd]('selected');\n\t}\n\tif (!p_id || !this.list.some(function(p,i){\n\t\tif (p.id == p_id) { this.show_one(i); return true; }\n\t}, this)) {\n\t\tparticipant = '';\n\t\tthis.show_list(name_range);\n\t}\n\tkonopas.store.set('part', { 'name_range': name_range, 'participant': participant });\n}\n\nKonOpas.Part.prototype.show = function(hash) {\n\tif (!this.list.length) { window.location.hash = ''; return; }\n\tvar store = konopas.store.get('part') || {},\n\t    name_range = store.name_range || '',\n\t    participant = !document.body.classList.contains('part') && store.participant || '',\n\t\thash = window.location.hash.substr(6);\n\tif (hash) {\n\t\tvar p_id = KonOpas.hash_decode(hash);\n\t\tvar pa = this.list.filter(function(p) { return p.id == p_id; });\n\t\tif (pa.length) {\n\t\t\tparticipant = 'p' + pa[0].id;\n\t\t\tvar n0 = pa[0].sortname[0].toUpperCase();\n\t\t\tif (!n0 || !this.ranges || !this.ranges.some(function(r){\n\t\t\t\tif (KonOpas.Part.name_in_range(n0, r)) { name_range = r; return true; }\n\t\t\t})) name_range = '';\n\t\t} else {\n\t\t\twindow.location.hash = '#part';\n\t\t\treturn;\n\t\t}\n\t} else if (participant) {\n\t\twindow.location.hash = '#part/' + participant.substr(1);\n\t\treturn;\n\t}\n\tthis.update_view(name_range, participant);\n}\nif (!String.prototype.trim) {\n\tString.prototype.trim = function () {\n\t\treturn this.replace(/^\\s+|\\s+$/g, '');\n\t};\n}\n\n\nif (!Function.prototype.bind) {\n  Function.prototype.bind = function (oThis) {\n    if (typeof this !== \"function\") {\n      // closest thing possible to the ECMAScript 5\n      // internal IsCallable function\n      throw new TypeError(\"Function.prototype.bind - what is trying to be bound is not callable\");\n    }\n    var aArgs = Array.prototype.slice.call(arguments, 1),\n        fToBind = this,\n        fNOP = function () {},\n        fBound = function () {\n          return fToBind.apply(this instanceof fNOP && oThis\n                 ? this\n                 : oThis,\n                 aArgs.concat(Array.prototype.slice.call(arguments)));\n        };\n    fNOP.prototype = this.prototype;\n    fBound.prototype = new fNOP();\n    return fBound;\n  };\n}\n\n\nif ((function(){\n\ttry { new Date().toLocaleDateString(\"i\"); }\n\tcatch (e) { return e.name !== \"RangeError\"; }\n\treturn true;\n})()) {\n\tDate.prototype._orig_toLocaleDateString = Date.prototype.toLocaleDateString;\n\tDate.prototype.toLocaleDateString = function(locale, options) {\n\t\tif (!arguments.length || (typeof i18n == 'undefined')) return this._orig_toLocaleDateString();\n\t\tvar i = function(key, data){ return key in i18n[locale] ? i18n[locale][key](data) : key; },\n\t\t    w = i('weekday_n', { 'N': this.getDay() }),\n\t\t    d = this.getDate(),\n\t\t    m = i('month_n', { 'N': this.getMonth() }),\n\t\t    s = w + ', ' + d + ' ' + m;\n\t\tif (options && options.year) s += ' ' + this.getFullYear();\n\t\treturn s;\n\t};\n}\n\n\nString.prototype.make_ascii = String.prototype.normalize\n\t? function() {\n\t\treturn this.normalize('NFKD').replace(/[^\\x00-\\x7F]/g, '');\n\t}\n\t: function() {\n\t\tvar str = this.toString();\n\t\tif (/^[\\x00-\\x7F]*$/.test(str)) return str;\n\t\t// map from http://web.archive.org/web/20120918093154/http://lehelk.com/2011/05/06/script-to-remove-diacritics/\n\t\tvar norm_map = {\n\t\t\t'A': /[\\u0041\\u24B6\\uFF21\\u00C0\\u00C1\\u00C2\\u1EA6\\u1EA4\\u1EAA\\u1EA8\\u00C3\\u0100\\u0102\\u1EB0\\u1EAE\\u1EB4\\u1EB2\\u0226\\u01E0\\u00C4\\u01DE\\u1EA2\\u00C5\\u01FA\\u01CD\\u0200\\u0202\\u1EA0\\u1EAC\\u1EB6\\u1E00\\u0104\\u023A\\u2C6F]/g,\n\t\t\t'AA':/[\\uA732]/g,\n\t\t\t'AE':/[\\u00C6\\u01FC\\u01E2]/g,\n\t\t\t'AO':/[\\uA734]/g,\n\t\t\t'AU':/[\\uA736]/g,\n\t\t\t'AV':/[\\uA738\\uA73A]/g,\n\t\t\t'AY':/[\\uA73C]/g,\n\t\t\t'B': /[\\u0042\\u24B7\\uFF22\\u1E02\\u1E04\\u1E06\\u0243\\u0182\\u0181]/g,\n\t\t\t'C': /[\\u0043\\u24B8\\uFF23\\u0106\\u0108\\u010A\\u010C\\u00C7\\u1E08\\u0187\\u023B\\uA73E]/g,\n\t\t\t'D': /[\\u0044\\u24B9\\uFF24\\u1E0A\\u010E\\u1E0C\\u1E10\\u1E12\\u1E0E\\u0110\\u018B\\u018A\\u0189\\uA779]/g,\n\t\t\t'DZ':/[\\u01F1\\u01C4]/g,\n\t\t\t'Dz':/[\\u01F2\\u01C5]/g,\n\t\t\t'E': /[\\u0045\\u24BA\\uFF25\\u00C8\\u00C9\\u00CA\\u1EC0\\u1EBE\\u1EC4\\u1EC2\\u1EBC\\u0112\\u1E14\\u1E16\\u0114\\u0116\\u00CB\\u1EBA\\u011A\\u0204\\u0206\\u1EB8\\u1EC6\\u0228\\u1E1C\\u0118\\u1E18\\u1E1A\\u0190\\u018E]/g,\n\t\t\t'F': /[\\u0046\\u24BB\\uFF26\\u1E1E\\u0191\\uA77B]/g,\n\t\t\t'G': /[\\u0047\\u24BC\\uFF27\\u01F4\\u011C\\u1E20\\u011E\\u0120\\u01E6\\u0122\\u01E4\\u0193\\uA7A0\\uA77D\\uA77E]/g,\n\t\t\t'H': /[\\u0048\\u24BD\\uFF28\\u0124\\u1E22\\u1E26\\u021E\\u1E24\\u1E28\\u1E2A\\u0126\\u2C67\\u2C75\\uA78D]/g,\n\t\t\t'I': /[\\u0049\\u24BE\\uFF29\\u00CC\\u00CD\\u00CE\\u0128\\u012A\\u012C\\u0130\\u00CF\\u1E2E\\u1EC8\\u01CF\\u0208\\u020A\\u1ECA\\u012E\\u1E2C\\u0197]/g,\n\t\t\t'J': /[\\u004A\\u24BF\\uFF2A\\u0134\\u0248]/g,\n\t\t\t'K': /[\\u004B\\u24C0\\uFF2B\\u1E30\\u01E8\\u1E32\\u0136\\u1E34\\u0198\\u2C69\\uA740\\uA742\\uA744\\uA7A2]/g,\n\t\t\t'L': /[\\u004C\\u24C1\\uFF2C\\u013F\\u0139\\u013D\\u1E36\\u1E38\\u013B\\u1E3C\\u1E3A\\u0141\\u023D\\u2C62\\u2C60\\uA748\\uA746\\uA780]/g,\n\t\t\t'LJ':/[\\u01C7]/g,\n\t\t\t'Lj':/[\\u01C8]/g,\n\t\t\t'M': /[\\u004D\\u24C2\\uFF2D\\u1E3E\\u1E40\\u1E42\\u2C6E\\u019C]/g,\n\t\t\t'N': /[\\u004E\\u24C3\\uFF2E\\u01F8\\u0143\\u00D1\\u1E44\\u0147\\u1E46\\u0145\\u1E4A\\u1E48\\u0220\\u019D\\uA790\\uA7A4]/g,\n\t\t\t'NJ':/[\\u01CA]/g,\n\t\t\t'Nj':/[\\u01CB]/g,\n\t\t\t'O': /[\\u004F\\u24C4\\uFF2F\\u00D2\\u00D3\\u00D4\\u1ED2\\u1ED0\\u1ED6\\u1ED4\\u00D5\\u1E4C\\u022C\\u1E4E\\u014C\\u1E50\\u1E52\\u014E\\u022E\\u0230\\u00D6\\u022A\\u1ECE\\u0150\\u01D1\\u020C\\u020E\\u01A0\\u1EDC\\u1EDA\\u1EE0\\u1EDE\\u1EE2\\u1ECC\\u1ED8\\u01EA\\u01EC\\u00D8\\u01FE\\u0186\\u019F\\uA74A\\uA74C]/g,\n\t\t\t'OI':/[\\u01A2]/g,\n\t\t\t'OO':/[\\uA74E]/g,\n\t\t\t'OU':/[\\u0222]/g,\n\t\t\t'P': /[\\u0050\\u24C5\\uFF30\\u1E54\\u1E56\\u01A4\\u2C63\\uA750\\uA752\\uA754]/g,\n\t\t\t'Q': /[\\u0051\\u24C6\\uFF31\\uA756\\uA758\\u024A]/g,\n\t\t\t'R': /[\\u0052\\u24C7\\uFF32\\u0154\\u1E58\\u0158\\u0210\\u0212\\u1E5A\\u1E5C\\u0156\\u1E5E\\u024C\\u2C64\\uA75A\\uA7A6\\uA782]/g,\n\t\t\t'S': /[\\u0053\\u24C8\\uFF33\\u1E9E\\u015A\\u1E64\\u015C\\u1E60\\u0160\\u1E66\\u1E62\\u1E68\\u0218\\u015E\\u2C7E\\uA7A8\\uA784]/g,\n\t\t\t'T': /[\\u0054\\u24C9\\uFF34\\u1E6A\\u0164\\u1E6C\\u021A\\u0162\\u1E70\\u1E6E\\u0166\\u01AC\\u01AE\\u023E\\uA786]/g,\n\t\t\t'TZ':/[\\uA728]/g,\n\t\t\t'U': /[\\u0055\\u24CA\\uFF35\\u00D9\\u00DA\\u00DB\\u0168\\u1E78\\u016A\\u1E7A\\u016C\\u00DC\\u01DB\\u01D7\\u01D5\\u01D9\\u1EE6\\u016E\\u0170\\u01D3\\u0214\\u0216\\u01AF\\u1EEA\\u1EE8\\u1EEE\\u1EEC\\u1EF0\\u1EE4\\u1E72\\u0172\\u1E76\\u1E74\\u0244]/g,\n\t\t\t'V': /[\\u0056\\u24CB\\uFF36\\u1E7C\\u1E7E\\u01B2\\uA75E\\u0245]/g,\n\t\t\t'VY':/[\\uA760]/g,\n\t\t\t'W': /[\\u0057\\u24CC\\uFF37\\u1E80\\u1E82\\u0174\\u1E86\\u1E84\\u1E88\\u2C72]/g,\n\t\t\t'X': /[\\u0058\\u24CD\\uFF38\\u1E8A\\u1E8C]/g,\n\t\t\t'Y': /[\\u0059\\u24CE\\uFF39\\u1EF2\\u00DD\\u0176\\u1EF8\\u0232\\u1E8E\\u0178\\u1EF6\\u1EF4\\u01B3\\u024E\\u1EFE]/g,\n\t\t\t'Z': /[\\u005A\\u24CF\\uFF3A\\u0179\\u1E90\\u017B\\u017D\\u1E92\\u1E94\\u01B5\\u0224\\u2C7F\\u2C6B\\uA762]/g,\n\t\t\t'a': /[\\u0061\\u24D0\\uFF41\\u1E9A\\u00E0\\u00E1\\u00E2\\u1EA7\\u1EA5\\u1EAB\\u1EA9\\u00E3\\u0101\\u0103\\u1EB1\\u1EAF\\u1EB5\\u1EB3\\u0227\\u01E1\\u00E4\\u01DF\\u1EA3\\u00E5\\u01FB\\u01CE\\u0201\\u0203\\u1EA1\\u1EAD\\u1EB7\\u1E01\\u0105\\u2C65\\u0250]/g,\n\t\t\t'aa':/[\\uA733]/g,\n\t\t\t'ae':/[\\u00E6\\u01FD\\u01E3]/g,\n\t\t\t'ao':/[\\uA735]/g,\n\t\t\t'au':/[\\uA737]/g,\n\t\t\t'av':/[\\uA739\\uA73B]/g,\n\t\t\t'ay':/[\\uA73D]/g,\n\t\t\t'b': /[\\u0062\\u24D1\\uFF42\\u1E03\\u1E05\\u1E07\\u0180\\u0183\\u0253]/g,\n\t\t\t'c': /[\\u0063\\u24D2\\uFF43\\u0107\\u0109\\u010B\\u010D\\u00E7\\u1E09\\u0188\\u023C\\uA73F\\u2184]/g,\n\t\t\t'd': /[\\u0064\\u24D3\\uFF44\\u1E0B\\u010F\\u1E0D\\u1E11\\u1E13\\u1E0F\\u0111\\u018C\\u0256\\u0257\\uA77A]/g,\n\t\t\t'dz':/[\\u01F3\\u01C6]/g,\n\t\t\t'e': /[\\u0065\\u24D4\\uFF45\\u00E8\\u00E9\\u00EA\\u1EC1\\u1EBF\\u1EC5\\u1EC3\\u1EBD\\u0113\\u1E15\\u1E17\\u0115\\u0117\\u00EB\\u1EBB\\u011B\\u0205\\u0207\\u1EB9\\u1EC7\\u0229\\u1E1D\\u0119\\u1E19\\u1E1B\\u0247\\u025B\\u01DD]/g,\n\t\t\t'f': /[\\u0066\\u24D5\\uFF46\\u1E1F\\u0192\\uA77C]/g,\n\t\t\t'g': /[\\u0067\\u24D6\\uFF47\\u01F5\\u011D\\u1E21\\u011F\\u0121\\u01E7\\u0123\\u01E5\\u0260\\uA7A1\\u1D79\\uA77F]/g,\n\t\t\t'h': /[\\u0068\\u24D7\\uFF48\\u0125\\u1E23\\u1E27\\u021F\\u1E25\\u1E29\\u1E2B\\u1E96\\u0127\\u2C68\\u2C76\\u0265]/g,\n\t\t\t'hv':/[\\u0195]/g,\n\t\t\t'i': /[\\u0069\\u24D8\\uFF49\\u00EC\\u00ED\\u00EE\\u0129\\u012B\\u012D\\u00EF\\u1E2F\\u1EC9\\u01D0\\u0209\\u020B\\u1ECB\\u012F\\u1E2D\\u0268\\u0131]/g,\n\t\t\t'j': /[\\u006A\\u24D9\\uFF4A\\u0135\\u01F0\\u0249]/g,\n\t\t\t'k': /[\\u006B\\u24DA\\uFF4B\\u1E31\\u01E9\\u1E33\\u0137\\u1E35\\u0199\\u2C6A\\uA741\\uA743\\uA745\\uA7A3]/g,\n\t\t\t'l': /[\\u006C\\u24DB\\uFF4C\\u0140\\u013A\\u013E\\u1E37\\u1E39\\u013C\\u1E3D\\u1E3B\\u017F\\u0142\\u019A\\u026B\\u2C61\\uA749\\uA781\\uA747]/g,\n\t\t\t'lj':/[\\u01C9]/g,\n\t\t\t'm': /[\\u006D\\u24DC\\uFF4D\\u1E3F\\u1E41\\u1E43\\u0271\\u026F]/g,\n\t\t\t'n': /[\\u006E\\u24DD\\uFF4E\\u01F9\\u0144\\u00F1\\u1E45\\u0148\\u1E47\\u0146\\u1E4B\\u1E49\\u019E\\u0272\\u0149\\uA791\\uA7A5]/g,\n\t\t\t'nj':/[\\u01CC]/g,\n\t\t\t'o': /[\\u006F\\u24DE\\uFF4F\\u00F2\\u00F3\\u00F4\\u1ED3\\u1ED1\\u1ED7\\u1ED5\\u00F5\\u1E4D\\u022D\\u1E4F\\u014D\\u1E51\\u1E53\\u014F\\u022F\\u0231\\u00F6\\u022B\\u1ECF\\u0151\\u01D2\\u020D\\u020F\\u01A1\\u1EDD\\u1EDB\\u1EE1\\u1EDF\\u1EE3\\u1ECD\\u1ED9\\u01EB\\u01ED\\u00F8\\u01FF\\u0254\\uA74B\\uA74D\\u0275]/g,\n\t\t\t'oi':/[\\u01A3]/g,\n\t\t\t'ou':/[\\u0223]/g,\n\t\t\t'oo':/[\\uA74F]/g,\n\t\t\t'p': /[\\u0070\\u24DF\\uFF50\\u1E55\\u1E57\\u01A5\\u1D7D\\uA751\\uA753\\uA755]/g,\n\t\t\t'q': /[\\u0071\\u24E0\\uFF51\\u024B\\uA757\\uA759]/g,\n\t\t\t'r': /[\\u0072\\u24E1\\uFF52\\u0155\\u1E59\\u0159\\u0211\\u0213\\u1E5B\\u1E5D\\u0157\\u1E5F\\u024D\\u027D\\uA75B\\uA7A7\\uA783]/g,\n\t\t\t's': /[\\u0073\\u24E2\\uFF53\\u00DF\\u015B\\u1E65\\u015D\\u1E61\\u0161\\u1E67\\u1E63\\u1E69\\u0219\\u015F\\u023F\\uA7A9\\uA785\\u1E9B]/g,\n\t\t\t't': /[\\u0074\\u24E3\\uFF54\\u1E6B\\u1E97\\u0165\\u1E6D\\u021B\\u0163\\u1E71\\u1E6F\\u0167\\u01AD\\u0288\\u2C66\\uA787]/g,\n\t\t\t'tz':/[\\uA729]/g,\n\t\t\t'u': /[\\u0075\\u24E4\\uFF55\\u00F9\\u00FA\\u00FB\\u0169\\u1E79\\u016B\\u1E7B\\u016D\\u00FC\\u01DC\\u01D8\\u01D6\\u01DA\\u1EE7\\u016F\\u0171\\u01D4\\u0215\\u0217\\u01B0\\u1EEB\\u1EE9\\u1EEF\\u1EED\\u1EF1\\u1EE5\\u1E73\\u0173\\u1E77\\u1E75\\u0289]/g,\n\t\t\t'v': /[\\u0076\\u24E5\\uFF56\\u1E7D\\u1E7F\\u028B\\uA75F\\u028C]/g,\n\t\t\t'vy':/[\\uA761]/g,\n\t\t\t'w': /[\\u0077\\u24E6\\uFF57\\u1E81\\u1E83\\u0175\\u1E87\\u1E85\\u1E98\\u1E89\\u2C73]/g,\n\t\t\t'x': /[\\u0078\\u24E7\\uFF58\\u1E8B\\u1E8D]/g,\n\t\t\t'y': /[\\u0079\\u24E8\\uFF59\\u1EF3\\u00FD\\u0177\\u1EF9\\u0233\\u1E8F\\u00FF\\u1EF7\\u1E99\\u1EF5\\u01B4\\u024F\\u1EFF]/g,\n\t\t\t'z': /[\\u007A\\u24E9\\uFF5A\\u017A\\u1E91\\u017C\\u017E\\u1E93\\u1E95\\u01B6\\u0225\\u0240\\u2C6C\\uA763]/g\n\t\t};\n\t\tfor (var l in norm_map) {\n\t\t\tstr = str.replace(norm_map[l], l);\n\t\t}\n\t\treturn str.replace(/[^\\x00-\\x7F]/g, '');\n\t};\n\n\n/*\n * classList.js: Cross-browser full element.classList implementation.\n * 2011-06-15\n *\n * By Eli Grey, http://eligrey.com\n * Public Domain.\n * NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\n */\n\n/*global self, document, DOMException */\n\n/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js*/\n\nif (typeof document !== \"undefined\" && !(\"classList\" in document.createElement(\"a\"))) {\n\n(function (view) {\n\nvar\n\t  classListProp = \"classList\"\n\t, protoProp = \"prototype\"\n\t, elemCtrProto = (view.HTMLElement || view.Element)[protoProp]\n\t, objCtr = Object\n\t, strTrim = String[protoProp].trim || function () {\n\t\treturn this.replace(/^\\s+|\\s+$/g, \"\");\n\t}\n\t, arrIndexOf = Array[protoProp].indexOf || function (item) {\n\t\tvar\n\t\t\t  i = 0\n\t\t\t, len = this.length\n\t\t;\n\t\tfor (; i < len; i++) {\n\t\t\tif (i in this && this[i] === item) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t}\n\t// Vendors: please allow content code to instantiate DOMExceptions\n\t, DOMEx = function (type, message) {\n\t\tthis.name = type;\n\t\tthis.code = DOMException[type];\n\t\tthis.message = message;\n\t}\n\t, checkTokenAndGetIndex = function (classList, token) {\n\t\tif (token === \"\") {\n\t\t\tthrow new DOMEx(\n\t\t\t\t  \"SYNTAX_ERR\"\n\t\t\t\t, \"An invalid or illegal string was specified\"\n\t\t\t);\n\t\t}\n\t\tif (/\\s/.test(token)) {\n\t\t\tthrow new DOMEx(\n\t\t\t\t  \"INVALID_CHARACTER_ERR\"\n\t\t\t\t, \"String contains an invalid character\"\n\t\t\t);\n\t\t}\n\t\treturn arrIndexOf.call(classList, token);\n\t}\n\t, ClassList = function (elem) {\n\t\tvar\n\t\t\t  trimmedClasses = strTrim.call(elem.className)\n\t\t\t, classes = trimmedClasses ? trimmedClasses.split(/\\s+/) : []\n\t\t\t, i = 0\n\t\t\t, len = classes.length\n\t\t;\n\t\tfor (; i < len; i++) {\n\t\t\tthis.push(classes[i]);\n\t\t}\n\t\tthis._updateClassName = function () {\n\t\t\telem.className = this.toString();\n\t\t};\n\t}\n\t, classListProto = ClassList[protoProp] = []\n\t, classListGetter = function () {\n\t\treturn new ClassList(this);\n\t}\n;\n// Most DOMException implementations don't allow calling DOMException's toString()\n// on non-DOMExceptions. Error's toString() is sufficient here.\nDOMEx[protoProp] = Error[protoProp];\nclassListProto.item = function (i) {\n\treturn this[i] || null;\n};\nclassListProto.contains = function (token) {\n\ttoken += \"\";\n\treturn checkTokenAndGetIndex(this, token) !== -1;\n};\nclassListProto.add = function (token) {\n\ttoken += \"\";\n\tif (checkTokenAndGetIndex(this, token) === -1) {\n\t\tthis.push(token);\n\t\tthis._updateClassName();\n\t}\n};\nclassListProto.remove = function (token) {\n\ttoken += \"\";\n\tvar index = checkTokenAndGetIndex(this, token);\n\tif (index !== -1) {\n\t\tthis.splice(index, 1);\n\t\tthis._updateClassName();\n\t}\n};\nclassListProto.toggle = function (token) {\n\ttoken += \"\";\n\tif (checkTokenAndGetIndex(this, token) === -1) {\n\t\tthis.add(token);\n\t} else {\n\t\tthis.remove(token);\n\t}\n};\nclassListProto.toString = function () {\n\treturn this.join(\" \");\n};\n \nif (objCtr.defineProperty) {\n\tvar classListPropDesc = {\n\t\t  get: classListGetter\n\t\t, enumerable: true\n\t\t, configurable: true\n\t};\n\ttry {\n\t\tobjCtr.defineProperty(elemCtrProto, classListProp, classListPropDesc);\n\t} catch (ex) { // IE 8 doesn't support enumerable:true\n\t\tif (ex.number === -0x7FF5EC54) {\n\t\t\tclassListPropDesc.enumerable = false;\n\t\t\tobjCtr.defineProperty(elemCtrProto, classListProp, classListPropDesc);\n\t\t}\n\t}\n} else if (objCtr[protoProp].__defineGetter__) {\n\telemCtrProto.__defineGetter__(classListProp, classListGetter);\n}\n \n}(self));\n \n}\nKonOpas.Prog = function(list, opt) {\n\tfunction _sort(a, b) {\n\t\tif (!a.date != !b.date) return a.date ? -1 : 1;\n\t\tif (a.date < b.date) return -1;\n\t\tif (a.date > b.date) return  1;\n\t\tif (!a.time != !b.time) return a.time ? 1 : -1;\n\t\tif (a.time < b.time) return -1;\n\t\tif (a.time > b.time) return  1;\n\t\tif (a.loc && b.loc) {\n\t\t\tif (a.loc.length < b.loc.length) return -1;\n\t\t\tif (a.loc.length > b.loc.length) return  1;\n\t\t\tfor (var i = a.loc.length - 1; i >= 0; --i) {\n\t\t\t\tif (a.loc[i] < b.loc[i]) return -1;\n\t\t\t\tif (a.loc[i] > b.loc[i]) return  1;\n\t\t\t}\n\t\t}\n\t\treturn 0;\n\t}\n\tthis.list = (list || []).sort(_sort);\n\tthis.list.forEach(function(p) {\n\t\tif (p && p.date) {\n\t\t\tvar d = p.date.split(/\\D+/),\n\t\t\t    t = p.time && p.time.split(/\\D+/) || [0,0],\n\t\t\t\tm = p.time && Number(p.mins || KonOpas.default_duration) || (!p.time && 24*60-1) || 0;\n\t\t\tp.t0 = new Date(d[0], d[1] - 1, d[2], t[0], t[1]);\n\t\t\tif (isNaN(p.t0)) delete p.t0;\n\t\t\telse p.t1 = new Date(p.t0.valueOf() + 60000 * m);\n\t\t}\n\t});\n\tvar pf = _el('prog_filters');\n\tpf.onclick = KonOpas.Prog.filter_change;\n\tvar pl = pf.getElementsByClassName('popup-link');\n\tfor (var i = 0; i < pl.length; ++i) {\n\t\tpl[i].setAttribute('data-title', pl[i].textContent);\n\t\tpl[i].nextElementSibling.onclick = KonOpas.Prog.filter_change;\n\t}\n\tvar sf = _el('search');\n\tif (sf) {\n\t\tsf.onsubmit = _el('q').oninput = KonOpas.Prog.filter_change;\n\t\tsf.onreset = function() { KonOpas.Prog.set_filters({}); };\n\t}\n\tthis.init_filters(opt);\n\tvar pt = _el('tab_prog'),\n\t    pa = pt && pt.getElementsByTagName('a');\n\tif (pa && pa.length) pa[0].onclick = function(ev) {\n\t\tif (window.pageYOffset && document.body.classList.contains('prog')) {\n\t\t\twindow.scrollTo(0, 0);\n\t\t\t(ev || window.event).preventDefault();\n\t\t}\n\t};\n}\n\n\n// ------------------------------------------------------------------------------------------------ static\n\nKonOpas.Prog.hash = function(f, excl) {\n\tvar p = ['#prog'];\n\tif (f) ['id', 'area', 'tag', 'query'].forEach(function(k){\n\t\tvar v = f[k + '_str'] || f[k];\n\t\tif (excl && excl[k] || !v || (v == 'all_' + k + 's')) return;\n\t\tif ((k == 'tag') && konopas.tag_categories) {\n\t\t\tvar m = v.match(new RegExp('^(' + konopas.tag_categories.join('|') + '):(.*)'));\n\t\t\tif (m) { k = m[1]; v = m[2]; }\n\t\t}\n\t\tp.push(k + ':' + KonOpas.hash_encode(v));\n\t});\n\treturn p.length > 1 ? p.join('/') : '#';\n}\n\nKonOpas.Prog.get_filters = function(hash_only) {\n\tvar\tfilters = { 'area':'', 'tag':'', 'query':'', 'id':'' },\n\t\th = window.location.toString().split('#')[1] || '',\n\t\th_set = false,\n\t\ttag_re = konopas.tag_categories && konopas.tag_categories.length && new RegExp('^' + konopas.tag_categories.join('|') + '$');\n\tif (h.substr(0, 5) == 'prog/') {\n\t\th.substr(5).split('/').forEach(function(p){\n\t\t\tvar s = p.split(':');\n\t\t\tif ((s.length == 2) && s[0] && s[1]) {\n\t\t\t\tif (tag_re && tag_re.test(s[0])) {\n\t\t\t\t\ts[1] = p;\n\t\t\t\t\ts[0] = 'tag';\n\t\t\t\t}\n\t\t\t\tfilters[s[0]] = KonOpas.hash_decode(s[1]);\n\t\t\t\th_set = true;\n\t\t\t}\n\t\t});\n\t}\n\tif (!hash_only && !h_set && !document.body.classList.contains('prog')) {\n\t\tvar store = konopas.store.get('prog');\n\t\tif (store) for (var k in store) {\n\t\t\tif (filters.hasOwnProperty(k)) filters[k] = store[k];\n\t\t}\n\t}\n\treturn filters;\n}\n\nKonOpas.Prog.set_filters = function(f, silent) {\n\tif (silent && !(history && history.replaceState)) return false;\n\tif (f.id) f = { 'id': f.id };\n\tkonopas.store.set('prog', f);\n\tvar h = KonOpas.Prog.hash(f),\n\t    h_cur = window.location.toString().split('#')[1] || '';\n\tif (h_cur != h.substr(1)) {\n\t\tif (silent) {\n\t\t\tvar loc = window.location.toString().split('#')[0] + h;\n\t\t\thistory.replaceState({}, document.title, loc);\n\t\t\twindow.onhashchange()\n\t\t} else {\n\t\t\twindow.location.hash = h;\n\t\t}\n\t\treturn true;\n\t}\n\treturn false;\n}\n\n// read filters from url + ev -> set new hash\nKonOpas.Prog.filter_change = function(ev) {\n\tev = ev || window.event;\n\tvar key, value;\n\tvar silent = false;\n\tswitch (ev.type) {\n\t\tcase 'click':\n\t\t\tif (ev.target.tagName.toLowerCase() != 'li') return;\n\t\t\tvar popups = ev.target.getElementsByClassName('popup');\n\t\t\tif (popups && popups.length) return;\n\t\t\tkey = ev.target.parentNode.id.replace(/\\d+$/, '');\n\t\t\tvalue = ev.target.id;\n\t\t\tswitch (key) {\n\t\t\t\tcase 'area': value = value.replace(/^a([^a-zA-Z])/, '$1'); break;\n\t\t\t\tcase 'tag':  value = value.replace(/^t([^a-zA-Z])/, '$1'); break;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'submit':\n\t\t\tev.preventDefault();\n\t\t\t// fallthrough\n\t\tcase 'input':\n\t\t\tkey = 'query';\n\t\t\tvalue = _el(\"q\").value;\n\t\t\tsilent = value.length > 1;\n\t\t\tbreak;\n\t\tdefault: return;\n\t}\n\tvar filters = KonOpas.Prog.get_filters();\n\tfilters[key] = value;\n\tif (filters['id'] && (key != 'id')) filters['id'] = '';\n\tKonOpas.Prog.set_filters(filters, silent);\n}\n\nKonOpas.Prog.focus_day = function(d) {\n\tfor (var n in {'day-sidebar':1, 'day-narrow':1}) {\n\t\tvar e = _el(n),\n\t\t\ts = e && e.getElementsByTagName('li');\n\t\tif (s) for (var i = 0; i < s.length; ++i) {\n\t\t\tvar _d = s[i].getAttribute('data-day');\n\t\t\ts[i].classList[(_d == d) ? 'add' : 'remove']('selected');\n\t\t}\n\t}\n}\n\n\n\n// ------------------------------------------------------------------------------------------------ instance\n\nKonOpas.Prog.prototype.init_filters = function(opt) {\n\tvar filter_el = _el('prog_lists'), labels = {}, regexp = {};\n\tfunction _txt(s) {\n\t\treturn i18n.txt(s.charAt(0).toUpperCase() + s.slice(1).replace('_',' '));\n\t}\n\tfunction _ul(id) {\n\t\tvar e = document.createElement('ul');\n\t\te.id = id;\n\t\treturn e;\n\t}\n\tfunction _li(par, id, txt) {\n\t\tvar e = document.createElement('li');\n\t\te.id = /^[^a-zA-Z]/.test(id) ? par.id[0] + id : id\n\t\tif (!txt) txt = labels[id] || _txt(id);\n\t\tif (/^\\s*$/.test(txt)) return;\n\t\te.textContent = /^[\\\\^$]/.test(txt) ? txt.substr(1) : txt;\n\t\tif (regexp[id]) e.setAttribute('data-regexp', regexp[id]);\n\t\tpar.appendChild(e);\n\t}\n\tfunction _compare(a, b) {\n\t\tvar sf = function(s) { return (labels[s] || s.replace(/^[^:]+:/, '')).toLowerCase().replace(/^the /, ''); },\n\t\t\taf = function(s) { return s.match(/\\d+|\\D+/g).map(function(v) { return Number(v) || v; }); },\n\t\t\t_a = sf(a), _b = sf(b);\n\t\tif ((_a[0] == '$') != (_b[0] == '$')) return (_a < _b) ? 1 : -1; // $ == 0x24\n\t\tif (/\\d/.test(_a) && /\\d/.test(_b)) {\n\t\t\tvar aa = af(_a), bb = af(_b);\n\t\t\tfor (var i = 0; i < aa.length && i < bb.length; ++i) {\n\t\t\t\tif (aa[i] < bb[i]) return -1;\n\t\t\t\tif (aa[i] > bb[i]) return  1;\n\t\t\t}\n\t\t\tif (aa.length != bb.length) return aa.length < bb.length ? -1 : 1;\n\t\t} else {\n\t\t\tif (_a < _b) return -1;\n\t\t\tif (_a > _b) return  1;\n\t\t}\n\t\treturn 0;\n\t}\n\tfunction _ul2(par, id, name, prefix, list) {\n\t\tvar title = labels[name] || _txt(name),\n\t\t    root = document.createElement('li'),\n\t\t    link = _new_elem('div', 'popup-link', title + '…'),\n\t\t    ul = _new_elem('ul', 'popup');\n\t\t// Hack: To remove Room category listing\n\t\tif (konopas.hiddenFilterCategories.indexOf(title) !== -1){\n\t\t\troot.style=\"display:none\";\n\t\t}\n\t\tlink.setAttribute('data-title', link.textContent);\n\t\tlink.addEventListener('click', KonOpas.popup_open);\n\t\tul.id = id;\n\t\tul.setAttribute('data-title', title);\n\t\tul.addEventListener('click', KonOpas.Prog.filter_change);\n\t\tfor (var i = 0; i < list.length; ++i) {\n\t\t\tvar txt = labels[list[i]] || list[i].replace(prefix, '');\n\t\t\t_li(ul, list[i], txt);\n\t\t}\n\t\troot.appendChild(link);\n\t\troot.appendChild(ul);\n\t\tpar.appendChild(root);\n\t}\n\tfunction _fill(id, items) {\n\t\tvar i = 0, o = opt[id], ul = _ul(id);\n\t\tlabels = o.labels || {};\n\t\tregexp = o.regexp || {};\n\t\tfor (var r in regexp) items[r] = 1;\n\t\t_li(ul, 'all_' + id + 's');\n\t\tif (o.promote) for (i = 0; i < o.promote.length; ++i) {\n\t\t\t_li(ul, o.promote[i]);\n\t\t\tdelete items[o.promote[i]];\n\t\t}\n\t\tif (o.exclude) {\n\t\t\tvar re = new RegExp(o.exclude.join('|'));\n\t\t\tfor (var t in items) if (re.test(t)) delete items[t];\n\t\t}\n\t\tif (o.min_count) {\n\t\t\tfor (var t in items) if (items[t] < o.min_count) delete items[t];\n\t\t}\n\t\tvar list = Object.keys(items).sort(_compare);\n\t\tif (o.categories) for (i = 0; i < o.categories.length; ++i) {\n\t\t\tvar prefix = o.categories[i] + ':',\n\t\t\t    list_in = [], list_out = [];\n\t\t\tfor (var j = 0; j < list.length; ++j) {\n\t\t\t\tif (list[j].substr(0, prefix.length) == prefix) {\n\t\t\t\t\tlist_in.push(list[j]);\n\t\t\t\t} else {\n\t\t\t\t\tlist_out.push(list[j]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tswitch (list_in.length) {\n\t\t\t\tcase 0:   break;\n\t\t\t\tcase 1:   _li(ul, prefix + list_in[0]);  break;\n\t\t\t\tdefault:  _ul2(ul, id + i, o.categories[i], prefix, list_in);\n\t\t\t}\n\t\t\tlist = list_out;\n\t\t}\n\t\tif (list.length < 4) for (i = 0; i < list.length; ++i) _li(ul, list[i]);\n\t\telse _ul2(ul, id + i, id, '', list);\n\t\tfilter_el.appendChild(ul);\n\t}\n\tif (!opt || !filter_el) return;\n\twhile (filter_el.firstChild) filter_el.removeChild(filter_el.firstChild);\n\tvar days = {}, areas = {}, tags = {},\n\t    lvl = (opt.area && opt.area.loc_level) || 0;\n\tfor (var i = 0, l = this.list.length; i < l; ++i) {\n\t\tvar p = this.list[i];\n\t\tif (p.date) days[p.date] = 1;\n\t\tif (opt.area && (typeof p.loc == 'object') && p.loc && p.loc[lvl]) areas[p.loc[lvl]] = (areas[p.loc[lvl]] || 0) + 1;\n\t\tif (opt.tag && (typeof p.tags == 'object') && p.tags) for (var j = 0; j < p.tags.length; ++j) {\n\t\t\tvar t_s = opt.tag.set_category && opt.tag.set_category[p.tags[j]];\n\t\t\tif (t_s) p.tags[j] = t_s + ':' + p.tags[j];\n\t\t\ttags[p.tags[j]] = (tags[p.tags[j]] || 0) + 1;\n\t\t}\n\t}\n\tif (opt.day && opt.day.exclude) {\n\t\tvar d_re = new RegExp(opt.day.exclude.join('|'));\n\t\tfor (var d in days) if (d_re.test(d)) delete days[d];\n\t}\n\tthis.days = {};\n\tfor (var d in days) {\n\t\tvar d_d = KonOpas.parse_date(d), d_n = {'N': d_d ? d_d.getDay() : -1 };\n\t\tthis.days[d] = {\n\t\t\t'short': i18n.txt('weekday_short_n', d_n),\n\t\t\t'long': i18n.txt('weekday_n', d_n)\n\t\t};\n\t}\n\tif (opt.area) _fill('area', areas);\n\tif (opt.tag) _fill('tag', tags);\n}\n\n\nKonOpas.Prog.prototype.show_filter_sum = function(ls, f) {\n\tvar fs = _el('filter_sum'); if (!fs) return;\n\tvar cb = _el('q_clear');\n\tvar _a = function(txt, unset) {\n\t\tvar excl = {id:1}; if (unset) excl[unset] = 1;\n\t\treturn '<a href=\"' + KonOpas.Prog.hash(f, excl) + '\">' + txt + '</a>';\n\t}\n\tif (f.id_only) {\n\t\tfs.innerHTML = i18n.txt('filter_sum_id', { 'N':ls.length, 'TITLE':_a(ls[0].title), 'ID':_a(f.id) });\n\t\tif (cb) cb.disabled = false;\n\t} else {\n\t\tvar d = { 'N': f.n_listed,\n\t\t\t'ALL': !f.show_all || f.tag_str || f.area_str || f.query_str ? '' : _a(i18n.txt('all'), {}, 0),\n\t\t\t'TAG': f.tag_str ? _a(f.tag_str, 'tag') : '' };\n\t\tif (f.day && !f.show_all) {\n\t\t\td['DAY'] = i18n.txt('weekday_n', {'N': KonOpas.parse_date(f.day).getDay() });\n\t\t\tif (f.n_hidden) d['TIME'] = KonOpas.pretty_time(f.now, konopas);\n\t\t} else {\n\t\t\tif (f.n_hidden) d['LIVE'] = true;\n\t\t}\n\t\tif (f.area_str) d['AREA'] = _a(f.area_str, 'area');\n\t\tif (f.query_str) d['Q'] = _a(f.query_str, 'query');\n\t\tfs.innerHTML = i18n.txt('filter_sum', d);\n\t\tif (cb) cb.disabled = !f.area_str && !f.tag_str && !f.query_str;\n\t}\n}\n\n// hashchange -> read filters from url + store -> set filters in html + store -> list items\nKonOpas.Prog.prototype.show = function() {\n\tfunction _show_filters(f) {\n\t\tvar prev = _el('prog_filters').getElementsByClassName('selected');\n\t\tif (prev) for (var i = prev.length - 1; i >= 0; --i) {\n\t\t\tvar cl = prev[i].classList;\n\t\t\tif (cl.contains('popup-link')) prev[i].textContent = prev[i].getAttribute('data-title') || i18n.txt('More') + '…';\n\t\t\tcl.remove('selected');\n\t\t}\n\t\tfor (var k in f) {\n\t\t\tif (k == 'query') {\n\t\t\t\tvar q = _el(\"q\");\n\t\t\t\tif (q) {\n\t\t\t\t\tq.value = f.query;\n\t\t\t\t\tif (f.query) q.classList.add('selected');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tvar id = f[k];\n\t\t\t\tif (!id) id = 'all_' + k + 's';\n\t\t\t\telse if (id.match(/^[^a-zA-Z]/)) id = k[0] + id;\n\t\t\t\tvar el = _el(id);\n\t\t\t\tif (el) {\n\t\t\t\t\tel.classList.add('selected');\n\t\t\t\t\tif (el.parentNode.id.match(/\\d+$/)) {\n\t\t\t\t\t\tvar p = el.parentNode.parentNode.firstChild;\n\t\t\t\t\t\tp.classList.add('selected');\n\t\t\t\t\t\tp.textContent = el.textContent;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tfunction _filter(it) {\n\t\tif (this.area) {\n\t\t\tif (this.area instanceof RegExp) {\n\t\t\t\tif (!this.area.test(it.loc.join(';'))) return false;\n\t\t\t} else {\n\t\t\t\tif (!it.loc || (it.loc.indexOf(this.area) < 0)) return false;\n\t\t\t}\n\t\t}\n\t\tif (this.tag) {\n\t\t\tif (this.tag instanceof RegExp) {\n\t\t\t\tif (!this.tag.test(it.title)) return false;\n\t\t\t} else {\n\t\t\t\tif (!it.tags || (it.tags.indexOf(this.tag) < 0)) return false;\n\t\t\t}\n\t\t}\n\t\tif (this.query) {\n\t\t\tvar found = this.query.test(it.title)\n\t\t\t\t|| this.query.test(it.desc)\n\t\t\t\t|| (it.loc && this.query.test(it.loc.join('\\t')))\n\t\t\t\t|| (it.tags && this.query.test(it.tags.join('\\t')))\n\t\t\t\t|| (it.people && it.people.some(function(p){ return this.query.test(p.name); }, this));\n\t\t\tif (!found) return false;\n\t\t}\n\t\treturn true;\n\t}\n\tfunction _show_list(f, self) {\n\t\tf.area_str = f.area || '';\n\t\tif (f.area && _el(f.area)) {\n\t\t\tvar t = _el(f.area).getAttribute(\"data-regexp\");\n\t\t\tif (t) f.area = new RegExp(t);\n\t\t}\n\t\tf.tag_str = f.tag || '';\n\t\tif (f.tag && _el(f.tag)) {\n\t\t\tvar t = _el(f.tag).getAttribute(\"data-regexp\");\n\t\t\tif (t) f.tag = new RegExp(t);\n\t\t}\n\t\tf.query_str = f.query || '';\n\t\tif (f.query) f.query = KonOpas.glob_to_re(f.query);\n\t\tf.id_only = !!f.id;\n\t\tif (f.id_only) for (var i in f) if ((i != 'id') && (i != 'id_only') && f[i]) {\n\t\t\tf.id_only = false;\n\t\t\tbreak;\n\t\t}\n\t\tvar ls = self.list.filter(f.id_only ? function(it){ return it.id == f.id; } : _filter, f);\n\t\tif (f.id && ls.every(function(p) { return p.id != f.id; })) {\n\t\t\tf.id = '';\n\t\t\tif (KonOpas.Prog.set_filters(f)) return;\n\t\t}\n\t\tf.hide_ended = true;\n\t\tf.prog_view = true;\n\t\tKonOpas.Item.show_list(ls, f);\n\t}\n\n\tvar f = KonOpas.Prog.get_filters();\n\tif (KonOpas.Prog.set_filters(f)) return;\n\t_show_filters(f);\n\tfor (var k in f) {\n\t\tif (!k || !f[k] || (f[k] == 'all_' + k + 's')) { delete f[k]; continue; }\n\t}\n\t_show_list(f, this);\n}\nKonOpas.Server = function(id, stars, opt) {\n\tthis.id = id;\n\tthis.stars = stars;\n\n\topt = opt || {};\n\tthis.host = opt.host ||  'https://konopas-server.appspot.com';\n\tthis.el_id = opt.el_id || 'server_connect';\n\tthis.err_el_id = opt.err_el_id || 'server_error';\n\ttry { this.store = localStorage; } catch (e) { this.store = new KonOpas.VarStore(); }\n\n\tthis.connected = false;\n\tthis.token = this.store.getItem('konopas.token') || false;\n\tthis.ical = this.store.getItem('konopas.'+this.id+'.ical_link') || false;\n\tthis.prog_data = {};\n\tthis.prog_server_mtime = 0;\n\tthis.el = document.getElementById(this.el_id);\n\tthis.err_el = false;\n\n\tthis.disconnect();\n\tif (this.stars) this.stars.server = this;\n\tif (this.el && this.id) this.exec('info');\n\telse _log(\"server init failed\", 'warn');\n\n\tvar m = /#server_error=(.+)/.exec(window.location.hash);\n\tif (m) this.error(decodeURIComponent(m[1].replace(/\\+/g, ' ')), window.location.href);\n}\n\nKonOpas.Server.prototype.disconnect = function() {\n\tthis.connected = false;\n\tif (this.el) this.el.innerHTML = '<div id=\"server_info\">' + i18n.txt('Not connected') + '</div>';\n\tdocument.body.classList.remove('logged-in');\n}\n\nKonOpas.Server.prototype.logout = function(ev) {\n\t_log('server logout');\n\tthis.exec('/logout');\n\t(ev || window.event).preventDefault();\n}\n\nKonOpas.Server.prototype.error = function(msg, url) {\n\t_log('server error ' + msg + ', url: ' + url, 'error');\n\tif (msg =='') {\n\t\tvar cmd = url.replace(this.host, '').replace('/' + this.id + '/', '');\n\t\tmsg = i18n.txt('server_cmd_fail', {'CMD':'<code>'+cmd+'</code>'});\n\t}\n\tif (!this.err_el) {\n\t\tvar el = document.createElement('div');\n\t\tel.id = this.err_el_id;\n\t\tel.title = i18n.txt('Click to close');\n\t\tel.onclick = function(ev) { this.err_el.style.display = 'none'; }.bind(this);\n\t\tdocument.body.appendChild(el);\n\t\tthis.err_el = el;\n\t}\n\tthis.err_el.innerHTML = '<div>' + i18n.txt('Server error') + ': <b>' + msg + '</b></div>';\n\tthis.err_el.style.display = 'block';\n\treturn true;\n}\n\nKonOpas.Server.prototype.onmessage = function(ev) {\n\tev = ev || window.event;\n\tif (ev.origin != this.host) {\n\t\t_log('Got an unexpected message from ' + ev.origin, 'error');\n\t\t_log(ev);\n\t\treturn;\n\t}\n\tvar self = this;\n\tJSON.parse(ev.data, function(k, v) {\n\t\tswitch (k) {\n\t\t\tcase 'ok':    self.cb_ok(v);      break;\n\t\t\tcase 'fail':  self.error('', v);  break;\n\t\t}\n\t});\n}\n\n\n\n// ------------------------------------------------------------------------------------------------ prog\n\nKonOpas.Server.prototype.prog_mtime = function() {\n\tvar mtime = this.prog_server_mtime;\n\tfor (var id in this.prog_data) {\n\t\tif (this.prog_data[id][1] > mtime) mtime = this.prog_data[id][1];\n\t}\n\treturn mtime;\n}\n\nKonOpas.Server.prototype.add_prog = function(id, add_star) {\n\tif (id instanceof Array) id = id.join(',');\n\t_log('server add_prog \"' + id + '\" ' + (add_star ? '1' : '0'));\n\tvar t = this.prog_mtime();\n\tthis.exec('prog'\n\t\t+ (add_star ? '?add=' : '?rm=') + id\n\t\t+ (t ? '&t=' + t : ''));\n}\n\nKonOpas.Server.prototype.set_prog = function(star_list) {\n\t_log('server set_prog \"' + star_list);\n\tvar t = this.prog_mtime();\n\tthis.exec('prog'\n\t\t+ '?set=' + star_list.join(',')\n\t\t+ (t ? '&t=' + t : ''));\n}\n\n\n\n// ------------------------------------------------------------------------------------------------ ical\n\nKonOpas.Server.prototype.show_ical_link = function(p_el) {\n\tvar html = '';\n\tif (!this.connected) {\n\t\thtml = i18n.txt('ical_login');\n\t} else if (this.ical) {\n\t\tif (typeof this.ical == 'string') {\n\t\t\thtml = i18n.txt('ical_link') + '<br><a href=\"' + this.ical + '\">' + this.ical + '</a>'\n\t\t\t\t+ '<br><span class=\"hint\">' + i18n.txt('ical_hint') + '</span>';\n\t\t} else {\n\t\t\thtml = i18n.txt('ical_make', {'A_TAG':'<a id=\"ical_link\" class=\"js-link\">'});\n\t\t}\n\t}\n\tif (p_el) p_el.innerHTML += '<p id=\"ical_text\">' + html;\n\telse {\n\t\tvar i_el = document.getElementById('ical_text');\n\t\tif (i_el) i_el.innerHTML = html;\n\t}\n\tvar a = document.getElementById('ical_link');\n\tif (a) {\n\t\ta.onclick = function() { this.exec('ical_link'); }.bind(this);\n\t}\n}\n\n\n\n// ------------------------------------------------------------------------------------------------ exec\n\nKonOpas.Server.prototype.url = function(cmd) {\n\tif (this.token) cmd += (cmd.indexOf('?') != -1 ? '&' : '?') + 'k=' + encodeURIComponent(this.token);\n\treturn this.host + (cmd[0] == '/' ? '' : '/' + this.id + '/') + cmd;\n}\n\n// based on https://github.com/IntoMethod/Lightweight-JSONP/blob/master/jsonp.js\nKonOpas.Server.prototype.exec = function(cmd) {\n\tvar script = document.createElement('script'),\n\t\tdone = false,\n\t\turl = this.url(cmd);\n\tscript.src = url;\n\tscript.async = true;\n\tscript.onerror = function(ev) { this.error('', (ev || window.event).target.src); }.bind(this);\n\n\tscript.onload = script.onreadystatechange = function() {\n\t\tif (!done && (!this.readyState || this.readyState === \"loaded\" || this.readyState === \"complete\")) {\n\t\t\tdone = true;\n\t\t\tscript.onload = script.onreadystatechange = null;\n\t\t\tif (script && script.parentNode) {\n\t\t\t\tscript.parentNode.removeChild(script);\n\t\t\t}\n\t\t}\n\t};\n\tdocument.getElementsByTagName('head')[0].appendChild(script);\n}\n\n\n\n// ------------------------------------------------------------------------------------------------ cb ok/fail\n\n// callback for successful logout, prog\nKonOpas.Server.prototype.cb_ok = function(v) {\n\tvar m = /^(?:https?:\\/\\/[^\\/]+)?\\/?([^?\\/]*)(?:\\/([^?]*))(?:\\?(.*))?/.exec(v);\n\tvar cmd = m[2] || '';\n\tvar query = m[3] || '';\n\tswitch (cmd) {\n\t\tcase 'logout':\n\t\t\tthis.disconnect();\n\t\t\tthis.token = false;\n\t\t\tthis.store.setItem('konopas.token', '');\n\t\t\tthis.prog_data = {};\n\t\t\tthis.prog_server_mtime = 0;\n\t\t\tif (this.stars) {\n\t\t\t\tthis.stars.data = {};\n\t\t\t\tthis.stars.write();\n\t\t\t\tkonopas.set_view();\n\t\t\t}\n\t\t\tthis.exec('info');\n\t\t\t_log(\"server ok (logout): \" + JSON.stringify(v));\n\t\t\tbreak;\n\n\t\tcase 'prog':\n\t\t\tvar t = /&server_mtime=(\\d+)/.exec(query);\n\t\t\tif (t) this.prog_server_mtime = parseInt(t[1], 10);\n\t\t\t_log(\"server ok (prog): \" + JSON.stringify(v));\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\t_log(\"server ok (???): \" + JSON.stringify(v), 'warn');\n\t}\n}\n\n// callback for reporting server errors\nKonOpas.Server.prototype.cb_fail = function(v) {\n\tthis.error(v.msg, v.url);\n}\n\n\n\n// ------------------------------------------------------------------------------------------------ callback\n\nKonOpas.Server.prototype.cb_info = function(v) {\n\t_log(\"server info: \" + JSON.stringify(v));\n\tthis.connected = [v.name, v.email];\n\tthis.el.innerHTML = '<div id=\"server_info\">'\n\t                  + '<a id=\"server_logout\" href=\"' + this.url(v.logout) + '\">' + i18n.txt('Logout') + '</a> '\n\t                  + '<span id=\"server_user\" title=\"' + ((v.name != v.email) ? v.email : '') + '\">' + v.name.replace(/@.*/, '')\n\t                  + '</span></div>';\n\tif (v.ical) {\n\t\tthis.ical = this.ical || true;\n\t\tthis.show_ical_link(false);\n\t}\n\tdocument.getElementById('server_logout').onclick = this.logout.bind(this);\n\tdocument.body.classList.add('logged-in');\n\tif (typeof jsErrLog == 'object') jsErrLog.info = v.name.replace(/[ @].*/, '');\n}\n\nKonOpas.Server.prototype.cb_token = function(token) {\n\t_log(\"server token: \" + token);\n\tthis.token = token;\n\tthis.store.setItem('konopas.token', token);\n}\n\nKonOpas.Server.prototype.cb_login = function(v) {\n\t_log(\"server login: \" + JSON.stringify(v));\n\tvar links = [];\n\tfor (var cmd in v) {\n\t\tlinks.push('<a href=\"' + this.url(cmd) + '\">' + v[cmd] + '</a>');\n\t}\n\tthis.el.innerHTML = '<div id=\"login-links\">'\n\t\t+ '\\n&raquo; <span class=\"popup-link\" id=\"login-popup-link\">' + i18n.txt('Login to sync your data') + '</span>\\n'\n\t\t+ '<div class=\"popup\" id=\"login-popup\">' + i18n.txt('login_why')\n\t\t+ \"\\n<ul>\\n<li>\" + links.join(\"\\n<li>\")\n\t\t+ \"\\n</ul></div></div>\";\n\t_el('login-popup-link').onclick = KonOpas.popup_open;\n}\n\nKonOpas.Server.prototype.cb_my_prog = function(v) {\n\t_log(\"server my_prog: \" + JSON.stringify(v));\n\tthis.prog_data = v.prog;\n\tif (v.t0) for (var id in this.prog_data) { this.prog_data[id][1] += v.t0; }\n\tif (this.stars) this.stars.sync(this.prog_data);\n\telse _log(\"Server.stars required for prog sync\", 'warn');\n}\n\nKonOpas.Server.prototype.cb_my_votes = function(v) { /* obsolete */ }\nKonOpas.Server.prototype.cb_pub_data = function(p) { /* obsolete */ }\nKonOpas.Server.prototype.cb_show_comments = function(id, c) { /* obsolete */ }\n\nKonOpas.Server.prototype.cb_ical_link = function(url) {\n\tthis.ical = url;\n\tthis.store.setItem('konopas.'+this.id+'.ical_link', url);\n\tthis.show_ical_link(false);\n}\nKonOpas.Stars = function(id, opt) {\n\topt = opt || {};\n\tthis.name = 'konopas.' + id + '.stars';\n\ttry { this.store = localStorage || sessionStorage || (new KonOpas.VarStore()); }\n\tcatch (e) { this.store = new KonOpas.VarStore(); }\n\tthis.tag = opt.tag || 'has_star';\n\tthis.server = false;\n\tthis.data = this.read();\n}\n\nKonOpas.Stars.prototype.read = function() {\n\treturn JSON.parse(this.store && this.store.getItem(this.name) || '{}');\n}\n\nKonOpas.Stars.prototype.write = function() {\n\ttry {\n\t\tif (this.store) this.store.setItem(this.name, JSON.stringify(this.data));\n\t} catch (e) {\n\t\tif ((e.code != DOMException.QUOTA_EXCEEDED_ERR) || (this.store.length != 0)) { throw e; }\n\t}\n}\n\nKonOpas.Stars.prototype.list = function() {\n\tvar list = [];\n\tif (this.data) for (var id in this.data) {\n\t\tif ((this.data[id].length == 2) && this.data[id][0]) list.push(id);\n\t}\n\treturn list;\n}\n\nKonOpas.Stars.prototype.add = function(star_list, mtime) {\n\tmtime = mtime || Math.floor(Date.now()/1000);\n\tstar_list.forEach(function(id) { this.data[id] = [1, mtime]; }, this);\n\n\tthis.write();\n\tif (this.server) this.server.set_prog(this.list());\n}\n\nKonOpas.Stars.prototype.set = function(star_list) {\n\tvar mtime = Math.floor(Date.now()/1000);\n\tif (this.data) for (var id in this.data) {\n\t\tthis.data[id] = [0, mtime];\n\t}\n\tthis.add(star_list, mtime);\n}\n\nKonOpas.Stars.prototype.toggle = function(el, id) {\n\tvar add_star = !el.classList.contains(this.tag);\n\tvar mtime = Math.floor(Date.now()/1000);\n\n\tthis.data[id] = [add_star ? 1 : 0, mtime];\n\tthis.write();\n\tif (this.server) this.server.add_prog(id, add_star);\n\n\tif (add_star) el.classList.add(this.tag);\n\telse          el.classList.remove(this.tag);\n}\n\nKonOpas.Stars.prototype.sync = function(new_data) {\n\tvar local_mod = [], redraw = false;\n\tfor (var id in new_data) {\n\t\tif (new_data[id].length != 2) {\n\t\t\t_log('Stars.sync: invalid input ' + id + ': ' + JSON.stringify(new_data[id]), 'warn');\n\t\t\tcontinue;\n\t\t}\n\t\tif (!(id in this.data) || (new_data[id][1] > this.data[id][1])) {\n\t\t\tlocal_mod.push(id);\n\t\t\tif (!(id in this.data) || (new_data[id][0] != this.data[id][0])) redraw = true;\n\t\t\tthis.data[id] = new_data[id];\n\t\t}\n\t}\n\tif (local_mod.length) {\n\t\t_log('Stars.sync: local changes: ' + local_mod + (redraw ? ' -> redraw' : ''));\n\t\tthis.write();\n\t\tif (redraw) konopas.set_view();\n\t}\n\n\tif (this.server) {\n\t\tvar server_add = [], server_rm = [];\n\t\tfor (var id in this.data) {\n\t\t\tif (!(id in new_data) || (new_data[id][1] < this.data[id][1])) {\n\t\t\t\tif (this.data[id][0]) server_add.push(id);\n\t\t\t\telse                  server_rm.push(id);\n\t\t\t}\n\t\t}\n\t\tif (server_add.length) {\n\t\t\t_log('Stars.sync: server add: ' + server_add);\n\t\t\tthis.server.add_prog(server_add, true);\n\t\t}\n\t\tif (server_rm.length) {\n\t\t\t_log('Stars.sync: server rm: ' + server_rm);\n\t\t\tthis.server.add_prog(server_rm, false);\n\t\t}\n\n\t\tif (!local_mod.length && !server_add.length && !server_rm.length) {\n\t\t\t_log('Stars.sync: no changes');\n\t\t}\n\t}\n}\n\nKonOpas.Stars.prototype.show = function() {\n\tvar view = _el(\"star_data\"),\n\t\thash = window.location.hash.substr(6),\n\t    set_raw = (hash && (hash.substr(0,4) == 'set:')) ? hash.substr(4).split(',') : [],\n\t    set = konopas.program.list.filter(function(p) { return (set_raw.indexOf(p.id) >= 0); }).map(function(p) { return p.id; }),\n\t    set_len = set.length,\n\t    html = '',\n\t    star_list = this.list(),\n\t    stars_len = star_list.length;\n\tif (konopas.store.limit && (!this.server || !this.server.connected)) {\n\t\thtml = '<p>' + i18n.txt('star_no_memory', {'WHY': konopas.store.limit, 'SERVER': !!this.server});\n\t}\n\tif (!stars_len && !set_len) {\n\t\t_el(\"prog_ls\").innerHTML = '';\n\t\tview.innerHTML = html + '<p>' + i18n.txt('star_hint');\n\t\treturn;\n\t}\n\tdocument.body.classList.remove(\"show_set\");\n\tset.sort();\n\tstar_list.sort();\n\tvar set_link = '#star/set:' + star_list.join(',');\n\tif (set_len) {\n\t\tif (KonOpas.arrays_equal(set, star_list)) {\n\t\t\thtml += '<p>' + i18n.txt('star_export_this', { 'THIS':set_link }) + '<p>' +\n\t\t\t\ti18n.txt('star_export_share', {\n\t\t\t\t\t'SHORT': KonOpas.link_to_short_url(location.href),\n\t\t\t\t\t'QR': KonOpas.link_to_qr_code(location.href)\n\t\t\t\t});\n\t\t} else {\n\t\t\tdocument.body.classList.add(\"show_set\");\n\t\t\tvar n_same = KonOpas.array_overlap(set, star_list);\n\t\t\tvar n_new = set_len - n_same;\n\t\t\tvar n_bad = set_raw.length - set_len;\n\t\t\thtml += '<p>' + i18n.txt('star_import_this', {'THIS':location.href})\n\t\t\t\t+ '<p>' + i18n.txt('star_import_diff', { 'PREV':stars_len, 'NEW':n_new, 'SAME':n_same });\n\t\t\tif (n_bad) html += ' ' + i18n.txt('star_import_bad', {'BAD':n_bad});\n\t\t\tif (!stars_len || (n_same != stars_len)) {\n\t\t\t\thtml += '<p>&raquo; <a href=\"#star\" id=\"star_set_set\">' + i18n.txt('star_set') + '</a>';\n\t\t\t}\n\t\t\tif (stars_len) {\n\t\t\t\tif (n_same != stars_len) {\n\t\t\t\t\tvar d = [];\n\t\t\t\t\tif (n_new) d.push(i18n.txt('add_n', {'N':n_new}));\n\t\t\t\t\td.push(i18n.txt('discard_n', {'N':stars_len - n_same}));\n\t\t\t\t\thtml += ' (' + d.join(', ') + ')';\n\t\t\t\t}\n\t\t\t\tif (n_new) html += '<p>&raquo; <a href=\"#star\" id=\"star_set_add\">' + i18n.txt('star_add', {'N':n_new}) + '</a>';\n\t\t\t}\n\t\t}\n\t} else {\n\t\thtml += '<p id=\"star_links\">&raquo; ' + i18n.txt('star_export_link', { 'URL':set_link, 'N':stars_len });\n\t}\n\tview.innerHTML = html;\n\tvar el_set = _el('star_set_set'); if (el_set) el_set.onclick = function() { konopas.stars.set(set); return true; };\n\tvar el_add = _el('star_set_add'); if (el_add) el_add.onclick = function() { konopas.stars.add(set); return true; };\n\tif (this.server) this.server.show_ical_link(view);\n\tvar ls = konopas.program.list.filter(function(it) { return (star_list.indexOf(it.id) >= 0) || (set.indexOf(it.id) >= 0); });\n\tKonOpas.Item.show_list(ls, {hide_ended:true});\n\tif (set_len) for (var i = 0; i < set_len; ++i) {\n\t\tvar el = _el('s' + set[i]);\n\t\tif (el) el.classList.add(\"in_set\");\n\t}\n}\nif (typeof i18n == 'undefined') i18n = {};\ni18n.txt = function(key){ return key; };\ni18n.translate_html = function(map, a) {\n\tvar list = document.querySelectorAll('['+a+']');\n\tfor (var i = 0, node; node = list[i]; ++i) {\n\t\tvar key = node.getAttribute(a) || node.textContent.trim();\n\t\tif (key in map) {\n\t\t\tvar data = node.getAttribute(a + '-var');\n\t\t\tvar attr = node.getAttribute(a + '-attr');\n\t\t\tvar str = map[key](data && JSON.parse('{' + data.replace(/[^,:]+/g, '\"$&\"') + '}'));\n\t\t\tif (attr) node.setAttribute(attr, str);\n\t\t\telse node.innerHTML = str;\n\t\t}\n\t}\n}\n\nfunction _log(msg, lvl) {\n\tif (window.console) switch (lvl) {\n\t\tcase 'error': console.error(msg); break;\n\t\tcase 'warn':  console.warn(msg); break;\n\t\tdefault:      console.log(msg);\n\t}\n}\n\nfunction _el(id) { return id && document.getElementById(id); }\n\nfunction _new_elem(tag, cl, text, hide) {\n\tvar e = document.createElement(tag);\n\tif (cl) e.className = cl;\n\tif (text) e.textContent = text;\n\tif (hide) e.style.display = 'none';\n\treturn e;\n}\n\nKonOpas.link_to_short_url = function(url) {\n\tvar u = encodeURIComponent(url.replace(/^http:\\/\\//, ''));\n\treturn 'http://is.gd/create.php?url=' + u;\n}\nKonOpas.link_to_qr_code = function(url) {\n\tvar u = encodeURIComponent(url.replace(/^http:\\/\\//, ''));\n\treturn 'http://chart.apis.google.com/chart?cht=qr&chs=350x350&chl=' + u;\n}\n\nKonOpas.hash_encode = function(s) { return encodeURIComponent(s).replace(/%20/g, '+'); }\nKonOpas.hash_decode = function(s) { return decodeURIComponent(s.replace(/\\+/g, '%20')); }\n\nKonOpas.glob_to_re = function(pat) {\n\tvar re_re = new RegExp('[.\\\\\\\\+*?\\\\[\\\\^\\\\]$(){}=!<>|:\\\\/-]', 'g');\n\tpat = pat.replace(re_re, '\\\\$&').replace(/\\\\\\*/g, '.*').replace(/\\\\\\?/g, '.');\n\tvar terms = pat.match(/\"[^\"]*\"|'[^']*'|\\S+/g).map(function(el){\n\t\treturn '\\\\b' + el.replace(/^(['\"])(.*)\\1$/, '$2\\\\b');\n\t});\n\treturn new RegExp(terms.join('|'), 'i');\n}\n\n\n// ------------------------------------------------------------------------------------------------ storage\n\nKonOpas.Store = function(id) {\n\ttry {\n\t\tsessionStorage.setItem('konopas.test_var', '1');\n\t\tsessionStorage.removeItem('konopas.test_var', '1');\n\t\tthis.get = function(k) {\n\t\t\tvar v = sessionStorage.getItem('konopas.' + id + '.' + k);\n\t\t\treturn v ? JSON.parse(v) : v;\n\t\t}\n\t\tthis.set = function(k, v) {\n\t\t\tsessionStorage.setItem('konopas.' + id + '.' + k, JSON.stringify(v));\n\t\t}\n\t\tthis.limit = '';\n\t} catch (e) {\n\t\tvar data = {};\n\t\tthis.get = function(k) { return data[k]; };\n\t\tthis.set = function(k, v) { data[k] = v; };\n\t\tthis.limit = (e.name == 'SecurityError') ? 'FFcookies'\n\t\t\t\t   : ((e.code === DOMException.QUOTA_EXCEEDED_ERR) && (sessionStorage.length === 0)) ? 'IOSprivate'\n\t\t\t\t   : '?';\n\t}\n}\n\nKonOpas.VarStore = function() {\n\tvar data = {};\n\tthis.getItem = function(k) { return data[k]; };\n\tthis.setItem = function(k, v) { data[k] = v; };\n}\n\n\n// ------------------------------------------------------------------------------------------------ string generation\n\nKonOpas.clean_name = function(p, span_parts) {\n\tvar fn = '', ln = '';\n\tswitch (p.name.length) {\n\t\tcase 1:\n\t\t\tln = p.name[0];\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\tif (p.name[1]) {\n\t\t\t\tfn = p.name[0];\n\t\t\t\tln = p.name[1];\n\t\t\t} else {\n\t\t\t\tln = p.name[0];\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\tfn = p.name[2] + ' ' + p.name[0];\n\t\t\tln = p.name[1];\n\t\t\tbreak;\n\t\tcase 4:\n\t\t\tfn = p.name[2] + ' ' + p.name[0];\n\t\t\tln = p.name[1] + (p.name[3] ? ', ' + p.name[3] : '');\n\t\t\tbreak;\n\t}\n\treturn span_parts\n\t\t? '<span class=\"fn\">' + fn.trim() + '</span> <span class=\"ln\">' + ln.trim() + '</span>'\n\t\t: (fn + ' ' + ln).trim();\n}\n\nKonOpas.clean_links = function(p) {\n\tvar ok = false, o = {};\n\tif (p && ('links' in p)) {\n\t\tif (p.links.img || p.links.photo) {\n\t\t\tvar img = (p.links.img || p.links.photo).trim();\n\t\t\tif (/^www/.test(img)) img = 'http://' + img;\n\t\t\tif (/:\\/\\//.test(img)) { o['img'] = { 'tgt': img }; ok = true; }\n\t\t}\n\t\tif (p.links.url) {\n\t\t\tvar url = p.links.url.trim();\n\t\t\tif (!/:\\/\\//.test(url)) url = 'http://' + url;\n\t\t\to['URL'] = { 'tgt': url, 'txt': url.replace(/^https?:\\/\\//, '') };\n\t\t\tok = true;\n\t\t}\n\t\tif (p.links.fb) {\n\t\t\tvar fb = p.links.fb.trim().replace(/^(https?:\\/\\/)?(www\\.)?facebook.com(\\/#!)?\\//, '');\n\t\t\to['Facebook'] = { 'txt': fb };\n\t\t\tif (/[^a-zA-Z0-9.]/.test(fb) && !/^pages\\//.test(fb)) fb = 'search.php?q=' + encodeURI(fb).replace(/%20/g, '+');\n\t\t\to['Facebook']['tgt'] = 'https://www.facebook.com/' + fb;\n\t\t\tok = true;\n\t\t}\n\t\tif (p.links.twitter) {\n\t\t\tvar tw = p.links.twitter.trim().replace(/[@＠﹫]/g, '').replace(/^(https?:\\/\\/)?(www\\.)?twitter.com(\\/#!)?\\//, '');\n\t\t\to['Twitter'] = { 'txt': '@' + tw };\n\t\t\tif (/[^a-zA-Z0-9_]/.test(tw)) tw = 'search/users?q=' + encodeURI(tw).replace(/%20/g, '+');\n\t\t\to['Twitter']['tgt'] = 'https://www.twitter.com/' + tw;\n\t\t\tok = true;\n\t\t}\n\t}\n\treturn ok ? o : false;\n}\n\n\n// ------------------------------------------------------------------------------------------------ array comparison\n\nKonOpas.arrays_equal = function(a, b) {\n\tif (!a || !b) return false;\n\tif (a.length != b.length) return false;\n\tfor (var i = 0; i < a.length; ++i) {\n\t\tif (a[i] != b[i]) return false;\n\t}\n\treturn true;\n}\n\nKonOpas.array_overlap = function(a, b) {\n\tif (!a || !b) return 0;\n\tif (a.length > b.length) return KonOpas.array_overlap(b, a);\n\tvar n = 0, i, j;\n\tfor (i = 0; i < a.length; ++i) {\n\t\tfor (j = 0; j < b.length; ++j) if (a[i] == b[j]) { ++n; break; }\n\t}\n\treturn n;\n}\n\n\n// ------------------------------------------------------------------------------------------------ DOM manipulation\n\nKonOpas.popup_open = function(ev) {\n\tev = ev || window.event;\n\tif (ev.which != 1) return;\n\tvar src_el = ev.target, pop_el = src_el.nextElementSibling;\n\tif (!pop_el || !pop_el.classList.contains('popup')) {\n\t\tif (src_el.href && /\\.(gif|jpe?g|png)$/i.test(src_el.href)) {\n\t\t\tpop_el = _new_elem('img', 'popup');\n\t\t\tpop_el.src = src_el.href;\n\t\t\tsrc_el.parentNode.insertBefore(pop_el, src_el.nextSibling);\n\t\t} else return;\n\t}\n\tvar wrap_el = _new_elem('div', 'popup-wrap');\n\twrap_el.onclick = function() {\n\t\tpop_el.parentNode.removeChild(pop_el);\n\t\twrap_el.parentNode.removeChild(wrap_el);\n\t\tsrc_el.parentNode.insertBefore(pop_el, src_el.nextSibling);\n\t};\n\tvar pop_title = pop_el.getAttribute('data-title') || '';\n\tif (pop_title) wrap_el.appendChild(_new_elem('div', 'popup-title', pop_title));\n\tpop_el.parentNode.removeChild(pop_el);\n\twrap_el.appendChild(pop_el);\n\tdocument.body.appendChild(wrap_el);\n\tif (src_el.href) ev.preventDefault();\n}\n\nKonOpas.toggle_collapse = function(ev) {\n\tev = ev || window.event;\n\tvar title = ev.target, body = title && title.nextElementSibling;\n\tif (!body) return;\n\tif (window.getComputedStyle(body).getPropertyValue('display') == 'none') {\n\t\ttitle.classList.remove('collapse');\n\t\ttitle.classList.add('collapse-open');\n\t} else {\n\t\ttitle.classList.add('collapse');\n\t\ttitle.classList.remove('collapse-open');\n\t}\n}\n\n\n// ------------------------------------------------------------------------------------------------ time & date\n\nKonOpas.pretty_time = function(t, opt) {\n\tfunction pre0(n) { return (n < 10 ? '0' : '') + n; }\n\tfunction _pretty_time(h, m) {\n\t\tif (opt.time_show_am_pm) {\n\t\t\tvar h12 = h % 12; if (h12 == 0) h12 = 12;\n\t\t\tvar m_str = ((m == 0) && opt.abbrev_00_minutes ) ? '' : ':' + pre0(m);\n\t\t\treturn h12 + m_str + (h < 12 ? 'am' : 'pm');\n\t\t} else {\n\t\t\treturn pre0(h) + ':' + pre0(m);\n\t\t}\n\t}\n\topt = opt || {};\n\tif (t instanceof Date) {\n\t\treturn _pretty_time(t.getHours(), t.getMinutes());\n\t} else if (typeof t == 'string' || t instanceof String) {\n\t\tif (opt.time_show_am_pm) {\n\t\t\tvar a = t.split(':'); // hh:mm\n\t\t\treturn _pretty_time(parseInt(a[0], 10), parseInt(a[1], 10));\n\t\t} else return t;\n\t} else return '';\n}\n\nKonOpas.pretty_time_diff = function(t) {\n\tvar d = (Date.now() - t) / 1e3,\n\t    a = Math.abs(d),\n\t    s = [1, 60, 60, 24, 7, 4.333, 12, 1e9];\n\tif (a < 20) return i18n.txt('just now');\n\tfor (var i = 0, l = s.length; i < l; ++i) {\n\t\tif ((a /= s[i]) < 2) return i18n.txt('time_diff', { 'T':~~(a *= s[i]), 'T_UNIT':i-1, 'T_PAST':d>0 });\n\t}\n}\n\nKonOpas.parse_date = function(day_str) {\n\tif (!day_str) return false;\n\tvar a = day_str.match(/(\\d+)/g); if (!a || (a.length < 3)) return false;\n\tvar y = parseInt(a[0], 10), m = parseInt(a[1], 10), d = parseInt(a[2], 10);\n\tif (!y || !m || !d) return false;\n\treturn new Date(y, m - 1, d, 12);\n}\n\nKonOpas.data_date = function(d) {\n\tfunction pre0(n) { return (n < 10 ? '0' : '') + n; }\n\tvar t = (d instanceof Date) ? d : KonOpas.parse_date(d);\n\treturn t.getFullYear() + '-' + pre0(t.getMonth() + 1) + '-' + pre0(t.getDate());\n}\n\nKonOpas.pretty_date = function(d, opt) {\n\topt = opt || {};\n\tvar o = { weekday: \"long\", month: \"long\", day: \"numeric\" },\n\t    t = (d instanceof Date) ? d : KonOpas.parse_date(d);\n\tif (!t) return d;\n\tif (Math.abs(t - Date.now()) > 1000*3600*24*60) o.year = \"numeric\";\n\tvar s = t.toLocaleDateString(opt.lc, o);\n\treturn s.charAt(0).toUpperCase() + s.slice(1);\n}\n\nKonOpas.time_sum = function(t0_str, m_str) {\n\tvar t = 60 * t0_str.substr(0,2) + 1 * t0_str.substr(3,2) + 1 * m_str,\n\t    h = (t / 60) >> 0,\n\t    m = t - 60 * h;\n\treturn '' + (h % 24) + ':' + (m<10?'0':'') + m;\n}\n"]}