{"version":3,"sources":["dist/konopas.js"],"names":["KonOpas","set","this","id","lc","tag_categories","default_duration","time_show_am_pm","abbrev_00_minutes","always_show_participants","max_items_per_page","non_ascii_people","people_per_screen","use_server","log_messages","cache_refresh_interval_mins","views","i","_log","i18n","txt","key","data","bind","translate_html","alert","Array","prototype","indexOf","filter","map","Date","now","window","store","Store","stars","Stars","server","Server","item","Item","info","Info","fram","Fram","onhashchange","set_view","pl","document","getElementsByClassName","length","addEventListener","popup_open","_el","refresh_cache","msg","lvl","console","error","warn","log","getElementById","_new_elem","tag","cl","text","hide","e","createElement","className","textContent","style","display","G","en","n","c","d","k","Error","o","isNaN","v","p","l","other","s","Program","weekday_n","0","1","2","3","4","5","6","weekday_short_n","month_n","7","8","9","10","11","time_diff","true","search_example","no_ko_id","old_browser","item_not_found","item_tags","tags","track","type","star_export_this","star_export_share","star_import_this","star_import_diff","one","star_import_bad","star_set","add_n","discard_n","star_add","star_export_link","star_hint","star_no_memory","FFcookies","IOSprivate","filter_sum_id","filter_sum","undefined","day_link","hidden_link","server_cmd_fail","post_author","ical_login","ical_link","ical_hint","ical_make","login_why","set_program","list","opt","program","Prog","set_people","people","Part","view","location","hash","substr","tabs","classList","remove","add","show","body","t_interval","cache","applicationCache","status","UPDATEREADY","onclick","reload","UNCACHED","setInterval","update","innerHTML","lu","lu_time","self","cache_manifest","parentNode","getAttribute","protocol","x","XMLHttpRequest","onload","getResponseHeader","show_updated","open","send","toggle_collapse","span","getElementsByTagName","pretty_time_diff","title","toLocaleString","ev","event","target","tmp","list_click","scrollIntoView","navigator","userAgent","match","scroll","top","day","day_txt","t_el","s_el","times","onscroll","scroll_time","show_extra","html","a","konopas","el","ID","it","forEach","t","cat","tgt","split","shift","join","link","push","T","hash_encode","name","desc","extra","cal","ics","uuid","starttime","date","time","endtime","addEvent","room","download","stopPropagation","appendChild","new","_loc_str","loc","slice","mins","pretty_time","time_sum","frame","star","org","organizer","isspecial","cloneNode","show_list","ls","_day_link","day_links","N","day_lengths","D","parse_date","getDay","scrollTo","_now","frag","createDocumentFragment","prev_date","prev_time","_list_item","show_all","hide_ended","t1","n_hidden","pretty_date","t0","setAttribute","n_listed","days","day_now","data_date","insertBefore","firstChild","LS","removeChild","expand_all","items","exp_txt","star_els","toggle","prog_view","d_s","d_n","d_click","li","dt","focus_day","d_set","div","len","ul","show_filter_sum","is_link","test","tagName","toLowerCase","href","S","st_len","scroll_top","pageYOffset","offsetTop","day0","day1","sortname","replace","make_ascii","sort","b","localeCompare","set_ranges","bin_size","_range_set","nr","startChar","charAt","name_range","participant","update_view","_firstletter","toUpperCase","fn","ln","ranges","ends","start","n_bins","Math","round","n_up","n_down","String","fromCharCode","charCodeAt","nl_type","name_in_range","n0","range","show_one","p_name","clean_name","links","img","clean_links","onLine","bio","prog","lp","p_id","ll","querySelectorAll","cmd","some","get","contains","hash_decode","pa","r","trim","Function","oThis","TypeError","aArgs","call","arguments","fToBind","fNOP","fBound","apply","concat","toLocaleDateString","_orig_toLocaleDateString","locale","options","w","getDate","m","getMonth","year","getFullYear","normalize","str","toString","norm_map","A","AA","AE","AO","AU","AV","AY","B","C","DZ","Dz","E","F","H","I","J","K","L","LJ","Lj","M","NJ","Nj","O","OI","OO","OU","P","Q","R","TZ","U","V","VY","W","X","Y","Z","aa","ae","ao","au","av","ay","dz","f","g","h","hv","j","lj","nj","oi","ou","oo","q","tz","u","vy","y","z","elemCtrProto","HTMLElement","Element","objCtr","Object","strTrim","arrIndexOf","DOMEx","message","code","DOMException","checkTokenAndGetIndex","token","ClassList","elem","trimmedClasses","classes","_updateClassName","classListProto","classListGetter","index","splice","defineProperty","classListPropDesc","enumerable","configurable","ex","number","__defineGetter__","_sort","Number","valueOf","pf","filter_change","nextElementSibling","sf","onsubmit","oninput","onreset","set_filters","init_filters","pt","preventDefault","excl","RegExp","get_filters","hash_only","filters","area","query","h_set","tag_re","hasOwnProperty","silent","history","replaceState","value","popups","day-sidebar","day-narrow","_d","_txt","_ul","_li","par","labels","regexp","_compare","af","_a","_b","bb","_ul2","prefix","root","hiddenFilterCategories","_fill","promote","exclude","re","min_count","keys","categories","list_in","list_out","filter_el","areas","loc_level","t_s","set_category","d_re","d_d","short","long","fs","cb","unset","id_only","TITLE","disabled","ALL","tag_str","area_str","query_str","TAG","_filter","prev","glob_to_re","every","host","el_id","err_el_id","localStorage","VarStore","connected","getItem","ical","prog_data","prog_server_mtime","err_el","disconnect","exec","decodeURIComponent","logout","url","CMD","onmessage","origin","JSON","parse","cb_ok","prog_mtime","mtime","add_prog","add_star","set_prog","star_list","show_ical_link","p_el","A_TAG","i_el","encodeURIComponent","script","done","src","async","onerror","onreadystatechange","readyState","setItem","write","stringify","parseInt","cb_fail","cb_info","email","jsErrLog","cb_token","cb_login","cb_my_prog","sync","cb_my_votes","cb_pub_data","cb_show_comments","cb_ical_link","sessionStorage","read","QUOTA_EXCEEDED_ERR","floor","new_data","local_mod","redraw","server_add","server_rm","set_raw","set_len","stars_len","limit","WHY","SERVER","set_link","arrays_equal","THIS","SHORT","link_to_short_url","QR","link_to_qr_code","n_same","array_overlap","n_new","n_bad","PREV","NEW","SAME","BAD","URL","el_set","el_add","node","attr","pat","re_re","terms","removeItem","span_parts","ok","photo","fb","encodeURI","twitter","tw","which","src_el","pop_el","nextSibling","wrap_el","pop_title","getComputedStyle","getPropertyValue","pre0","_pretty_time","h12","getHours","getMinutes","abs","T_UNIT","T_PAST","day_str","weekday","month","t0_str","m_str"],"mappings":"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","file":"dist/konopas.min.js","sourcesContent":["/**\n * KonOpas -- http://konopas.org/ & https://github.com/eemeli/konopas\n * Copyright (c) 2013-2015 by Eemeli Aro <eemeli@gmail.com>\n * \n * Permission to use, copy, modify, and/or distribute this software for any\n * purpose with or without fee is hereby granted, provided that the above\n * copyright notice and this permission notice appear in all copies.\n * \n * The software is provided \"as is\" and the author disclaims all warranties\n * with regard to this software including all implied warranties of\n * merchantability and fitness. In no event shall the author be liable for\n * any special, direct, indirect, or consequential damages or any damages\n * whatsoever resulting from loss of use, data or profits, whether in an\n * action of contract, negligence or other tortious action, arising out of\n * or in connection with the use or performance of this software.\n * @license\n */\n\"use strict\";\n(function(G){G['i18n']={lc:{\"en\":function(n){return n===1?\"one\":\"other\"}},\nc:function(d,k){if(!d)throw new Error(\"MessageFormat: Data required for '\"+k+\"'.\")},\nn:function(d,k,o){if(isNaN(d[k]))throw new Error(\"MessageFormat: '\"+k+\"' isn't a number.\");return d[k]-(o||0)},\nv:function(d,k){i18n.c(d,k);return d[k]},\np:function(d,k,o,l,p){i18n.c(d,k);return d[k] in p?p[d[k]]:(k=i18n.lc[l](d[k]-o),k in p?p[k]:p.other)},\ns:function(d,k,p){i18n.c(d,k);return d[k] in p?p[d[k]]:p.other}}\ni18n[\"en\"]={\n\"Program\":function(d){return \"Programme\"},\n\"weekday_n\":function(d){return i18n.p(d,\"N\",0,\"en\",{\"0\":\"Sunday\",\"1\":\"Monday\",\"2\":\"Tuesday\",\"3\":\"Wednesday\",\"4\":\"Thursday\",\"5\":\"Friday\",\"6\":\"Saturday\",\"other\":\"???\"})},\n\"weekday_short_n\":function(d){return i18n.p(d,\"N\",0,\"en\",{\"0\":\"Sun\",\"1\":\"Mon\",\"2\":\"Tue\",\"3\":\"Wed\",\"4\":\"Thu\",\"5\":\"Fri\",\"6\":\"Sat\",\"other\":\"???\"})},\n\"month_n\":function(d){return i18n.p(d,\"N\",0,\"en\",{\"0\":\"January\",\"1\":\"February\",\"2\":\"March\",\"3\":\"April\",\"4\":\"May\",\"5\":\"June\",\"6\":\"July\",\"7\":\"August\",\"8\":\"September\",\"9\":\"October\",\"10\":\"November\",\"11\":\"December\",\"other\":\"???\"})},\n\"time_diff\":function(d){return i18n.v(d,\"T\")+\" \"+i18n.p(d,\"T_UNIT\",0,\"en\",{\"0\":\"seconds\",\"1\":\"minutes\",\"2\":\"hours\",\"3\":\"days\",\"4\":\"weeks\",\"5\":\"months\",\"6\":\"years\",\"other\":\"???\"})+\" \"+i18n.s(d,\"T_PAST\",{\"true\":\"ago\",\"other\":\"from now\"})},\n\"search_example\":function(d){return \"For example, you could try <b>\"+i18n.v(d,\"X\")+\"</b>\"},\n\"no_ko_id\":function(d){return \"No ID set! Please assign konopas_set.id a unique identifier.\"},\n\"old_browser\":function(d){return \"Unfortunately, your browser doesn't support some of the Javascript features required by KonOpas. To use, please try a different browser.\"},\n\"item_not_found\":function(d){return \"Programme id <b>\"+i18n.v(d,\"ID\")+\"</b> not found!\"},\n\"item_tags\":function(d){return i18n.s(d,\"T\",{\"tags\":\"Tags\",\"track\":\"Track\",\"type\":\"Type\",\"other\":i18n.v(d,\"T\")})},\n\"star_export_this\":function(d){return \"Your current selection is encoded in <a href=\\\"\"+i18n.v(d,\"THIS\")+\"\\\" target=\\\"_blank\\\">this page's URL</a>, which you may open elsewhere to share your selection.\"},\n\"star_export_share\":function(d){return \"For easier sharing, you can also generate a <a href=\\\"\"+i18n.v(d,\"SHORT\")+\"\\\">shorter link</a> or a <a href=\\\"\"+i18n.v(d,\"QR\")+\"\\\">QR code</a>.\"},\n\"star_import_this\":function(d){return \"Your previously selected items are shown with a highlighted interior, while those imported via <a href=\\\"\"+i18n.v(d,\"THIS\")+\"\\\">this link</a> have a highlighted border.\"},\n\"star_import_diff\":function(d){return \"Your previous selection \"+i18n.p(d,\"PREV\",0,\"en\",{\"0\":\"was empty\",\"one\":\"had one item\",\"other\":\"had \"+i18n.n(d,\"PREV\")+\" items\"})+\", and the imported selection has \"+i18n.p(d,\"NEW\",0,\"en\",{\"0\":\"no new items\",\"one\":\"one new item\",\"other\":i18n.n(d,\"NEW\")+\" new items\"})+\" \"+i18n.p(d,\"SAME\",0,\"en\",{\"0\":\"\",\"one\":\"and one which was already selected\",\"other\":\"and \"+i18n.n(d,\"SAME\")+\" which were already selected\"})+\".\"},\n\"star_import_bad\":function(d){return i18n.p(d,\"BAD\",0,\"en\",{\"0\":\"\",\"one\":\"One of the imported items had an invalid ID.\",\"other\":i18n.n(d,\"BAD\")+\" of the imported items had invalid IDs.\"})},\n\"star_set\":function(d){return \"Set my selection to the imported selection\"},\n\"add_n\":function(d){return \"add \"+i18n.v(d,\"N\")},\n\"discard_n\":function(d){return \"discard \"+i18n.v(d,\"N\")},\n\"star_add\":function(d){return \"Add the \"+i18n.p(d,\"N\",0,\"en\",{\"one\":\"new item\",\"other\":i18n.n(d,\"N\")+\" new items\"})+\" to my selection\"},\n\"star_export_link\":function(d){return \"<a href=\\\"\"+i18n.v(d,\"URL\")+\"\\\">Export selection</a> (\"+i18n.p(d,\"N\",0,\"en\",{\"one\":\"one item\",\"other\":i18n.n(d,\"N\")+\" items\"})+\")\"},\n\"star_hint\":function(d){return \"To \\\"star\\\" a programme item, click on the square next to it. Your selections will be remembered, and shown in this view. You currently don't have any programme items selected, so this list is empty.\"},\n\"star_no_memory\":function(d){return i18n.s(d,\"WHY\",{\"FFcookies\":\"It looks like you're using a Firefox browser with cookies disabled, so \",\"IOSprivate\":\"It looks like you're using an iOS or Safari browser in private mode, so \",\"other\":\"For some reason,\"})+\" your <a href=\\\"http://en.wikipedia.org/wiki/Web_storage\\\">localStorage</a> is not enabled, and therefore your selection will not be remembered between sessions. \"+i18n.s(d,\"SERVER\",{\"true\":\"Please <span class=\\\"js-link\\\" onclick=\\\"var e=_el('login-popup-link');if(e)e.click();\\\">login</span> to enable persistent storage.\",\"other\":\"\"})},\n\"filter_sum_id\":function(d){return \"Listing \"+i18n.p(d,\"N\",0,\"en\",{\"one\":\"one item: \"+i18n.v(d,\"TITLE\"),\"other\":i18n.n(d,\"N\")+\" items with id \"+i18n.v(d,\"ID\")})},\n\"filter_sum\":function(d){return \"Listing \"+i18n.p(d,\"N\",0,\"en\",{\"one\":\"one\",\"other\":i18n.v(d,\"ALL\")+\" \"+i18n.n(d,\"N\")})+\" \"+i18n.s(d,\"LIVE\",{\"undefined\":\"\",\"other\":\"current and future\"})+\" \"+i18n.v(d,\"TAG\")+\" \"+i18n.p(d,\"N\",0,\"en\",{\"one\":\"item\",\"other\":\"items\"})+\" \"+i18n.s(d,\"DAY\",{\"undefined\":\"\",\"other\":\"on \"+i18n.v(d,\"DAY\")+\" \"+i18n.s(d,\"TIME\",{\"undefined\":\"\",\"other\":\"after \"+i18n.v(d,\"TIME\")})})+\" \"+i18n.s(d,\"AREA\",{\"undefined\":\"\",\"other\":\"in \"+i18n.v(d,\"AREA\")})+\" \"+i18n.s(d,\"Q\",{\"undefined\":\"\",\"other\":\"matching the query \"+i18n.v(d,\"Q\")})},\n\"day_link\":function(d){return \"Show \"+i18n.v(d,\"N\")+\" matching items from \"+i18n.p(d,\"D\",0,\"en\",{\"0\":\"Sunday\",\"1\":\"Monday\",\"2\":\"Tuesday\",\"3\":\"Wednesday\",\"4\":\"Thursday\",\"5\":\"Friday\",\"6\":\"Saturday\",\"other\":\"???\"})},\n\"hidden_link\":function(d){return \"Show \"+i18n.v(d,\"N\")+\" more matching items with an end time before \"+i18n.v(d,\"T\")+\" on \"+i18n.p(d,\"D\",0,\"en\",{\"0\":\"Sunday\",\"1\":\"Monday\",\"2\":\"Tuesday\",\"3\":\"Wednesday\",\"4\":\"Thursday\",\"5\":\"Friday\",\"6\":\"Saturday\",\"other\":\"???\"})},\n\"server_cmd_fail\":function(d){return \"The command \\\"\"+i18n.v(d,\"CMD\")+\"\\\" failed.\"},\n\"post_author\":function(d){return i18n.v(d,\"N\")+\" posted…\"},\n\"ical_login\":function(d){return \"To make your selection available in external calendars, please <span class=\\\"js-link\\\" onclick=\\\"var e=_el('login-popup-link');if(e)e.click();\\\">login</span>.\"},\n\"ical_link\":function(d){return \"Your selection is available as an iCal (.ics) calendar at:\"},\n\"ical_hint\":function(d){return \"Note that changes you make in this guide may not show up immediately in your external calendar software.\"},\n\"ical_make\":function(d){return \"To view your selection in your calendar app, you may also <br class=\\\"wide-only\\\">\"+i18n.v(d,\"A_TAG\")+\"make it available</a> in iCal (.ics) calendar format\"},\n\"login_why\":function(d){return \"Once you've verified your e-mail address, you'll be able to sync your data between different clients (including external calendars). After signing in, no information will be transmitted to these external services.\"}}\n})(this);\nfunction KonOpas(set) {\n\tthis.id = '';\n\tthis.lc = 'en';\n\tthis.tag_categories = false;\n\tthis.default_duration = 60;\n\tthis.time_show_am_pm = false;\n\tthis.abbrev_00_minutes = true; // only for am/pm time\n\tthis.always_show_participants = false;\n\tthis.max_items_per_page = 200;\n\tthis.non_ascii_people = false; // setting true enables correct but slower sort\n\tthis.people_per_screen = 100;\n\tthis.use_server = false;\n\tthis.log_messages = true;\n\tthis.cache_refresh_interval_mins = 60;\n\tthis.views = [ \"star\", \"prog\", \"part\", \"info\", \"fram\" ];\n\tif (typeof set == 'object') for (var i in set) this[i] = set[i];\n\n\tif (!this.log_messages) _log = function(){};\n\tif (i18n[this.lc]) {\n\t\ti18n.txt = function(key, data){ return key in i18n[this.lc] ? i18n[this.lc][key](data) : key; }.bind(this);\n\t\ti18n.translate_html(i18n[this.lc], 'data-txt');\n\t} else alert('Locale \"' + this.lc + '\" not found.');\n\tif (!this.id) alert(i18n.txt('no_ko_id'));\n\tif (!Array.prototype.indexOf || !Array.prototype.filter || !Array.prototype.map\n\t\t|| !Date.now || !('localStorage' in window)) alert(i18n.txt('old_browser'));\n\n\tthis.store = new KonOpas.Store(this.id);\n\tthis.stars = new KonOpas.Stars(this.id);\n\tthis.server = this.use_server && KonOpas.Server && new KonOpas.Server(this.id, this.stars);\n\tthis.item = new KonOpas.Item();\n\tthis.info = new KonOpas.Info();\n\tthis.fram = new KonOpas.Fram();\n\twindow.onhashchange = this.set_view.bind(this);\n\tvar pl = document.getElementsByClassName('popup-link');\n\tfor (var i = 0; i < pl.length; ++i) pl[i].addEventListener('click', KonOpas.popup_open);\n\tif (_el('refresh')) window.addEventListener('load', this.refresh_cache.bind(this), false);\n}\n\nKonOpas.prototype.set_program = function(list, opt) { this.program = new KonOpas.Prog(list, opt); }\nKonOpas.prototype.set_people = function(list) { this.people = new KonOpas.Part(list, this); }\n\nKonOpas.prototype.set_view = function() {\n\tvar view = window.location.hash.substr(1, 4), tabs = _el('tabs');\n\tif (!this.program || !this.program.list.length) {\n\t\tview = 'info';\n\t\ttabs.style.display = 'none';\n\t\tthis.info.show();\n\t\tif (this.server) this.server.error('Programme loading failed!');\n\t} else {\n\t\ttabs.style.display = 'block';\n\t\tif (!this.people || !this.people.list.length) {\n\t\t\ttabs.classList.add('no-people');\n\t\t\tif (view == 'part') view = '';\n\t\t} else {\n\t\t\ttabs.classList.remove('no-people');\n\t\t}\n\t\tswitch (view) {\n\t\t\tcase 'part': this.people.show();  break;\n\t\t\tcase 'star': this.stars.show();   break;\n\t\t\tcase 'info': this.info.show();    break;\n\t\t\tcase 'fram': this.fram.show();    break;\n\t\t\tdefault:     this.program.show(); view = 'prog';\n\t\t}\n\t}\n\tfor (var i = 0; i < this.views.length; ++i) {\n\t\tdocument.body.classList[view == this.views[i] ? 'add' : 'remove'](this.views[i]);\n\t}\n\tif (_el('load_disable')) _el('load_disable').style.display = 'none';\n}\n\nKonOpas.prototype.refresh_cache = function() {\n\tvar t_interval = this.cache_refresh_interval_mins * 60000,\n\t    cache = window.applicationCache;\n\tif (!t_interval || (t_interval < 0)) return;\n\tcache.addEventListener('updateready', function() {\n\t\tif (cache.status == cache.UPDATEREADY) {\n\t\t\t_el('refresh').classList.add('enabled');\n\t\t\t_el('refresh').onclick = function() { window.location.reload(); };\n\t\t}\n\t}, false);\n\tif (cache.status != cache.UNCACHED) {\n\t\twindow.setInterval(function() { cache.update(); }, t_interval);\n\t}\n}\nKonOpas.Fram = function() {\n}\n\nKonOpas.Fram.prototype.show = function() {\n    _el(\"prog_ls\").innerHTML = \"\";\n}\n\nKonOpas.Info = function() {\n\tthis.lu = _el('last-updated');\n\tthis.lu_time = 0;\n\tvar self = this, cache_manifest = document.body.parentNode.getAttribute('manifest');\n\tif (this.lu && cache_manifest && ((location.protocol == 'http:') || (location.protocol == 'https:'))) {\n\t\tvar x = new XMLHttpRequest();\n\t\tx.onload = function() {\n\t\t\tself.lu_time = new Date(this.getResponseHeader(\"Last-Modified\"));\n\t\t\tself.show_updated();\n\t\t};\n\t\tx.open('GET', cache_manifest, true);\n\t\tx.send();\n\t}\n\tvar cl = _el('info_view').getElementsByClassName('collapse');\n\tfor (var i = 0; i < cl.length; ++i) {\n\t\tcl[i].onclick = KonOpas.toggle_collapse;\n\t}\n}\n\nKonOpas.Info.prototype.show_updated = function() {\n\tif (!this.lu || !this.lu_time) return;\n\tvar span = this.lu.getElementsByTagName('span')[0];\n\tspan.textContent = KonOpas.pretty_time_diff(this.lu_time);\n\tspan.title = this.lu_time.toLocaleString();\n\tspan.onclick = function(ev) {\n\t\tvar self = (ev || window.event).target;\n\t\tvar tmp = self.title;\n\t\tself.title = self.textContent;\n\t\tself.textContent = tmp;\n\t};\n\tthis.lu.style.display = 'inline';\n}\n\nKonOpas.Info.prototype.show = function() {\n\t_el(\"prog_ls\").innerHTML = \"\";\n\tthis.show_updated();\n}\n\nKonOpas.Item = function() {\n\t_el('prog_ls').onclick = KonOpas.Item.list_click;\n\tif (_el('scroll_link')) {\n\t\t_el('scroll_link').onclick = function() { _el('top').scrollIntoView(); return false; };\n\t\tif (window.navigator && navigator.userAgent.match(/Android [12]/)) {\n\t\t\t_el('time').style.display = 'none';\n\t\t\t_el('scroll').style.display = 'none';\n\t\t} else {\n\t\t\tthis.scroll = {\n\t\t\t\t'i': 0, 'top': 0,\n\t\t\t\t'day': '', 'day_txt': '',\n\t\t\t\t't_el': _el('time'), 's_el': _el('scroll'),\n\t\t\t\t'times': document.getElementsByClassName('new_time')\n\t\t\t};\n\t\t\twindow.onscroll = this.scroll_time.bind(this);\n\t\t}\n\t}\n}\n\nKonOpas.Item.show_extra = function(item, id) {\n\tfunction _tags(it) {\n\t\tif (!it.tags || !it.tags.length) return '';\n\t\tvar o = {};\n\t\tit.tags.forEach(function(t) {\n\t\t\tvar cat = 'tags';\n\t\t\tvar tgt = KonOpas.Prog.hash({'tag': t});\n\t\t\tvar a = t.split(':');\n\t\t\tif (a.length > 1) { cat = a.shift(); t = a.join(':'); }\n\t\t\tvar link = '<a href=\"' + tgt + '\">' + t + '</a>'\n\t\t\tif (o[cat]) o[cat].push(link);\n\t\t\telse o[cat] = [link];\n\t\t});\n\t\tvar a = []; for (var k in o) a.push(i18n.txt('item_tags', {'T':k}) + ': ' + o[k].join(', '));\n\t\treturn '<div class=\"discreet\">' + a.join('<br>') + '</div>\\n';\n\t}\n\tfunction _people(it) {\n\t\tif (!it.people || !it.people.length) return '';\n\t\tvar a = it.people.map(!konopas.people || !konopas.people.list.length\n\t\t\t? function(p) { return p.name; }\n\t\t\t: function(p) { return \"<a href=\\\"#part/\" + KonOpas.hash_encode(p.id) + \"\\\">\" + p.name + \"</a>\"; }\n\t\t);\n\t\treturn '<div class=\"item-people\">' + a.join(', ') + '</div>\\n';\n\t}\n\n\tif (_el(\"e\" + id)) return;\n\tvar html = \"\";\n\tvar a = konopas.program.list.filter(function(el) { return el.id == id; });\n\tif (a.length < 1) html = i18n.txt('item_not_found', {'ID':id});\n\telse {\n\t\thtml = _tags(a[0]) + _people(a[0]);\n\t\tif (a[0].desc) html += \"<p>\" + a[0].desc;\n\t\thtml += '<a href=\"#prog/id:' + a[0].id + '\" class=\"permalink\" title=\"' + i18n.txt('Permalink') + '\"></a>';\n\t}\n\tvar extra = _new_elem('div', 'extra');\n\textra.id = 'e' + id;\n\textra.innerHTML = html;\n\n\tvar cal = _new_elem('div', 'callink');\n\tcal.onclick = function(e){\n\t\tvar c = window.ics(uuid());\n\t\tvar starttime = new Date(a[0].date + \" \" + a[0].time + \" GMT+1\");\n\t\tvar endtime = new Date(a[0].date + \"T\" + a[0].time + \" GMT+1\");\n\t\tc.addEvent(a[0].title, a[0].desc, a[0].room, starttime, endtime);\n\t\tc.download(\"coy13-event\");\n\t\te.stopPropagation();\n\t}\n\textra.appendChild(cal);\n\titem.appendChild(extra);\n}\n\nKonOpas.Item.new = function(it) {\n// This function is horrible... why is it..\n\n// namespace.functionName = function(data){\n    \n//     var state = new State();\n\n//     namespace.functionName = function(data){\n//         mutate(state); \t\t\t// mutate must be idempotent\n//         return copy(state);\n//     }\n//     return functionName(data);\n// }\n\n// instead of...\n\n// namespace.functionName = function(data){\n//     var state = new State();\n//     mutate(state) \t\t\t// mutate must be idempotent\n//     return state;\n// }\n\n\tfunction _loc_str(it) {\n\t\tvar s = '';\n\t\tif (it.loc && it.loc.length) {\n\t\t\ts = it.loc[0];\n\t\t\tif (it.loc.length > 1) s += ', ' + it.loc.slice(1).join(', ');\n\t\t}\n\t\tif (it.mins && (it.mins != konopas.default_duration)) {\n\t\t\tif (s) s += ', ';\n\t\t\ts += KonOpas.pretty_time(it.time, konopas) + ' - ' + KonOpas.pretty_time(KonOpas.time_sum(it.time, it.mins), konopas);\n\t\t}\n\t\treturn s;\n\t}\n\tvar frame = _new_elem('div', 'item_frame');\n\tvar star  = frame.appendChild(_new_elem('div', 'item_star'));\n\tvar item  = frame.appendChild(_new_elem('div', 'item'));\n\tvar title = item.appendChild(_new_elem('div', 'title'));\n\t// Hack to add Organizer element\n\tvar org = item.appendChild(_new_elem('div', 'organizer'))\n\tvar loc   = item.appendChild(_new_elem('div', 'loc'));\n\n\t\n\n\tKonOpas.Item.new = function(it) {\n\t\tstar.id = 's' + it.id;\n\t\titem.id = 'p' + it.id;\n\t\ttitle.textContent = it.title;\n\t\tloc.textContent = _loc_str(it);\n\t\torg.textContent = it.organizer;\n\n\t\t// You have to assign it both ways because we are modifying\n\t\t// a single node that is closured in each time we call this\n\t\t// function before cloning it... This is horrible.\n\t\tif (it.isspecial){\n\t\t\tframe.className = \"item_frame special\";\n\t\t} else {\n\t\t\tframe.className = \"item_frame\";\n\t\t}\n\t\treturn frame.cloneNode(true);\n\t};\n\treturn KonOpas.Item.new(it);\n}\n\nKonOpas.Item.show_list = function(ls, opt) {\n\tvar\t_now = Date.now(),\n\t\tday_lengths = {}, day_links = {},\n\t\tfrag = document.createDocumentFragment(),\n\t\tprev_date = '', prev_time = '',\n\t\t_list_item = function(p) {\n\t\t\tif (opt.day && p.date) {\n\t\t\t\tday_lengths[p.date] = (day_lengths[p.date] || 0) + 1;\n\t\t\t}\n\t\t\tif (opt.show_all || !opt.day || !p.date || (p.date == opt.day)) {\n\t\t\t\tif (this.hide_ended && p.t1 && (p.t1 < opt.now)) { ++opt.n_hidden; return; }\n\t\t\t\tif (p.date != prev_date) {\n\t\t\t\t\tprev_date = p.date;\n\t\t\t\t\tprev_time = '';\n\t\t\t\t\tfrag.appendChild(_new_elem('div', 'new_day', KonOpas.pretty_date(p.t0 || p.date, konopas))).id = 'dt_' + p.date;\n\t\t\t\t}\n\t\t\t\tif (p.time != prev_time) {\n\t\t\t\t\tprev_time = p.time;\n\t\t\t\t\tfrag.appendChild(document.createElement('hr'));\n\t\t\t\t\tfrag.appendChild(_new_elem('div', 'new_time', KonOpas.pretty_time(p.t0 || p.time, konopas)))\n\t\t\t\t\t\t.setAttribute('data-day', p.date);\n\t\t\t\t}\n\t\t\t\tfrag.appendChild(KonOpas.Item.new(p));\n\t\t\t\t++opt.n_listed;\n\t\t\t}\n\t\t};\n\tif (!opt) opt = {};\n\topt.show_all = (ls.length <= konopas.max_items_per_page);\n\topt.n_hidden = 0; opt.n_listed = 0;\n\topt.now = new Date(_now + 10*60000 - _now % (10*60000));\n\tif (!opt.day || !konopas.program.days[opt.day]) {\n\t\tvar day_now = KonOpas.data_date(opt.now);\n\t\tif (konopas.program.days[day_now]) opt.day = day_now;\n\t\telse { opt.day = ''; for (opt.day in konopas.program.days) break; }\n\t}\n\tif (ls.length > (opt.id ? 1 : 0)) {\n\t\tfrag.appendChild(_new_elem('div', 'item_expander', '» '))\n\t\t\t.appendChild(_new_elem('a', 'js-link', i18n.txt('Expand all')))\n\t\t\t.id = 'item_expander_link';\n\t}\n\tls.forEach(_list_item, {hide_ended:opt.hide_ended});\n\tif (!opt.n_listed && opt.n_hidden) {\n\t\tday_lengths = {};\n\t\topt.n_hidden = 0; opt.n_listed = 0;\n\t\tprev_date = ''; prev_time = '';\n\t\tls.forEach(_list_item, {hide_ended:false});\n\t}\n\n\tfunction _day_link(t) {\n\t\tvar d = day_links[t],\n\t\t    txt = i18n.txt('day_link', {\n\t\t\t\t'N': day_lengths[d],\n\t\t\t\t'D': KonOpas.parse_date(d).getDay()\n\t\t\t}),\n\t\t    link = _new_elem('a', 'day-link js-link', txt);\n\t\tlink.id = t + '_day_link';\n\t\tlink.onclick = function() {\n\t\t\tif (t == 'next') window.scrollTo(0, 0);\n\t\t\topt.day = d;\n\t\t\tKonOpas.Item.show_list(ls, opt);\n\t\t};\n\t\treturn link;\n\t}\n\tfunction _hidden_link() {\n\t\tvar\ttxt = i18n.txt('hidden_link', {\n\t\t\t\t'N': opt.n_hidden,\n\t\t\t\t'T': KonOpas.pretty_time(opt.now, konopas),\n\t\t\t\t'D': opt.now.getDay()\n\t\t\t}),\n\t\t    link = _new_elem('a', 'day-link js-link', txt);\n\t\tlink.id = 'hidden_day_link';\n\t\tlink.onclick = function() {\n\t\t\topt.hide_ended = false;\n\t\t\topt.day = KonOpas.data_date(opt.now);\n\t\t\tKonOpas.Item.show_list(ls, opt);\n\t\t};\n\t\treturn link;\n\t}\n\tif (opt.day && !opt.show_all) for (var d in day_lengths) if (d in konopas.program.days) {\n\t\tif (d < opt.day) day_links['prev'] = d;\n\t\telse if ((d > opt.day) && !day_links['next']) day_links['next'] = d;\n\t}\n\tif (day_links['prev'] && !opt.n_hidden) frag.insertBefore(_day_link('prev'), frag.firstChild);\n\tif (day_links['next']) frag.appendChild(_day_link('next'));\n\tif (opt.n_hidden) frag.insertBefore(_hidden_link(), frag.firstChild);\n\n\tvar LS = _el('prog_ls');\n\twhile (LS.firstChild) LS.removeChild(LS.firstChild);\n\tLS.appendChild(frag);\n\n\tvar expand_all = _el(\"item_expander_link\");\n\tif (expand_all) expand_all.onclick = function() {\n\t\tvar items = LS.getElementsByClassName(\"item\");\n\t\tvar exp_txt = i18n.txt('Expand all');\n\t\tif (expand_all.textContent == exp_txt) {\n\t\t\tfor (var i = 0, l = items.length; i < l; ++i) {\n\t\t\t\titems[i].parentNode.classList.add(\"expanded\");\n\t\t\t\tKonOpas.Item.show_extra(items[i], items[i].id.substr(1));\n\t\t\t}\n\t\t\texpand_all.textContent = i18n.txt('Collapse all');\n\t\t} else {\n\t\t\tfor (var i = 0, l = items.length; i < l; ++i) {\n\t\t\t\titems[i].parentNode.classList.remove(\"expanded\");\n\t\t\t}\n\t\t\texpand_all.textContent = exp_txt;\n\t\t}\n\t};\n\n\tvar star_els = LS.getElementsByClassName(\"item_star\");\n\tfor (var i = 0, l = star_els.length; i < l; ++i) {\n\t\tstar_els[i].onclick = function() { konopas.stars.toggle(this, this.id.substr(1)); return false; };\n\t}\n\n\tkonopas.stars.list().forEach(function(s){\n\t\tvar el = _el('s' + s);\n\t\tif (el) el.classList.add('has_star');\n\t});\n\n\tif (opt.id) {\n\t\tvar it = document.getElementById('p' + opt.id);\n\t\tif (it) {\n\t\t\tit.parentNode.classList.add(\"expanded\");\n\t\t\tKonOpas.Item.show_extra(it, opt.id);\n\t\t\tif (ls.length > 1) it.scrollIntoView();\n\t\t}\n\t}\n\n\tif (opt.prog_view) {\n\t\tvar d_s = _el('day-sidebar'), d_n = _el('day-narrow'),\n\t\t    d_click = function(ev) {\n\t\t\t\tvar li = (ev || window.event).target,\n\t\t\t\t    d = li.getAttribute('data-day');\n\t\t\t\tif (!d) return;\n\t\t\t\topt.day = d;\n\t\t\t\tif (opt.show_all) {\n\t\t\t\t\tvar dt = _el('dt_' + d);\n\t\t\t\t\tif (dt) {\n\t\t\t\t\t\tdt.scrollIntoView();\n\t\t\t\t\t\tKonOpas.Prog.focus_day(d);\n\t\t\t\t\t} else if (d < KonOpas.data_date(opt.now)) {\n\t\t\t\t\t\topt.hide_ended = false;\n\t\t\t\t\t\tKonOpas.Item.show_list(ls, opt);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\topt.hide_ended = true;\n\t\t\t\t\tKonOpas.Item.show_list(ls, opt);\n\t\t\t\t}\n\t\t\t},\n\t\t    d_set = function(div, len) {\n\t\t\t\tvar ul = document.createElement('ul');\n\t\t\t\tul.className = 'day-list';\n\t\t\t\tul.onclick = d_click;\n\t\t\t\tfor (var d in konopas.program.days) {\n\t\t\t\t\tvar li = document.createElement('li');\n\t\t\t\t\tli.textContent = konopas.program.days[d][len] + ' (' + (day_lengths[d] || 0) + ')';\n\t\t\t\t\tli.setAttribute('data-day', d);\n\t\t\t\t\tif (d == opt.day) li.className = 'selected';\n\t\t\t\t\tul.appendChild(li);\n\t\t\t\t}\n\t\t\t\tdiv.innerHTML = '';\n\t\t\t\tdiv.appendChild(ul);\n\t\t\t};\n\t\tif (d_s) d_set(d_s, 'long');\n\t\tif (d_n) d_set(d_n, 'short');\n\t\tkonopas.program.show_filter_sum(ls, opt);\n\t}\n\n\tkonopas.item.scroll.i = 0;\n\twindow.onscroll && window.onscroll();\n}\n\nKonOpas.Item.list_click = function(ev) {\n\tvar el = (ev || window.event).target,\n\t    is_link = false;\n\twhile (el && !/\\bitem(_|$)/.test(el.className)) {\n\t\tif (el.id == 'prog_ls') return;\n\t\tif ((el.tagName.toLowerCase() == 'a') && el.href) is_link = true;\n\t\tel = el.parentNode;\n\t\tif (!el) return;\n\t}\n\tif (el && el.id && (el.id[0] == 'p') && !is_link) {\n\t\tif (el.parentNode.classList.toggle(\"expanded\")) {\n\t\t\tKonOpas.Item.show_extra(el, el.id.substr(1));\n\t\t}\n\t}\n}\n\nKonOpas.Item.prototype.scroll_time = function() {\n\tvar S = this.scroll,\n\t\tst_len = S.times.length,\n\t    scroll_top = window.pageYOffset + 20; // to have more time for change behind new_time\n\tif (!S.t_el || !st_len) return;\n\tif (scroll_top < S.times[0].offsetTop) {\n\t\tS.i = 0;\n\t\tS.top = S.times[0].offsetTop;\n\t\tS.t_el.style.display = 'none';\n\t\tvar day0 = S.times[0].getAttribute('data-day');\n\t\tif (day0 != S.day) {\n\t\t\tKonOpas.Prog.focus_day(day0);\n\t\t\tS.day = day0;\n\t\t}\n\t} else {\n\t\tvar i = S.top ? S.i : 1;\n\t\tif (i >= st_len) i = st_len - 1;\n\t\tif (scroll_top > S.times[i].offsetTop) {\n\t\t\twhile ((i < st_len) && (scroll_top > S.times[i].offsetTop)) ++i;\n\t\t\t--i;\n\t\t} else {\n\t\t\twhile ((i >= 0) && (scroll_top < S.times[i].offsetTop)) --i;\n\t\t}\n\t\tif (i < 0) i = 0;\n\t\tif ((i == 0) || (i != S.i)) {\n\t\t\tS.i = i;\n\t\t\tS.top = S.times[i].offsetTop;\n\t\t\tvar day0 = S.times[i].getAttribute('data-day'),\n\t\t\t    day1 = ((i + 1 < st_len) && S.times[i+1].getAttribute('data-day')) || day0;\n\t\t\tS.t_el.textContent = konopas.program.days[day0]['short'] + '\\n' + S.times[i].textContent;\n\t\t\tS.t_el.style.display = 'block';\n\t\t\tif (day1 != S.day) {\n\t\t\t\tKonOpas.Prog.focus_day(day1);\n\t\t\t\tS.day = day1;\n\t\t\t}\n\t\t}\n\t}\n\tif (S.s_el) S.s_el.style.display = S.t_el.style.display;\n}\nKonOpas.Part = function(list, opt) {\n\tthis.list = list || [];\n\tthis.list.forEach(function(p){\n\t\tp.sortname = ((p.name[1] || '') + '  ' + p.name[0]).toLowerCase().replace(/^[\\s/()]+/, '');\n\t\tif (!opt.non_ascii_people) p.sortname = p.sortname.make_ascii();\n\t});\n\tthis.list.sort(opt.non_ascii_people\n\t\t? function(a, b) { return a.sortname.localeCompare(b.sortname, opt.lc); }\n\t\t: function(a, b) { return a.sortname < b.sortname ? -1 : a.sortname > b.sortname; });\n\tthis.set_ranges(opt.people_per_screen || 0);\n}\n\nKonOpas.Part.prototype.set_ranges = function(bin_size) {\n\tvar\tself = this,\n\t\t_ranges = function(a, bin_size) {\n\t\t\tvar\tends = [], start = ' ',\n\t\t\t\tn_bins = bin_size ? Math.round(a.length / bin_size) : 0,\n\t\t\t\t_prev_matches = function(a, i) { return (i > 0) && (a[i - 1] == a[i]); },\n\t\t\t\t_next_matches = function(a, i) { return (i < a.length - 1) && (a[i + 1] == a[i]); };\n\t\t\tfor (var i = 1; i <= n_bins; ++i) {\n\t\t\t\tvar e = Math.round(i * a.length / n_bins), n_up = 0, n_down = 0;\n\t\t\t\tif (e < 0) e = 0;\n\t\t\t\tif (e >= a.length) e = a.length - 1;\n\t\t\t\twhile (_next_matches(a, e + n_up)) ++n_up;\n\t\t\t\tif (n_up) while (_prev_matches(a, e - n_down)) ++n_down;\n\t\t\t\tif (n_up <= n_down) e += n_up;\n\t\t\t\telse if (e > n_down) e -= n_down + 1;\n\t\t\t\tif (!ends.length || (ends[ends.length - 1] != a[e])) ends.push(a[e]);\n\t\t\t}\n\t\t\tends.forEach(function(e, i){\n\t\t\t\tif (e > start) ends[i] = start + e;\n\t\t\t\tif (e >= start) start = String.fromCharCode(e.charCodeAt(0) + 1);\n\t\t\t});\n\t\t\treturn ends;\n\t\t},\n\t\t_range_set = function(div, nr) {\n\t\t\tvar ul = _new_elem('ul', 'name-list');\n\t\t\tnr.forEach(function(n){\n\t\t\t\tvar startChar = n.charAt(0);\n\t\t\t\tif (startChar == ' ') startChar = 'A';\n\t\t\t\tvar li = _new_elem('li', '', startChar);\n\t\t\t\tif (n.length > 1) li.textContent += ' - ' + n.charAt(1);\n\t\t\t\tli.setAttribute('data-range', n);\n\t\t\t\tul.appendChild(li);\n\t\t\t});\n\t\t\tdiv.appendChild(ul);\n\t\t\tdiv.onclick = (function(ev) {\n\t\t\t\tvar name_range = (ev || window.event).target.getAttribute('data-range');\n\t\t\t\tif (name_range) {\n\t\t\t\t\tkonopas.store.set('part', { 'name_range': name_range, 'participant': '' });\n\t\t\t\t\twindow.location.hash = '#part';\n\t\t\t\t\tthis.update_view(name_range, '');\n\t\t\t\t}\n\t\t\t}).bind(self);\n\t\t},\n\t\t_firstletter = function(name) {\n\t\t\treturn name.replace(/^[\\s/(]+/, '').charAt(0).toUpperCase()\n\t\t}\n\n\tvar fn = [], ln = [];\n\n\tthis.list.forEach(function(p){\n\t\tif (p.name && p.name.length) {\n\t\t\tfn.push(_firstletter(p.name[0]));\n\t\t\tif (p.name.length >= 2) ln.push(_firstletter(p.name[1]) || _firstletter(p.name[0]));\n\t\t}\n\t});\n\n\tthis.ranges = _ranges(ln.length ? ln : fn, bin_size);\n\t_range_set(_el('part-sidebar'), this.ranges);\n\t_range_set(_el('part-narrow'), this.ranges);\n\n\tvar nl_type =  fn.length &&  ln.length ? ''\n\t            :  fn.length && !ln.length ? 'fn-only'\n\t            : !fn.length &&  ln.length ? 'ln-only'\n\t            : 'error';\n\tif (nl_type) _el('part_names').classList.add(nl_type);\n}\n\nKonOpas.Part.name_in_range = function(n0, range) {\n\tswitch (range.length) {\n\t\tcase 1:  return (n0 == range[0]);\n\t\tcase 2:  return konopas.non_ascii_people\n\t\t\t? (n0.localeCompare(range[0], konopas.lc) >= 0) && (n0.localeCompare(range[1], konopas.lc) <= 0)\n\t\t\t: ((n0 >= range[0]) && (n0 <= range[1]));\n\t\tdefault: return (range.indexOf(n0) >= 0);\n\t}\n}\n\nKonOpas.Part.prototype.show_one = function(i) {\n\tvar p = this.list[i],\n\t    p_name = KonOpas.clean_name(p, false),\n\t    links = '',\n\t    img = '',\n\t    pl = KonOpas.clean_links(p);\n\tif (pl) {\n\t\tlinks += '<dl class=\"linklist\">';\n\t\tfor (var type in pl) if (type != 'img') {\n\t\t\tvar tgt = pl[type].tgt, txt = pl[type].txt || tgt;\n\t\t\tlinks += '<dt>' + type + ':<dd>' + '<a href=\"' + tgt + '\">' + txt + '</a>';\n\t\t}\n\t\tlinks += '</dl>';\n\t\tif (pl.img && navigator.onLine) {\n\t\t\timg = '<a class=\"part_img\" href=\"' + pl.img.tgt + '\"><img src=\"' + pl.img.tgt + '\" alt=\"' + i18n.txt('Photo') + ': ' + p_name + '\"></a>';\n\t\t}\n\t}\n\t_el(\"part_names\").innerHTML = '';\n\t_el(\"part_info\").innerHTML =\n\t\t  '<h2 id=\"part_title\">' + p_name + '</h2>'\n\t\t+ ((p.bio || img) ? ('<p>' + img + p.bio) : '')\n\t\t+ links;\n\tKonOpas.Item.show_list(konopas.program.list.filter(function(it) { return p.prog.indexOf(it.id) >= 0; }));\n\t_el(\"top\").scrollIntoView();\n}\n\nKonOpas.Part.prototype.show_list = function(name_range) {\n\tvar lp = !name_range ? this.list : this.list.filter(function(p) {\n\t\tvar n0 = p.sortname[0].toUpperCase();\n\t\treturn KonOpas.Part.name_in_range(n0, name_range);\n\t});\n\t_el('part_names').innerHTML = lp.map(function(p) {\n\t\treturn '<li><a href=\"#part/' + KonOpas.hash_encode(p.id) + '\">' + KonOpas.clean_name(p, true) + '</a></li>';\n\t}).join('');\n\t_el('part_info').innerHTML = '';\n\t_el('prog_ls').innerHTML = '';\n}\n\nKonOpas.Part.prototype.update_view = function(name_range, participant) {\n\tvar\tp_id = participant.substr(1),\n\t\tll = document.querySelectorAll('.name-list > li');\n\tif (!name_range) name_range = this.ranges && this.ranges[0] || '';\n\tfor (var i = 0; i < ll.length; ++i) {\n\t\tvar cmd = (ll[i].getAttribute('data-range') == name_range) ? 'add' : 'remove';\n\t\tll[i].classList[cmd]('selected');\n\t}\n\tif (!p_id || !this.list.some(function(p,i){\n\t\tif (p.id == p_id) { this.show_one(i); return true; }\n\t}, this)) {\n\t\tparticipant = '';\n\t\tthis.show_list(name_range);\n\t}\n\tkonopas.store.set('part', { 'name_range': name_range, 'participant': participant });\n}\n\nKonOpas.Part.prototype.show = function(hash) {\n\tif (!this.list.length) { window.location.hash = ''; return; }\n\tvar store = konopas.store.get('part') || {},\n\t    name_range = store.name_range || '',\n\t    participant = !document.body.classList.contains('part') && store.participant || '',\n\t\thash = window.location.hash.substr(6);\n\tif (hash) {\n\t\tvar p_id = KonOpas.hash_decode(hash);\n\t\tvar pa = this.list.filter(function(p) { return p.id == p_id; });\n\t\tif (pa.length) {\n\t\t\tparticipant = 'p' + pa[0].id;\n\t\t\tvar n0 = pa[0].sortname[0].toUpperCase();\n\t\t\tif (!n0 || !this.ranges || !this.ranges.some(function(r){\n\t\t\t\tif (KonOpas.Part.name_in_range(n0, r)) { name_range = r; return true; }\n\t\t\t})) name_range = '';\n\t\t} else {\n\t\t\twindow.location.hash = '#part';\n\t\t\treturn;\n\t\t}\n\t} else if (participant) {\n\t\twindow.location.hash = '#part/' + participant.substr(1);\n\t\treturn;\n\t}\n\tthis.update_view(name_range, participant);\n}\nif (!String.prototype.trim) {\n\tString.prototype.trim = function () {\n\t\treturn this.replace(/^\\s+|\\s+$/g, '');\n\t};\n}\n\n\nif (!Function.prototype.bind) {\n  Function.prototype.bind = function (oThis) {\n    if (typeof this !== \"function\") {\n      // closest thing possible to the ECMAScript 5\n      // internal IsCallable function\n      throw new TypeError(\"Function.prototype.bind - what is trying to be bound is not callable\");\n    }\n    var aArgs = Array.prototype.slice.call(arguments, 1),\n        fToBind = this,\n        fNOP = function () {},\n        fBound = function () {\n          return fToBind.apply(this instanceof fNOP && oThis\n                 ? this\n                 : oThis,\n                 aArgs.concat(Array.prototype.slice.call(arguments)));\n        };\n    fNOP.prototype = this.prototype;\n    fBound.prototype = new fNOP();\n    return fBound;\n  };\n}\n\n\nif ((function(){\n\ttry { new Date().toLocaleDateString(\"i\"); }\n\tcatch (e) { return e.name !== \"RangeError\"; }\n\treturn true;\n})()) {\n\tDate.prototype._orig_toLocaleDateString = Date.prototype.toLocaleDateString;\n\tDate.prototype.toLocaleDateString = function(locale, options) {\n\t\tif (!arguments.length || (typeof i18n == 'undefined')) return this._orig_toLocaleDateString();\n\t\tvar i = function(key, data){ return key in i18n[locale] ? i18n[locale][key](data) : key; },\n\t\t    w = i('weekday_n', { 'N': this.getDay() }),\n\t\t    d = this.getDate(),\n\t\t    m = i('month_n', { 'N': this.getMonth() }),\n\t\t    s = w + ', ' + d + ' ' + m;\n\t\tif (options && options.year) s += ' ' + this.getFullYear();\n\t\treturn s;\n\t};\n}\n\n\nString.prototype.make_ascii = String.prototype.normalize\n\t? function() {\n\t\treturn this.normalize('NFKD').replace(/[^\\x00-\\x7F]/g, '');\n\t}\n\t: function() {\n\t\tvar str = this.toString();\n\t\tif (/^[\\x00-\\x7F]*$/.test(str)) return str;\n\t\t// map from http://web.archive.org/web/20120918093154/http://lehelk.com/2011/05/06/script-to-remove-diacritics/\n\t\tvar norm_map = {\n\t\t\t'A': /[\\u0041\\u24B6\\uFF21\\u00C0\\u00C1\\u00C2\\u1EA6\\u1EA4\\u1EAA\\u1EA8\\u00C3\\u0100\\u0102\\u1EB0\\u1EAE\\u1EB4\\u1EB2\\u0226\\u01E0\\u00C4\\u01DE\\u1EA2\\u00C5\\u01FA\\u01CD\\u0200\\u0202\\u1EA0\\u1EAC\\u1EB6\\u1E00\\u0104\\u023A\\u2C6F]/g,\n\t\t\t'AA':/[\\uA732]/g,\n\t\t\t'AE':/[\\u00C6\\u01FC\\u01E2]/g,\n\t\t\t'AO':/[\\uA734]/g,\n\t\t\t'AU':/[\\uA736]/g,\n\t\t\t'AV':/[\\uA738\\uA73A]/g,\n\t\t\t'AY':/[\\uA73C]/g,\n\t\t\t'B': /[\\u0042\\u24B7\\uFF22\\u1E02\\u1E04\\u1E06\\u0243\\u0182\\u0181]/g,\n\t\t\t'C': /[\\u0043\\u24B8\\uFF23\\u0106\\u0108\\u010A\\u010C\\u00C7\\u1E08\\u0187\\u023B\\uA73E]/g,\n\t\t\t'D': /[\\u0044\\u24B9\\uFF24\\u1E0A\\u010E\\u1E0C\\u1E10\\u1E12\\u1E0E\\u0110\\u018B\\u018A\\u0189\\uA779]/g,\n\t\t\t'DZ':/[\\u01F1\\u01C4]/g,\n\t\t\t'Dz':/[\\u01F2\\u01C5]/g,\n\t\t\t'E': /[\\u0045\\u24BA\\uFF25\\u00C8\\u00C9\\u00CA\\u1EC0\\u1EBE\\u1EC4\\u1EC2\\u1EBC\\u0112\\u1E14\\u1E16\\u0114\\u0116\\u00CB\\u1EBA\\u011A\\u0204\\u0206\\u1EB8\\u1EC6\\u0228\\u1E1C\\u0118\\u1E18\\u1E1A\\u0190\\u018E]/g,\n\t\t\t'F': /[\\u0046\\u24BB\\uFF26\\u1E1E\\u0191\\uA77B]/g,\n\t\t\t'G': /[\\u0047\\u24BC\\uFF27\\u01F4\\u011C\\u1E20\\u011E\\u0120\\u01E6\\u0122\\u01E4\\u0193\\uA7A0\\uA77D\\uA77E]/g,\n\t\t\t'H': /[\\u0048\\u24BD\\uFF28\\u0124\\u1E22\\u1E26\\u021E\\u1E24\\u1E28\\u1E2A\\u0126\\u2C67\\u2C75\\uA78D]/g,\n\t\t\t'I': /[\\u0049\\u24BE\\uFF29\\u00CC\\u00CD\\u00CE\\u0128\\u012A\\u012C\\u0130\\u00CF\\u1E2E\\u1EC8\\u01CF\\u0208\\u020A\\u1ECA\\u012E\\u1E2C\\u0197]/g,\n\t\t\t'J': /[\\u004A\\u24BF\\uFF2A\\u0134\\u0248]/g,\n\t\t\t'K': /[\\u004B\\u24C0\\uFF2B\\u1E30\\u01E8\\u1E32\\u0136\\u1E34\\u0198\\u2C69\\uA740\\uA742\\uA744\\uA7A2]/g,\n\t\t\t'L': /[\\u004C\\u24C1\\uFF2C\\u013F\\u0139\\u013D\\u1E36\\u1E38\\u013B\\u1E3C\\u1E3A\\u0141\\u023D\\u2C62\\u2C60\\uA748\\uA746\\uA780]/g,\n\t\t\t'LJ':/[\\u01C7]/g,\n\t\t\t'Lj':/[\\u01C8]/g,\n\t\t\t'M': /[\\u004D\\u24C2\\uFF2D\\u1E3E\\u1E40\\u1E42\\u2C6E\\u019C]/g,\n\t\t\t'N': /[\\u004E\\u24C3\\uFF2E\\u01F8\\u0143\\u00D1\\u1E44\\u0147\\u1E46\\u0145\\u1E4A\\u1E48\\u0220\\u019D\\uA790\\uA7A4]/g,\n\t\t\t'NJ':/[\\u01CA]/g,\n\t\t\t'Nj':/[\\u01CB]/g,\n\t\t\t'O': /[\\u004F\\u24C4\\uFF2F\\u00D2\\u00D3\\u00D4\\u1ED2\\u1ED0\\u1ED6\\u1ED4\\u00D5\\u1E4C\\u022C\\u1E4E\\u014C\\u1E50\\u1E52\\u014E\\u022E\\u0230\\u00D6\\u022A\\u1ECE\\u0150\\u01D1\\u020C\\u020E\\u01A0\\u1EDC\\u1EDA\\u1EE0\\u1EDE\\u1EE2\\u1ECC\\u1ED8\\u01EA\\u01EC\\u00D8\\u01FE\\u0186\\u019F\\uA74A\\uA74C]/g,\n\t\t\t'OI':/[\\u01A2]/g,\n\t\t\t'OO':/[\\uA74E]/g,\n\t\t\t'OU':/[\\u0222]/g,\n\t\t\t'P': /[\\u0050\\u24C5\\uFF30\\u1E54\\u1E56\\u01A4\\u2C63\\uA750\\uA752\\uA754]/g,\n\t\t\t'Q': /[\\u0051\\u24C6\\uFF31\\uA756\\uA758\\u024A]/g,\n\t\t\t'R': /[\\u0052\\u24C7\\uFF32\\u0154\\u1E58\\u0158\\u0210\\u0212\\u1E5A\\u1E5C\\u0156\\u1E5E\\u024C\\u2C64\\uA75A\\uA7A6\\uA782]/g,\n\t\t\t'S': /[\\u0053\\u24C8\\uFF33\\u1E9E\\u015A\\u1E64\\u015C\\u1E60\\u0160\\u1E66\\u1E62\\u1E68\\u0218\\u015E\\u2C7E\\uA7A8\\uA784]/g,\n\t\t\t'T': /[\\u0054\\u24C9\\uFF34\\u1E6A\\u0164\\u1E6C\\u021A\\u0162\\u1E70\\u1E6E\\u0166\\u01AC\\u01AE\\u023E\\uA786]/g,\n\t\t\t'TZ':/[\\uA728]/g,\n\t\t\t'U': /[\\u0055\\u24CA\\uFF35\\u00D9\\u00DA\\u00DB\\u0168\\u1E78\\u016A\\u1E7A\\u016C\\u00DC\\u01DB\\u01D7\\u01D5\\u01D9\\u1EE6\\u016E\\u0170\\u01D3\\u0214\\u0216\\u01AF\\u1EEA\\u1EE8\\u1EEE\\u1EEC\\u1EF0\\u1EE4\\u1E72\\u0172\\u1E76\\u1E74\\u0244]/g,\n\t\t\t'V': /[\\u0056\\u24CB\\uFF36\\u1E7C\\u1E7E\\u01B2\\uA75E\\u0245]/g,\n\t\t\t'VY':/[\\uA760]/g,\n\t\t\t'W': /[\\u0057\\u24CC\\uFF37\\u1E80\\u1E82\\u0174\\u1E86\\u1E84\\u1E88\\u2C72]/g,\n\t\t\t'X': /[\\u0058\\u24CD\\uFF38\\u1E8A\\u1E8C]/g,\n\t\t\t'Y': /[\\u0059\\u24CE\\uFF39\\u1EF2\\u00DD\\u0176\\u1EF8\\u0232\\u1E8E\\u0178\\u1EF6\\u1EF4\\u01B3\\u024E\\u1EFE]/g,\n\t\t\t'Z': /[\\u005A\\u24CF\\uFF3A\\u0179\\u1E90\\u017B\\u017D\\u1E92\\u1E94\\u01B5\\u0224\\u2C7F\\u2C6B\\uA762]/g,\n\t\t\t'a': /[\\u0061\\u24D0\\uFF41\\u1E9A\\u00E0\\u00E1\\u00E2\\u1EA7\\u1EA5\\u1EAB\\u1EA9\\u00E3\\u0101\\u0103\\u1EB1\\u1EAF\\u1EB5\\u1EB3\\u0227\\u01E1\\u00E4\\u01DF\\u1EA3\\u00E5\\u01FB\\u01CE\\u0201\\u0203\\u1EA1\\u1EAD\\u1EB7\\u1E01\\u0105\\u2C65\\u0250]/g,\n\t\t\t'aa':/[\\uA733]/g,\n\t\t\t'ae':/[\\u00E6\\u01FD\\u01E3]/g,\n\t\t\t'ao':/[\\uA735]/g,\n\t\t\t'au':/[\\uA737]/g,\n\t\t\t'av':/[\\uA739\\uA73B]/g,\n\t\t\t'ay':/[\\uA73D]/g,\n\t\t\t'b': /[\\u0062\\u24D1\\uFF42\\u1E03\\u1E05\\u1E07\\u0180\\u0183\\u0253]/g,\n\t\t\t'c': /[\\u0063\\u24D2\\uFF43\\u0107\\u0109\\u010B\\u010D\\u00E7\\u1E09\\u0188\\u023C\\uA73F\\u2184]/g,\n\t\t\t'd': /[\\u0064\\u24D3\\uFF44\\u1E0B\\u010F\\u1E0D\\u1E11\\u1E13\\u1E0F\\u0111\\u018C\\u0256\\u0257\\uA77A]/g,\n\t\t\t'dz':/[\\u01F3\\u01C6]/g,\n\t\t\t'e': /[\\u0065\\u24D4\\uFF45\\u00E8\\u00E9\\u00EA\\u1EC1\\u1EBF\\u1EC5\\u1EC3\\u1EBD\\u0113\\u1E15\\u1E17\\u0115\\u0117\\u00EB\\u1EBB\\u011B\\u0205\\u0207\\u1EB9\\u1EC7\\u0229\\u1E1D\\u0119\\u1E19\\u1E1B\\u0247\\u025B\\u01DD]/g,\n\t\t\t'f': /[\\u0066\\u24D5\\uFF46\\u1E1F\\u0192\\uA77C]/g,\n\t\t\t'g': /[\\u0067\\u24D6\\uFF47\\u01F5\\u011D\\u1E21\\u011F\\u0121\\u01E7\\u0123\\u01E5\\u0260\\uA7A1\\u1D79\\uA77F]/g,\n\t\t\t'h': /[\\u0068\\u24D7\\uFF48\\u0125\\u1E23\\u1E27\\u021F\\u1E25\\u1E29\\u1E2B\\u1E96\\u0127\\u2C68\\u2C76\\u0265]/g,\n\t\t\t'hv':/[\\u0195]/g,\n\t\t\t'i': /[\\u0069\\u24D8\\uFF49\\u00EC\\u00ED\\u00EE\\u0129\\u012B\\u012D\\u00EF\\u1E2F\\u1EC9\\u01D0\\u0209\\u020B\\u1ECB\\u012F\\u1E2D\\u0268\\u0131]/g,\n\t\t\t'j': /[\\u006A\\u24D9\\uFF4A\\u0135\\u01F0\\u0249]/g,\n\t\t\t'k': /[\\u006B\\u24DA\\uFF4B\\u1E31\\u01E9\\u1E33\\u0137\\u1E35\\u0199\\u2C6A\\uA741\\uA743\\uA745\\uA7A3]/g,\n\t\t\t'l': /[\\u006C\\u24DB\\uFF4C\\u0140\\u013A\\u013E\\u1E37\\u1E39\\u013C\\u1E3D\\u1E3B\\u017F\\u0142\\u019A\\u026B\\u2C61\\uA749\\uA781\\uA747]/g,\n\t\t\t'lj':/[\\u01C9]/g,\n\t\t\t'm': /[\\u006D\\u24DC\\uFF4D\\u1E3F\\u1E41\\u1E43\\u0271\\u026F]/g,\n\t\t\t'n': /[\\u006E\\u24DD\\uFF4E\\u01F9\\u0144\\u00F1\\u1E45\\u0148\\u1E47\\u0146\\u1E4B\\u1E49\\u019E\\u0272\\u0149\\uA791\\uA7A5]/g,\n\t\t\t'nj':/[\\u01CC]/g,\n\t\t\t'o': /[\\u006F\\u24DE\\uFF4F\\u00F2\\u00F3\\u00F4\\u1ED3\\u1ED1\\u1ED7\\u1ED5\\u00F5\\u1E4D\\u022D\\u1E4F\\u014D\\u1E51\\u1E53\\u014F\\u022F\\u0231\\u00F6\\u022B\\u1ECF\\u0151\\u01D2\\u020D\\u020F\\u01A1\\u1EDD\\u1EDB\\u1EE1\\u1EDF\\u1EE3\\u1ECD\\u1ED9\\u01EB\\u01ED\\u00F8\\u01FF\\u0254\\uA74B\\uA74D\\u0275]/g,\n\t\t\t'oi':/[\\u01A3]/g,\n\t\t\t'ou':/[\\u0223]/g,\n\t\t\t'oo':/[\\uA74F]/g,\n\t\t\t'p': /[\\u0070\\u24DF\\uFF50\\u1E55\\u1E57\\u01A5\\u1D7D\\uA751\\uA753\\uA755]/g,\n\t\t\t'q': /[\\u0071\\u24E0\\uFF51\\u024B\\uA757\\uA759]/g,\n\t\t\t'r': /[\\u0072\\u24E1\\uFF52\\u0155\\u1E59\\u0159\\u0211\\u0213\\u1E5B\\u1E5D\\u0157\\u1E5F\\u024D\\u027D\\uA75B\\uA7A7\\uA783]/g,\n\t\t\t's': /[\\u0073\\u24E2\\uFF53\\u00DF\\u015B\\u1E65\\u015D\\u1E61\\u0161\\u1E67\\u1E63\\u1E69\\u0219\\u015F\\u023F\\uA7A9\\uA785\\u1E9B]/g,\n\t\t\t't': /[\\u0074\\u24E3\\uFF54\\u1E6B\\u1E97\\u0165\\u1E6D\\u021B\\u0163\\u1E71\\u1E6F\\u0167\\u01AD\\u0288\\u2C66\\uA787]/g,\n\t\t\t'tz':/[\\uA729]/g,\n\t\t\t'u': /[\\u0075\\u24E4\\uFF55\\u00F9\\u00FA\\u00FB\\u0169\\u1E79\\u016B\\u1E7B\\u016D\\u00FC\\u01DC\\u01D8\\u01D6\\u01DA\\u1EE7\\u016F\\u0171\\u01D4\\u0215\\u0217\\u01B0\\u1EEB\\u1EE9\\u1EEF\\u1EED\\u1EF1\\u1EE5\\u1E73\\u0173\\u1E77\\u1E75\\u0289]/g,\n\t\t\t'v': /[\\u0076\\u24E5\\uFF56\\u1E7D\\u1E7F\\u028B\\uA75F\\u028C]/g,\n\t\t\t'vy':/[\\uA761]/g,\n\t\t\t'w': /[\\u0077\\u24E6\\uFF57\\u1E81\\u1E83\\u0175\\u1E87\\u1E85\\u1E98\\u1E89\\u2C73]/g,\n\t\t\t'x': /[\\u0078\\u24E7\\uFF58\\u1E8B\\u1E8D]/g,\n\t\t\t'y': /[\\u0079\\u24E8\\uFF59\\u1EF3\\u00FD\\u0177\\u1EF9\\u0233\\u1E8F\\u00FF\\u1EF7\\u1E99\\u1EF5\\u01B4\\u024F\\u1EFF]/g,\n\t\t\t'z': /[\\u007A\\u24E9\\uFF5A\\u017A\\u1E91\\u017C\\u017E\\u1E93\\u1E95\\u01B6\\u0225\\u0240\\u2C6C\\uA763]/g\n\t\t};\n\t\tfor (var l in norm_map) {\n\t\t\tstr = str.replace(norm_map[l], l);\n\t\t}\n\t\treturn str.replace(/[^\\x00-\\x7F]/g, '');\n\t};\n\n\n/*\n * classList.js: Cross-browser full element.classList implementation.\n * 2011-06-15\n *\n * By Eli Grey, http://eligrey.com\n * Public Domain.\n * NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\n */\n\n/*global self, document, DOMException */\n\n/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js*/\n\nif (typeof document !== \"undefined\" && !(\"classList\" in document.createElement(\"a\"))) {\n\n(function (view) {\n\nvar\n\t  classListProp = \"classList\"\n\t, protoProp = \"prototype\"\n\t, elemCtrProto = (view.HTMLElement || view.Element)[protoProp]\n\t, objCtr = Object\n\t, strTrim = String[protoProp].trim || function () {\n\t\treturn this.replace(/^\\s+|\\s+$/g, \"\");\n\t}\n\t, arrIndexOf = Array[protoProp].indexOf || function (item) {\n\t\tvar\n\t\t\t  i = 0\n\t\t\t, len = this.length\n\t\t;\n\t\tfor (; i < len; i++) {\n\t\t\tif (i in this && this[i] === item) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t}\n\t// Vendors: please allow content code to instantiate DOMExceptions\n\t, DOMEx = function (type, message) {\n\t\tthis.name = type;\n\t\tthis.code = DOMException[type];\n\t\tthis.message = message;\n\t}\n\t, checkTokenAndGetIndex = function (classList, token) {\n\t\tif (token === \"\") {\n\t\t\tthrow new DOMEx(\n\t\t\t\t  \"SYNTAX_ERR\"\n\t\t\t\t, \"An invalid or illegal string was specified\"\n\t\t\t);\n\t\t}\n\t\tif (/\\s/.test(token)) {\n\t\t\tthrow new DOMEx(\n\t\t\t\t  \"INVALID_CHARACTER_ERR\"\n\t\t\t\t, \"String contains an invalid character\"\n\t\t\t);\n\t\t}\n\t\treturn arrIndexOf.call(classList, token);\n\t}\n\t, ClassList = function (elem) {\n\t\tvar\n\t\t\t  trimmedClasses = strTrim.call(elem.className)\n\t\t\t, classes = trimmedClasses ? trimmedClasses.split(/\\s+/) : []\n\t\t\t, i = 0\n\t\t\t, len = classes.length\n\t\t;\n\t\tfor (; i < len; i++) {\n\t\t\tthis.push(classes[i]);\n\t\t}\n\t\tthis._updateClassName = function () {\n\t\t\telem.className = this.toString();\n\t\t};\n\t}\n\t, classListProto = ClassList[protoProp] = []\n\t, classListGetter = function () {\n\t\treturn new ClassList(this);\n\t}\n;\n// Most DOMException implementations don't allow calling DOMException's toString()\n// on non-DOMExceptions. Error's toString() is sufficient here.\nDOMEx[protoProp] = Error[protoProp];\nclassListProto.item = function (i) {\n\treturn this[i] || null;\n};\nclassListProto.contains = function (token) {\n\ttoken += \"\";\n\treturn checkTokenAndGetIndex(this, token) !== -1;\n};\nclassListProto.add = function (token) {\n\ttoken += \"\";\n\tif (checkTokenAndGetIndex(this, token) === -1) {\n\t\tthis.push(token);\n\t\tthis._updateClassName();\n\t}\n};\nclassListProto.remove = function (token) {\n\ttoken += \"\";\n\tvar index = checkTokenAndGetIndex(this, token);\n\tif (index !== -1) {\n\t\tthis.splice(index, 1);\n\t\tthis._updateClassName();\n\t}\n};\nclassListProto.toggle = function (token) {\n\ttoken += \"\";\n\tif (checkTokenAndGetIndex(this, token) === -1) {\n\t\tthis.add(token);\n\t} else {\n\t\tthis.remove(token);\n\t}\n};\nclassListProto.toString = function () {\n\treturn this.join(\" \");\n};\n \nif (objCtr.defineProperty) {\n\tvar classListPropDesc = {\n\t\t  get: classListGetter\n\t\t, enumerable: true\n\t\t, configurable: true\n\t};\n\ttry {\n\t\tobjCtr.defineProperty(elemCtrProto, classListProp, classListPropDesc);\n\t} catch (ex) { // IE 8 doesn't support enumerable:true\n\t\tif (ex.number === -0x7FF5EC54) {\n\t\t\tclassListPropDesc.enumerable = false;\n\t\t\tobjCtr.defineProperty(elemCtrProto, classListProp, classListPropDesc);\n\t\t}\n\t}\n} else if (objCtr[protoProp].__defineGetter__) {\n\telemCtrProto.__defineGetter__(classListProp, classListGetter);\n}\n \n}(self));\n \n}\nKonOpas.Prog = function(list, opt) {\n\tfunction _sort(a, b) {\n\t\tif (!a.date != !b.date) return a.date ? -1 : 1;\n\t\tif (a.date < b.date) return -1;\n\t\tif (a.date > b.date) return  1;\n\t\tif (!a.time != !b.time) return a.time ? 1 : -1;\n\t\tif (a.time < b.time) return -1;\n\t\tif (a.time > b.time) return  1;\n\t\tif (a.loc && b.loc) {\n\t\t\tif (a.loc.length < b.loc.length) return -1;\n\t\t\tif (a.loc.length > b.loc.length) return  1;\n\t\t\tfor (var i = a.loc.length - 1; i >= 0; --i) {\n\t\t\t\tif (a.loc[i] < b.loc[i]) return -1;\n\t\t\t\tif (a.loc[i] > b.loc[i]) return  1;\n\t\t\t}\n\t\t}\n\t\treturn 0;\n\t}\n\tthis.list = (list || []).sort(_sort);\n\tthis.list.forEach(function(p) {\n\t\tif (p && p.date) {\n\t\t\tvar d = p.date.split(/\\D+/),\n\t\t\t    t = p.time && p.time.split(/\\D+/) || [0,0],\n\t\t\t\tm = p.time && Number(p.mins || KonOpas.default_duration) || (!p.time && 24*60-1) || 0;\n\t\t\tp.t0 = new Date(d[0], d[1] - 1, d[2], t[0], t[1]);\n\t\t\tif (isNaN(p.t0)) delete p.t0;\n\t\t\telse p.t1 = new Date(p.t0.valueOf() + 60000 * m);\n\t\t}\n\t});\n\tvar pf = _el('prog_filters');\n\tpf.onclick = KonOpas.Prog.filter_change;\n\tvar pl = pf.getElementsByClassName('popup-link');\n\tfor (var i = 0; i < pl.length; ++i) {\n\t\tpl[i].setAttribute('data-title', pl[i].textContent);\n\t\tpl[i].nextElementSibling.onclick = KonOpas.Prog.filter_change;\n\t}\n\tvar sf = _el('search');\n\tif (sf) {\n\t\tsf.onsubmit = _el('q').oninput = KonOpas.Prog.filter_change;\n\t\tsf.onreset = function() { KonOpas.Prog.set_filters({}); };\n\t}\n\tthis.init_filters(opt);\n\tvar pt = _el('tab_prog'),\n\t    pa = pt && pt.getElementsByTagName('a');\n\tif (pa && pa.length) pa[0].onclick = function(ev) {\n\t\tif (window.pageYOffset && document.body.classList.contains('prog')) {\n\t\t\twindow.scrollTo(0, 0);\n\t\t\t(ev || window.event).preventDefault();\n\t\t}\n\t};\n}\n\n\n// ------------------------------------------------------------------------------------------------ static\n\nKonOpas.Prog.hash = function(f, excl) {\n\tvar p = ['#prog'];\n\tif (f) ['id', 'area', 'tag', 'query'].forEach(function(k){\n\t\tvar v = f[k + '_str'] || f[k];\n\t\tif (excl && excl[k] || !v || (v == 'all_' + k + 's')) return;\n\t\tif ((k == 'tag') && konopas.tag_categories) {\n\t\t\tvar m = v.match(new RegExp('^(' + konopas.tag_categories.join('|') + '):(.*)'));\n\t\t\tif (m) { k = m[1]; v = m[2]; }\n\t\t}\n\t\tp.push(k + ':' + KonOpas.hash_encode(v));\n\t});\n\treturn p.length > 1 ? p.join('/') : '#';\n}\n\nKonOpas.Prog.get_filters = function(hash_only) {\n\tvar\tfilters = { 'area':'', 'tag':'', 'query':'', 'id':'' },\n\t\th = window.location.toString().split('#')[1] || '',\n\t\th_set = false,\n\t\ttag_re = konopas.tag_categories && konopas.tag_categories.length && new RegExp('^' + konopas.tag_categories.join('|') + '$');\n\tif (h.substr(0, 5) == 'prog/') {\n\t\th.substr(5).split('/').forEach(function(p){\n\t\t\tvar s = p.split(':');\n\t\t\tif ((s.length == 2) && s[0] && s[1]) {\n\t\t\t\tif (tag_re && tag_re.test(s[0])) {\n\t\t\t\t\ts[1] = p;\n\t\t\t\t\ts[0] = 'tag';\n\t\t\t\t}\n\t\t\t\tfilters[s[0]] = KonOpas.hash_decode(s[1]);\n\t\t\t\th_set = true;\n\t\t\t}\n\t\t});\n\t}\n\tif (!hash_only && !h_set && !document.body.classList.contains('prog')) {\n\t\tvar store = konopas.store.get('prog');\n\t\tif (store) for (var k in store) {\n\t\t\tif (filters.hasOwnProperty(k)) filters[k] = store[k];\n\t\t}\n\t}\n\treturn filters;\n}\n\nKonOpas.Prog.set_filters = function(f, silent) {\n\tif (silent && !(history && history.replaceState)) return false;\n\tif (f.id) f = { 'id': f.id };\n\tkonopas.store.set('prog', f);\n\tvar h = KonOpas.Prog.hash(f),\n\t    h_cur = window.location.toString().split('#')[1] || '';\n\tif (h_cur != h.substr(1)) {\n\t\tif (silent) {\n\t\t\tvar loc = window.location.toString().split('#')[0] + h;\n\t\t\thistory.replaceState({}, document.title, loc);\n\t\t\twindow.onhashchange()\n\t\t} else {\n\t\t\twindow.location.hash = h;\n\t\t}\n\t\treturn true;\n\t}\n\treturn false;\n}\n\n// read filters from url + ev -> set new hash\nKonOpas.Prog.filter_change = function(ev) {\n\tev = ev || window.event;\n\tvar key, value;\n\tvar silent = false;\n\tswitch (ev.type) {\n\t\tcase 'click':\n\t\t\tif (ev.target.tagName.toLowerCase() != 'li') return;\n\t\t\tvar popups = ev.target.getElementsByClassName('popup');\n\t\t\tif (popups && popups.length) return;\n\t\t\tkey = ev.target.parentNode.id.replace(/\\d+$/, '');\n\t\t\tvalue = ev.target.id;\n\t\t\tswitch (key) {\n\t\t\t\tcase 'area': value = value.replace(/^a([^a-zA-Z])/, '$1'); break;\n\t\t\t\tcase 'tag':  value = value.replace(/^t([^a-zA-Z])/, '$1'); break;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'submit':\n\t\t\tev.preventDefault();\n\t\t\t// fallthrough\n\t\tcase 'input':\n\t\t\tkey = 'query';\n\t\t\tvalue = _el(\"q\").value;\n\t\t\tsilent = value.length > 1;\n\t\t\tbreak;\n\t\tdefault: return;\n\t}\n\tvar filters = KonOpas.Prog.get_filters();\n\tfilters[key] = value;\n\tif (filters['id'] && (key != 'id')) filters['id'] = '';\n\tKonOpas.Prog.set_filters(filters, silent);\n}\n\nKonOpas.Prog.focus_day = function(d) {\n\tfor (var n in {'day-sidebar':1, 'day-narrow':1}) {\n\t\tvar e = _el(n),\n\t\t\ts = e && e.getElementsByTagName('li');\n\t\tif (s) for (var i = 0; i < s.length; ++i) {\n\t\t\tvar _d = s[i].getAttribute('data-day');\n\t\t\ts[i].classList[(_d == d) ? 'add' : 'remove']('selected');\n\t\t}\n\t}\n}\n\n\n\n// ------------------------------------------------------------------------------------------------ instance\n\nKonOpas.Prog.prototype.init_filters = function(opt) {\n\tvar filter_el = _el('prog_lists'), labels = {}, regexp = {};\n\tfunction _txt(s) {\n\t\treturn i18n.txt(s.charAt(0).toUpperCase() + s.slice(1).replace('_',' '));\n\t}\n\tfunction _ul(id) {\n\t\tvar e = document.createElement('ul');\n\t\te.id = id;\n\t\treturn e;\n\t}\n\tfunction _li(par, id, txt) {\n\t\tvar e = document.createElement('li');\n\t\te.id = /^[^a-zA-Z]/.test(id) ? par.id[0] + id : id\n\t\tif (!txt) txt = labels[id] || _txt(id);\n\t\tif (/^\\s*$/.test(txt)) return;\n\t\te.textContent = /^[\\\\^$]/.test(txt) ? txt.substr(1) : txt;\n\t\tif (regexp[id]) e.setAttribute('data-regexp', regexp[id]);\n\t\tpar.appendChild(e);\n\t}\n\tfunction _compare(a, b) {\n\t\tvar sf = function(s) { return (labels[s] || s.replace(/^[^:]+:/, '')).toLowerCase().replace(/^the /, ''); },\n\t\t\taf = function(s) { return s.match(/\\d+|\\D+/g).map(function(v) { return Number(v) || v; }); },\n\t\t\t_a = sf(a), _b = sf(b);\n\t\tif ((_a[0] == '$') != (_b[0] == '$')) return (_a < _b) ? 1 : -1; // $ == 0x24\n\t\tif (/\\d/.test(_a) && /\\d/.test(_b)) {\n\t\t\tvar aa = af(_a), bb = af(_b);\n\t\t\tfor (var i = 0; i < aa.length && i < bb.length; ++i) {\n\t\t\t\tif (aa[i] < bb[i]) return -1;\n\t\t\t\tif (aa[i] > bb[i]) return  1;\n\t\t\t}\n\t\t\tif (aa.length != bb.length) return aa.length < bb.length ? -1 : 1;\n\t\t} else {\n\t\t\tif (_a < _b) return -1;\n\t\t\tif (_a > _b) return  1;\n\t\t}\n\t\treturn 0;\n\t}\n\tfunction _ul2(par, id, name, prefix, list) {\n\t\tvar title = labels[name] || _txt(name),\n\t\t    root = document.createElement('li'),\n\t\t    link = _new_elem('div', 'popup-link', title + '…'),\n\t\t    ul = _new_elem('ul', 'popup');\n\t\t// Hack: To remove Room category listing\n\t\tif (konopas.hiddenFilterCategories.indexOf(title) !== -1){\n\t\t\troot.style=\"display:none\";\n\t\t}\n\t\tlink.setAttribute('data-title', link.textContent);\n\t\tlink.addEventListener('click', KonOpas.popup_open);\n\t\tul.id = id;\n\t\tul.setAttribute('data-title', title);\n\t\tul.addEventListener('click', KonOpas.Prog.filter_change);\n\t\tfor (var i = 0; i < list.length; ++i) {\n\t\t\tvar txt = labels[list[i]] || list[i].replace(prefix, '');\n\t\t\t_li(ul, list[i], txt);\n\t\t}\n\t\troot.appendChild(link);\n\t\troot.appendChild(ul);\n\t\tpar.appendChild(root);\n\t}\n\tfunction _fill(id, items) {\n\t\tvar i = 0, o = opt[id], ul = _ul(id);\n\t\tlabels = o.labels || {};\n\t\tregexp = o.regexp || {};\n\t\tfor (var r in regexp) items[r] = 1;\n\t\t_li(ul, 'all_' + id + 's');\n\t\tif (o.promote) for (i = 0; i < o.promote.length; ++i) {\n\t\t\t_li(ul, o.promote[i]);\n\t\t\tdelete items[o.promote[i]];\n\t\t}\n\t\tif (o.exclude) {\n\t\t\tvar re = new RegExp(o.exclude.join('|'));\n\t\t\tfor (var t in items) if (re.test(t)) delete items[t];\n\t\t}\n\t\tif (o.min_count) {\n\t\t\tfor (var t in items) if (items[t] < o.min_count) delete items[t];\n\t\t}\n\t\tvar list = Object.keys(items).sort(_compare);\n\t\tif (o.categories) for (i = 0; i < o.categories.length; ++i) {\n\t\t\tvar prefix = o.categories[i] + ':',\n\t\t\t    list_in = [], list_out = [];\n\t\t\tfor (var j = 0; j < list.length; ++j) {\n\t\t\t\tif (list[j].substr(0, prefix.length) == prefix) {\n\t\t\t\t\tlist_in.push(list[j]);\n\t\t\t\t} else {\n\t\t\t\t\tlist_out.push(list[j]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tswitch (list_in.length) {\n\t\t\t\tcase 0:   break;\n\t\t\t\tcase 1:   _li(ul, prefix + list_in[0]);  break;\n\t\t\t\tdefault:  _ul2(ul, id + i, o.categories[i], prefix, list_in);\n\t\t\t}\n\t\t\tlist = list_out;\n\t\t}\n\t\tif (list.length < 4) for (i = 0; i < list.length; ++i) _li(ul, list[i]);\n\t\telse _ul2(ul, id + i, id, '', list);\n\t\tfilter_el.appendChild(ul);\n\t}\n\tif (!opt || !filter_el) return;\n\twhile (filter_el.firstChild) filter_el.removeChild(filter_el.firstChild);\n\tvar days = {}, areas = {}, tags = {},\n\t    lvl = (opt.area && opt.area.loc_level) || 0;\n\tfor (var i = 0, l = this.list.length; i < l; ++i) {\n\t\tvar p = this.list[i];\n\t\tif (p.date) days[p.date] = 1;\n\t\tif (opt.area && (typeof p.loc == 'object') && p.loc && p.loc[lvl]) areas[p.loc[lvl]] = (areas[p.loc[lvl]] || 0) + 1;\n\t\tif (opt.tag && (typeof p.tags == 'object') && p.tags) for (var j = 0; j < p.tags.length; ++j) {\n\t\t\tvar t_s = opt.tag.set_category && opt.tag.set_category[p.tags[j]];\n\t\t\tif (t_s) p.tags[j] = t_s + ':' + p.tags[j];\n\t\t\ttags[p.tags[j]] = (tags[p.tags[j]] || 0) + 1;\n\t\t}\n\t}\n\tif (opt.day && opt.day.exclude) {\n\t\tvar d_re = new RegExp(opt.day.exclude.join('|'));\n\t\tfor (var d in days) if (d_re.test(d)) delete days[d];\n\t}\n\tthis.days = {};\n\tfor (var d in days) {\n\t\tvar d_d = KonOpas.parse_date(d), d_n = {'N': d_d ? d_d.getDay() : -1 };\n\t\tthis.days[d] = {\n\t\t\t'short': i18n.txt('weekday_short_n', d_n),\n\t\t\t'long': i18n.txt('weekday_n', d_n)\n\t\t};\n\t}\n\tif (opt.area) _fill('area', areas);\n\tif (opt.tag) _fill('tag', tags);\n}\n\n\nKonOpas.Prog.prototype.show_filter_sum = function(ls, f) {\n\tvar fs = _el('filter_sum'); if (!fs) return;\n\tvar cb = _el('q_clear');\n\tvar _a = function(txt, unset) {\n\t\tvar excl = {id:1}; if (unset) excl[unset] = 1;\n\t\treturn '<a href=\"' + KonOpas.Prog.hash(f, excl) + '\">' + txt + '</a>';\n\t}\n\tif (f.id_only) {\n\t\tfs.innerHTML = i18n.txt('filter_sum_id', { 'N':ls.length, 'TITLE':_a(ls[0].title), 'ID':_a(f.id) });\n\t\tif (cb) cb.disabled = false;\n\t} else {\n\t\tvar d = { 'N': f.n_listed,\n\t\t\t'ALL': !f.show_all || f.tag_str || f.area_str || f.query_str ? '' : _a(i18n.txt('all'), {}, 0),\n\t\t\t'TAG': f.tag_str ? _a(f.tag_str, 'tag') : '' };\n\t\tif (f.day && !f.show_all) {\n\t\t\td['DAY'] = i18n.txt('weekday_n', {'N': KonOpas.parse_date(f.day).getDay() });\n\t\t\tif (f.n_hidden) d['TIME'] = KonOpas.pretty_time(f.now, konopas);\n\t\t} else {\n\t\t\tif (f.n_hidden) d['LIVE'] = true;\n\t\t}\n\t\tif (f.area_str) d['AREA'] = _a(f.area_str, 'area');\n\t\tif (f.query_str) d['Q'] = _a(f.query_str, 'query');\n\t\tfs.innerHTML = i18n.txt('filter_sum', d);\n\t\tif (cb) cb.disabled = !f.area_str && !f.tag_str && !f.query_str;\n\t}\n}\n\n// hashchange -> read filters from url + store -> set filters in html + store -> list items\nKonOpas.Prog.prototype.show = function() {\n\tfunction _show_filters(f) {\n\t\tvar prev = _el('prog_filters').getElementsByClassName('selected');\n\t\tif (prev) for (var i = prev.length - 1; i >= 0; --i) {\n\t\t\tvar cl = prev[i].classList;\n\t\t\tif (cl.contains('popup-link')) prev[i].textContent = prev[i].getAttribute('data-title') || i18n.txt('More') + '…';\n\t\t\tcl.remove('selected');\n\t\t}\n\t\tfor (var k in f) {\n\t\t\tif (k == 'query') {\n\t\t\t\tvar q = _el(\"q\");\n\t\t\t\tif (q) {\n\t\t\t\t\tq.value = f.query;\n\t\t\t\t\tif (f.query) q.classList.add('selected');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tvar id = f[k];\n\t\t\t\tif (!id) id = 'all_' + k + 's';\n\t\t\t\telse if (id.match(/^[^a-zA-Z]/)) id = k[0] + id;\n\t\t\t\tvar el = _el(id);\n\t\t\t\tif (el) {\n\t\t\t\t\tel.classList.add('selected');\n\t\t\t\t\tif (el.parentNode.id.match(/\\d+$/)) {\n\t\t\t\t\t\tvar p = el.parentNode.parentNode.firstChild;\n\t\t\t\t\t\tp.classList.add('selected');\n\t\t\t\t\t\tp.textContent = el.textContent;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tfunction _filter(it) {\n\t\tif (this.area) {\n\t\t\tif (this.area instanceof RegExp) {\n\t\t\t\tif (!this.area.test(it.loc.join(';'))) return false;\n\t\t\t} else {\n\t\t\t\tif (!it.loc || (it.loc.indexOf(this.area) < 0)) return false;\n\t\t\t}\n\t\t}\n\t\tif (this.tag) {\n\t\t\tif (this.tag instanceof RegExp) {\n\t\t\t\tif (!this.tag.test(it.title)) return false;\n\t\t\t} else {\n\t\t\t\tif (!it.tags || (it.tags.indexOf(this.tag) < 0)) return false;\n\t\t\t}\n\t\t}\n\t\tif (this.query) {\n\t\t\tvar found = this.query.test(it.title)\n\t\t\t\t|| this.query.test(it.desc)\n\t\t\t\t|| (it.loc && this.query.test(it.loc.join('\\t')))\n\t\t\t\t|| (it.tags && this.query.test(it.tags.join('\\t')))\n\t\t\t\t|| (it.people && it.people.some(function(p){ return this.query.test(p.name); }, this));\n\t\t\tif (!found) return false;\n\t\t}\n\t\treturn true;\n\t}\n\tfunction _show_list(f, self) {\n\t\tf.area_str = f.area || '';\n\t\tif (f.area && _el(f.area)) {\n\t\t\tvar t = _el(f.area).getAttribute(\"data-regexp\");\n\t\t\tif (t) f.area = new RegExp(t);\n\t\t}\n\t\tf.tag_str = f.tag || '';\n\t\tif (f.tag && _el(f.tag)) {\n\t\t\tvar t = _el(f.tag).getAttribute(\"data-regexp\");\n\t\t\tif (t) f.tag = new RegExp(t);\n\t\t}\n\t\tf.query_str = f.query || '';\n\t\tif (f.query) f.query = KonOpas.glob_to_re(f.query);\n\t\tf.id_only = !!f.id;\n\t\tif (f.id_only) for (var i in f) if ((i != 'id') && (i != 'id_only') && f[i]) {\n\t\t\tf.id_only = false;\n\t\t\tbreak;\n\t\t}\n\t\tvar ls = self.list.filter(f.id_only ? function(it){ return it.id == f.id; } : _filter, f);\n\t\tif (f.id && ls.every(function(p) { return p.id != f.id; })) {\n\t\t\tf.id = '';\n\t\t\tif (KonOpas.Prog.set_filters(f)) return;\n\t\t}\n\t\tf.hide_ended = true;\n\t\tf.prog_view = true;\n\t\tKonOpas.Item.show_list(ls, f);\n\t}\n\n\tvar f = KonOpas.Prog.get_filters();\n\tif (KonOpas.Prog.set_filters(f)) return;\n\t_show_filters(f);\n\tfor (var k in f) {\n\t\tif (!k || !f[k] || (f[k] == 'all_' + k + 's')) { delete f[k]; continue; }\n\t}\n\t_show_list(f, this);\n}\nKonOpas.Server = function(id, stars, opt) {\n\tthis.id = id;\n\tthis.stars = stars;\n\n\topt = opt || {};\n\tthis.host = opt.host ||  'https://konopas-server.appspot.com';\n\tthis.el_id = opt.el_id || 'server_connect';\n\tthis.err_el_id = opt.err_el_id || 'server_error';\n\ttry { this.store = localStorage; } catch (e) { this.store = new KonOpas.VarStore(); }\n\n\tthis.connected = false;\n\tthis.token = this.store.getItem('konopas.token') || false;\n\tthis.ical = this.store.getItem('konopas.'+this.id+'.ical_link') || false;\n\tthis.prog_data = {};\n\tthis.prog_server_mtime = 0;\n\tthis.el = document.getElementById(this.el_id);\n\tthis.err_el = false;\n\n\tthis.disconnect();\n\tif (this.stars) this.stars.server = this;\n\tif (this.el && this.id) this.exec('info');\n\telse _log(\"server init failed\", 'warn');\n\n\tvar m = /#server_error=(.+)/.exec(window.location.hash);\n\tif (m) this.error(decodeURIComponent(m[1].replace(/\\+/g, ' ')), window.location.href);\n}\n\nKonOpas.Server.prototype.disconnect = function() {\n\tthis.connected = false;\n\tif (this.el) this.el.innerHTML = '<div id=\"server_info\">' + i18n.txt('Not connected') + '</div>';\n\tdocument.body.classList.remove('logged-in');\n}\n\nKonOpas.Server.prototype.logout = function(ev) {\n\t_log('server logout');\n\tthis.exec('/logout');\n\t(ev || window.event).preventDefault();\n}\n\nKonOpas.Server.prototype.error = function(msg, url) {\n\t_log('server error ' + msg + ', url: ' + url, 'error');\n\tif (msg =='') {\n\t\tvar cmd = url.replace(this.host, '').replace('/' + this.id + '/', '');\n\t\tmsg = i18n.txt('server_cmd_fail', {'CMD':'<code>'+cmd+'</code>'});\n\t}\n\tif (!this.err_el) {\n\t\tvar el = document.createElement('div');\n\t\tel.id = this.err_el_id;\n\t\tel.title = i18n.txt('Click to close');\n\t\tel.onclick = function(ev) { this.err_el.style.display = 'none'; }.bind(this);\n\t\tdocument.body.appendChild(el);\n\t\tthis.err_el = el;\n\t}\n\tthis.err_el.innerHTML = '<div>' + i18n.txt('Server error') + ': <b>' + msg + '</b></div>';\n\tthis.err_el.style.display = 'block';\n\treturn true;\n}\n\nKonOpas.Server.prototype.onmessage = function(ev) {\n\tev = ev || window.event;\n\tif (ev.origin != this.host) {\n\t\t_log('Got an unexpected message from ' + ev.origin, 'error');\n\t\t_log(ev);\n\t\treturn;\n\t}\n\tvar self = this;\n\tJSON.parse(ev.data, function(k, v) {\n\t\tswitch (k) {\n\t\t\tcase 'ok':    self.cb_ok(v);      break;\n\t\t\tcase 'fail':  self.error('', v);  break;\n\t\t}\n\t});\n}\n\n\n\n// ------------------------------------------------------------------------------------------------ prog\n\nKonOpas.Server.prototype.prog_mtime = function() {\n\tvar mtime = this.prog_server_mtime;\n\tfor (var id in this.prog_data) {\n\t\tif (this.prog_data[id][1] > mtime) mtime = this.prog_data[id][1];\n\t}\n\treturn mtime;\n}\n\nKonOpas.Server.prototype.add_prog = function(id, add_star) {\n\tif (id instanceof Array) id = id.join(',');\n\t_log('server add_prog \"' + id + '\" ' + (add_star ? '1' : '0'));\n\tvar t = this.prog_mtime();\n\tthis.exec('prog'\n\t\t+ (add_star ? '?add=' : '?rm=') + id\n\t\t+ (t ? '&t=' + t : ''));\n}\n\nKonOpas.Server.prototype.set_prog = function(star_list) {\n\t_log('server set_prog \"' + star_list);\n\tvar t = this.prog_mtime();\n\tthis.exec('prog'\n\t\t+ '?set=' + star_list.join(',')\n\t\t+ (t ? '&t=' + t : ''));\n}\n\n\n\n// ------------------------------------------------------------------------------------------------ ical\n\nKonOpas.Server.prototype.show_ical_link = function(p_el) {\n\tvar html = '';\n\tif (!this.connected) {\n\t\thtml = i18n.txt('ical_login');\n\t} else if (this.ical) {\n\t\tif (typeof this.ical == 'string') {\n\t\t\thtml = i18n.txt('ical_link') + '<br><a href=\"' + this.ical + '\">' + this.ical + '</a>'\n\t\t\t\t+ '<br><span class=\"hint\">' + i18n.txt('ical_hint') + '</span>';\n\t\t} else {\n\t\t\thtml = i18n.txt('ical_make', {'A_TAG':'<a id=\"ical_link\" class=\"js-link\">'});\n\t\t}\n\t}\n\tif (p_el) p_el.innerHTML += '<p id=\"ical_text\">' + html;\n\telse {\n\t\tvar i_el = document.getElementById('ical_text');\n\t\tif (i_el) i_el.innerHTML = html;\n\t}\n\tvar a = document.getElementById('ical_link');\n\tif (a) {\n\t\ta.onclick = function() { this.exec('ical_link'); }.bind(this);\n\t}\n}\n\n\n\n// ------------------------------------------------------------------------------------------------ exec\n\nKonOpas.Server.prototype.url = function(cmd) {\n\tif (this.token) cmd += (cmd.indexOf('?') != -1 ? '&' : '?') + 'k=' + encodeURIComponent(this.token);\n\treturn this.host + (cmd[0] == '/' ? '' : '/' + this.id + '/') + cmd;\n}\n\n// based on https://github.com/IntoMethod/Lightweight-JSONP/blob/master/jsonp.js\nKonOpas.Server.prototype.exec = function(cmd) {\n\tvar script = document.createElement('script'),\n\t\tdone = false,\n\t\turl = this.url(cmd);\n\tscript.src = url;\n\tscript.async = true;\n\tscript.onerror = function(ev) { this.error('', (ev || window.event).target.src); }.bind(this);\n\n\tscript.onload = script.onreadystatechange = function() {\n\t\tif (!done && (!this.readyState || this.readyState === \"loaded\" || this.readyState === \"complete\")) {\n\t\t\tdone = true;\n\t\t\tscript.onload = script.onreadystatechange = null;\n\t\t\tif (script && script.parentNode) {\n\t\t\t\tscript.parentNode.removeChild(script);\n\t\t\t}\n\t\t}\n\t};\n\tdocument.getElementsByTagName('head')[0].appendChild(script);\n}\n\n\n\n// ------------------------------------------------------------------------------------------------ cb ok/fail\n\n// callback for successful logout, prog\nKonOpas.Server.prototype.cb_ok = function(v) {\n\tvar m = /^(?:https?:\\/\\/[^\\/]+)?\\/?([^?\\/]*)(?:\\/([^?]*))(?:\\?(.*))?/.exec(v);\n\tvar cmd = m[2] || '';\n\tvar query = m[3] || '';\n\tswitch (cmd) {\n\t\tcase 'logout':\n\t\t\tthis.disconnect();\n\t\t\tthis.token = false;\n\t\t\tthis.store.setItem('konopas.token', '');\n\t\t\tthis.prog_data = {};\n\t\t\tthis.prog_server_mtime = 0;\n\t\t\tif (this.stars) {\n\t\t\t\tthis.stars.data = {};\n\t\t\t\tthis.stars.write();\n\t\t\t\tkonopas.set_view();\n\t\t\t}\n\t\t\tthis.exec('info');\n\t\t\t_log(\"server ok (logout): \" + JSON.stringify(v));\n\t\t\tbreak;\n\n\t\tcase 'prog':\n\t\t\tvar t = /&server_mtime=(\\d+)/.exec(query);\n\t\t\tif (t) this.prog_server_mtime = parseInt(t[1], 10);\n\t\t\t_log(\"server ok (prog): \" + JSON.stringify(v));\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\t_log(\"server ok (???): \" + JSON.stringify(v), 'warn');\n\t}\n}\n\n// callback for reporting server errors\nKonOpas.Server.prototype.cb_fail = function(v) {\n\tthis.error(v.msg, v.url);\n}\n\n\n\n// ------------------------------------------------------------------------------------------------ callback\n\nKonOpas.Server.prototype.cb_info = function(v) {\n\t_log(\"server info: \" + JSON.stringify(v));\n\tthis.connected = [v.name, v.email];\n\tthis.el.innerHTML = '<div id=\"server_info\">'\n\t                  + '<a id=\"server_logout\" href=\"' + this.url(v.logout) + '\">' + i18n.txt('Logout') + '</a> '\n\t                  + '<span id=\"server_user\" title=\"' + ((v.name != v.email) ? v.email : '') + '\">' + v.name.replace(/@.*/, '')\n\t                  + '</span></div>';\n\tif (v.ical) {\n\t\tthis.ical = this.ical || true;\n\t\tthis.show_ical_link(false);\n\t}\n\tdocument.getElementById('server_logout').onclick = this.logout.bind(this);\n\tdocument.body.classList.add('logged-in');\n\tif (typeof jsErrLog == 'object') jsErrLog.info = v.name.replace(/[ @].*/, '');\n}\n\nKonOpas.Server.prototype.cb_token = function(token) {\n\t_log(\"server token: \" + token);\n\tthis.token = token;\n\tthis.store.setItem('konopas.token', token);\n}\n\nKonOpas.Server.prototype.cb_login = function(v) {\n\t_log(\"server login: \" + JSON.stringify(v));\n\tvar links = [];\n\tfor (var cmd in v) {\n\t\tlinks.push('<a href=\"' + this.url(cmd) + '\">' + v[cmd] + '</a>');\n\t}\n\tthis.el.innerHTML = '<div id=\"login-links\">'\n\t\t+ '\\n&raquo; <span class=\"popup-link\" id=\"login-popup-link\">' + i18n.txt('Login to sync your data') + '</span>\\n'\n\t\t+ '<div class=\"popup\" id=\"login-popup\">' + i18n.txt('login_why')\n\t\t+ \"\\n<ul>\\n<li>\" + links.join(\"\\n<li>\")\n\t\t+ \"\\n</ul></div></div>\";\n\t_el('login-popup-link').onclick = KonOpas.popup_open;\n}\n\nKonOpas.Server.prototype.cb_my_prog = function(v) {\n\t_log(\"server my_prog: \" + JSON.stringify(v));\n\tthis.prog_data = v.prog;\n\tif (v.t0) for (var id in this.prog_data) { this.prog_data[id][1] += v.t0; }\n\tif (this.stars) this.stars.sync(this.prog_data);\n\telse _log(\"Server.stars required for prog sync\", 'warn');\n}\n\nKonOpas.Server.prototype.cb_my_votes = function(v) { /* obsolete */ }\nKonOpas.Server.prototype.cb_pub_data = function(p) { /* obsolete */ }\nKonOpas.Server.prototype.cb_show_comments = function(id, c) { /* obsolete */ }\n\nKonOpas.Server.prototype.cb_ical_link = function(url) {\n\tthis.ical = url;\n\tthis.store.setItem('konopas.'+this.id+'.ical_link', url);\n\tthis.show_ical_link(false);\n}\nKonOpas.Stars = function(id, opt) {\n\topt = opt || {};\n\tthis.name = 'konopas.' + id + '.stars';\n\ttry { this.store = localStorage || sessionStorage || (new KonOpas.VarStore()); }\n\tcatch (e) { this.store = new KonOpas.VarStore(); }\n\tthis.tag = opt.tag || 'has_star';\n\tthis.server = false;\n\tthis.data = this.read();\n}\n\nKonOpas.Stars.prototype.read = function() {\n\treturn JSON.parse(this.store && this.store.getItem(this.name) || '{}');\n}\n\nKonOpas.Stars.prototype.write = function() {\n\ttry {\n\t\tif (this.store) this.store.setItem(this.name, JSON.stringify(this.data));\n\t} catch (e) {\n\t\tif ((e.code != DOMException.QUOTA_EXCEEDED_ERR) || (this.store.length != 0)) { throw e; }\n\t}\n}\n\nKonOpas.Stars.prototype.list = function() {\n\tvar list = [];\n\tif (this.data) for (var id in this.data) {\n\t\tif ((this.data[id].length == 2) && this.data[id][0]) list.push(id);\n\t}\n\treturn list;\n}\n\nKonOpas.Stars.prototype.add = function(star_list, mtime) {\n\tmtime = mtime || Math.floor(Date.now()/1000);\n\tstar_list.forEach(function(id) { this.data[id] = [1, mtime]; }, this);\n\n\tthis.write();\n\tif (this.server) this.server.set_prog(this.list());\n}\n\nKonOpas.Stars.prototype.set = function(star_list) {\n\tvar mtime = Math.floor(Date.now()/1000);\n\tif (this.data) for (var id in this.data) {\n\t\tthis.data[id] = [0, mtime];\n\t}\n\tthis.add(star_list, mtime);\n}\n\nKonOpas.Stars.prototype.toggle = function(el, id) {\n\tvar add_star = !el.classList.contains(this.tag);\n\tvar mtime = Math.floor(Date.now()/1000);\n\n\tthis.data[id] = [add_star ? 1 : 0, mtime];\n\tthis.write();\n\tif (this.server) this.server.add_prog(id, add_star);\n\n\tif (add_star) el.classList.add(this.tag);\n\telse          el.classList.remove(this.tag);\n}\n\nKonOpas.Stars.prototype.sync = function(new_data) {\n\tvar local_mod = [], redraw = false;\n\tfor (var id in new_data) {\n\t\tif (new_data[id].length != 2) {\n\t\t\t_log('Stars.sync: invalid input ' + id + ': ' + JSON.stringify(new_data[id]), 'warn');\n\t\t\tcontinue;\n\t\t}\n\t\tif (!(id in this.data) || (new_data[id][1] > this.data[id][1])) {\n\t\t\tlocal_mod.push(id);\n\t\t\tif (!(id in this.data) || (new_data[id][0] != this.data[id][0])) redraw = true;\n\t\t\tthis.data[id] = new_data[id];\n\t\t}\n\t}\n\tif (local_mod.length) {\n\t\t_log('Stars.sync: local changes: ' + local_mod + (redraw ? ' -> redraw' : ''));\n\t\tthis.write();\n\t\tif (redraw) konopas.set_view();\n\t}\n\n\tif (this.server) {\n\t\tvar server_add = [], server_rm = [];\n\t\tfor (var id in this.data) {\n\t\t\tif (!(id in new_data) || (new_data[id][1] < this.data[id][1])) {\n\t\t\t\tif (this.data[id][0]) server_add.push(id);\n\t\t\t\telse                  server_rm.push(id);\n\t\t\t}\n\t\t}\n\t\tif (server_add.length) {\n\t\t\t_log('Stars.sync: server add: ' + server_add);\n\t\t\tthis.server.add_prog(server_add, true);\n\t\t}\n\t\tif (server_rm.length) {\n\t\t\t_log('Stars.sync: server rm: ' + server_rm);\n\t\t\tthis.server.add_prog(server_rm, false);\n\t\t}\n\n\t\tif (!local_mod.length && !server_add.length && !server_rm.length) {\n\t\t\t_log('Stars.sync: no changes');\n\t\t}\n\t}\n}\n\nKonOpas.Stars.prototype.show = function() {\n\tvar view = _el(\"star_data\"),\n\t\thash = window.location.hash.substr(6),\n\t    set_raw = (hash && (hash.substr(0,4) == 'set:')) ? hash.substr(4).split(',') : [],\n\t    set = konopas.program.list.filter(function(p) { return (set_raw.indexOf(p.id) >= 0); }).map(function(p) { return p.id; }),\n\t    set_len = set.length,\n\t    html = '',\n\t    star_list = this.list(),\n\t    stars_len = star_list.length;\n\tif (konopas.store.limit && (!this.server || !this.server.connected)) {\n\t\thtml = '<p>' + i18n.txt('star_no_memory', {'WHY': konopas.store.limit, 'SERVER': !!this.server});\n\t}\n\tif (!stars_len && !set_len) {\n\t\t_el(\"prog_ls\").innerHTML = '';\n\t\tview.innerHTML = html + '<p>' + i18n.txt('star_hint');\n\t\treturn;\n\t}\n\tdocument.body.classList.remove(\"show_set\");\n\tset.sort();\n\tstar_list.sort();\n\tvar set_link = '#star/set:' + star_list.join(',');\n\tif (set_len) {\n\t\tif (KonOpas.arrays_equal(set, star_list)) {\n\t\t\thtml += '<p>' + i18n.txt('star_export_this', { 'THIS':set_link }) + '<p>' +\n\t\t\t\ti18n.txt('star_export_share', {\n\t\t\t\t\t'SHORT': KonOpas.link_to_short_url(location.href),\n\t\t\t\t\t'QR': KonOpas.link_to_qr_code(location.href)\n\t\t\t\t});\n\t\t} else {\n\t\t\tdocument.body.classList.add(\"show_set\");\n\t\t\tvar n_same = KonOpas.array_overlap(set, star_list);\n\t\t\tvar n_new = set_len - n_same;\n\t\t\tvar n_bad = set_raw.length - set_len;\n\t\t\thtml += '<p>' + i18n.txt('star_import_this', {'THIS':location.href})\n\t\t\t\t+ '<p>' + i18n.txt('star_import_diff', { 'PREV':stars_len, 'NEW':n_new, 'SAME':n_same });\n\t\t\tif (n_bad) html += ' ' + i18n.txt('star_import_bad', {'BAD':n_bad});\n\t\t\tif (!stars_len || (n_same != stars_len)) {\n\t\t\t\thtml += '<p>&raquo; <a href=\"#star\" id=\"star_set_set\">' + i18n.txt('star_set') + '</a>';\n\t\t\t}\n\t\t\tif (stars_len) {\n\t\t\t\tif (n_same != stars_len) {\n\t\t\t\t\tvar d = [];\n\t\t\t\t\tif (n_new) d.push(i18n.txt('add_n', {'N':n_new}));\n\t\t\t\t\td.push(i18n.txt('discard_n', {'N':stars_len - n_same}));\n\t\t\t\t\thtml += ' (' + d.join(', ') + ')';\n\t\t\t\t}\n\t\t\t\tif (n_new) html += '<p>&raquo; <a href=\"#star\" id=\"star_set_add\">' + i18n.txt('star_add', {'N':n_new}) + '</a>';\n\t\t\t}\n\t\t}\n\t} else {\n\t\thtml += '<p id=\"star_links\">&raquo; ' + i18n.txt('star_export_link', { 'URL':set_link, 'N':stars_len });\n\t}\n\tview.innerHTML = html;\n\tvar el_set = _el('star_set_set'); if (el_set) el_set.onclick = function() { konopas.stars.set(set); return true; };\n\tvar el_add = _el('star_set_add'); if (el_add) el_add.onclick = function() { konopas.stars.add(set); return true; };\n\tif (this.server) this.server.show_ical_link(view);\n\tvar ls = konopas.program.list.filter(function(it) { return (star_list.indexOf(it.id) >= 0) || (set.indexOf(it.id) >= 0); });\n\tKonOpas.Item.show_list(ls, {hide_ended:true});\n\tif (set_len) for (var i = 0; i < set_len; ++i) {\n\t\tvar el = _el('s' + set[i]);\n\t\tif (el) el.classList.add(\"in_set\");\n\t}\n}\nif (typeof i18n == 'undefined') i18n = {};\ni18n.txt = function(key){ return key; };\ni18n.translate_html = function(map, a) {\n\tvar list = document.querySelectorAll('['+a+']');\n\tfor (var i = 0, node; node = list[i]; ++i) {\n\t\tvar key = node.getAttribute(a) || node.textContent.trim();\n\t\tif (key in map) {\n\t\t\tvar data = node.getAttribute(a + '-var');\n\t\t\tvar attr = node.getAttribute(a + '-attr');\n\t\t\tvar str = map[key](data && JSON.parse('{' + data.replace(/[^,:]+/g, '\"$&\"') + '}'));\n\t\t\tif (attr) node.setAttribute(attr, str);\n\t\t\telse node.innerHTML = str;\n\t\t}\n\t}\n}\n\nfunction _log(msg, lvl) {\n\tif (window.console) switch (lvl) {\n\t\tcase 'error': console.error(msg); break;\n\t\tcase 'warn':  console.warn(msg); break;\n\t\tdefault:      console.log(msg);\n\t}\n}\n\nfunction _el(id) { return id && document.getElementById(id); }\n\nfunction _new_elem(tag, cl, text, hide) {\n\tvar e = document.createElement(tag);\n\tif (cl) e.className = cl;\n\tif (text) e.textContent = text;\n\tif (hide) e.style.display = 'none';\n\treturn e;\n}\n\nKonOpas.link_to_short_url = function(url) {\n\tvar u = encodeURIComponent(url.replace(/^http:\\/\\//, ''));\n\treturn 'http://is.gd/create.php?url=' + u;\n}\nKonOpas.link_to_qr_code = function(url) {\n\tvar u = encodeURIComponent(url.replace(/^http:\\/\\//, ''));\n\treturn 'http://chart.apis.google.com/chart?cht=qr&chs=350x350&chl=' + u;\n}\n\nKonOpas.hash_encode = function(s) { return encodeURIComponent(s).replace(/%20/g, '+'); }\nKonOpas.hash_decode = function(s) { return decodeURIComponent(s.replace(/\\+/g, '%20')); }\n\nKonOpas.glob_to_re = function(pat) {\n\tvar re_re = new RegExp('[.\\\\\\\\+*?\\\\[\\\\^\\\\]$(){}=!<>|:\\\\/-]', 'g');\n\tpat = pat.replace(re_re, '\\\\$&').replace(/\\\\\\*/g, '.*').replace(/\\\\\\?/g, '.');\n\tvar terms = pat.match(/\"[^\"]*\"|'[^']*'|\\S+/g).map(function(el){\n\t\treturn '\\\\b' + el.replace(/^(['\"])(.*)\\1$/, '$2\\\\b');\n\t});\n\treturn new RegExp(terms.join('|'), 'i');\n}\n\n\n// ------------------------------------------------------------------------------------------------ storage\n\nKonOpas.Store = function(id) {\n\ttry {\n\t\tsessionStorage.setItem('konopas.test_var', '1');\n\t\tsessionStorage.removeItem('konopas.test_var', '1');\n\t\tthis.get = function(k) {\n\t\t\tvar v = sessionStorage.getItem('konopas.' + id + '.' + k);\n\t\t\treturn v ? JSON.parse(v) : v;\n\t\t}\n\t\tthis.set = function(k, v) {\n\t\t\tsessionStorage.setItem('konopas.' + id + '.' + k, JSON.stringify(v));\n\t\t}\n\t\tthis.limit = '';\n\t} catch (e) {\n\t\tvar data = {};\n\t\tthis.get = function(k) { return data[k]; };\n\t\tthis.set = function(k, v) { data[k] = v; };\n\t\tthis.limit = (e.name == 'SecurityError') ? 'FFcookies'\n\t\t\t\t   : ((e.code === DOMException.QUOTA_EXCEEDED_ERR) && (sessionStorage.length === 0)) ? 'IOSprivate'\n\t\t\t\t   : '?';\n\t}\n}\n\nKonOpas.VarStore = function() {\n\tvar data = {};\n\tthis.getItem = function(k) { return data[k]; };\n\tthis.setItem = function(k, v) { data[k] = v; };\n}\n\n\n// ------------------------------------------------------------------------------------------------ string generation\n\nKonOpas.clean_name = function(p, span_parts) {\n\tvar fn = '', ln = '';\n\tswitch (p.name.length) {\n\t\tcase 1:\n\t\t\tln = p.name[0];\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\tif (p.name[1]) {\n\t\t\t\tfn = p.name[0];\n\t\t\t\tln = p.name[1];\n\t\t\t} else {\n\t\t\t\tln = p.name[0];\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\tfn = p.name[2] + ' ' + p.name[0];\n\t\t\tln = p.name[1];\n\t\t\tbreak;\n\t\tcase 4:\n\t\t\tfn = p.name[2] + ' ' + p.name[0];\n\t\t\tln = p.name[1] + (p.name[3] ? ', ' + p.name[3] : '');\n\t\t\tbreak;\n\t}\n\treturn span_parts\n\t\t? '<span class=\"fn\">' + fn.trim() + '</span> <span class=\"ln\">' + ln.trim() + '</span>'\n\t\t: (fn + ' ' + ln).trim();\n}\n\nKonOpas.clean_links = function(p) {\n\tvar ok = false, o = {};\n\tif (p && ('links' in p)) {\n\t\tif (p.links.img || p.links.photo) {\n\t\t\tvar img = (p.links.img || p.links.photo).trim();\n\t\t\tif (/^www/.test(img)) img = 'http://' + img;\n\t\t\tif (/:\\/\\//.test(img)) { o['img'] = { 'tgt': img }; ok = true; }\n\t\t}\n\t\tif (p.links.url) {\n\t\t\tvar url = p.links.url.trim();\n\t\t\tif (!/:\\/\\//.test(url)) url = 'http://' + url;\n\t\t\to['URL'] = { 'tgt': url, 'txt': url.replace(/^https?:\\/\\//, '') };\n\t\t\tok = true;\n\t\t}\n\t\tif (p.links.fb) {\n\t\t\tvar fb = p.links.fb.trim().replace(/^(https?:\\/\\/)?(www\\.)?facebook.com(\\/#!)?\\//, '');\n\t\t\to['Facebook'] = { 'txt': fb };\n\t\t\tif (/[^a-zA-Z0-9.]/.test(fb) && !/^pages\\//.test(fb)) fb = 'search.php?q=' + encodeURI(fb).replace(/%20/g, '+');\n\t\t\to['Facebook']['tgt'] = 'https://www.facebook.com/' + fb;\n\t\t\tok = true;\n\t\t}\n\t\tif (p.links.twitter) {\n\t\t\tvar tw = p.links.twitter.trim().replace(/[@＠﹫]/g, '').replace(/^(https?:\\/\\/)?(www\\.)?twitter.com(\\/#!)?\\//, '');\n\t\t\to['Twitter'] = { 'txt': '@' + tw };\n\t\t\tif (/[^a-zA-Z0-9_]/.test(tw)) tw = 'search/users?q=' + encodeURI(tw).replace(/%20/g, '+');\n\t\t\to['Twitter']['tgt'] = 'https://www.twitter.com/' + tw;\n\t\t\tok = true;\n\t\t}\n\t}\n\treturn ok ? o : false;\n}\n\n\n// ------------------------------------------------------------------------------------------------ array comparison\n\nKonOpas.arrays_equal = function(a, b) {\n\tif (!a || !b) return false;\n\tif (a.length != b.length) return false;\n\tfor (var i = 0; i < a.length; ++i) {\n\t\tif (a[i] != b[i]) return false;\n\t}\n\treturn true;\n}\n\nKonOpas.array_overlap = function(a, b) {\n\tif (!a || !b) return 0;\n\tif (a.length > b.length) return KonOpas.array_overlap(b, a);\n\tvar n = 0, i, j;\n\tfor (i = 0; i < a.length; ++i) {\n\t\tfor (j = 0; j < b.length; ++j) if (a[i] == b[j]) { ++n; break; }\n\t}\n\treturn n;\n}\n\n\n// ------------------------------------------------------------------------------------------------ DOM manipulation\n\nKonOpas.popup_open = function(ev) {\n\tev = ev || window.event;\n\tif (ev.which != 1) return;\n\tvar src_el = ev.target, pop_el = src_el.nextElementSibling;\n\tif (!pop_el || !pop_el.classList.contains('popup')) {\n\t\tif (src_el.href && /\\.(gif|jpe?g|png)$/i.test(src_el.href)) {\n\t\t\tpop_el = _new_elem('img', 'popup');\n\t\t\tpop_el.src = src_el.href;\n\t\t\tsrc_el.parentNode.insertBefore(pop_el, src_el.nextSibling);\n\t\t} else return;\n\t}\n\tvar wrap_el = _new_elem('div', 'popup-wrap');\n\twrap_el.onclick = function() {\n\t\tpop_el.parentNode.removeChild(pop_el);\n\t\twrap_el.parentNode.removeChild(wrap_el);\n\t\tsrc_el.parentNode.insertBefore(pop_el, src_el.nextSibling);\n\t};\n\tvar pop_title = pop_el.getAttribute('data-title') || '';\n\tif (pop_title) wrap_el.appendChild(_new_elem('div', 'popup-title', pop_title));\n\tpop_el.parentNode.removeChild(pop_el);\n\twrap_el.appendChild(pop_el);\n\tdocument.body.appendChild(wrap_el);\n\tif (src_el.href) ev.preventDefault();\n}\n\nKonOpas.toggle_collapse = function(ev) {\n\tev = ev || window.event;\n\tvar title = ev.target, body = title && title.nextElementSibling;\n\tif (!body) return;\n\tif (window.getComputedStyle(body).getPropertyValue('display') == 'none') {\n\t\ttitle.classList.remove('collapse');\n\t\ttitle.classList.add('collapse-open');\n\t} else {\n\t\ttitle.classList.add('collapse');\n\t\ttitle.classList.remove('collapse-open');\n\t}\n}\n\n\n// ------------------------------------------------------------------------------------------------ time & date\n\nKonOpas.pretty_time = function(t, opt) {\n\tfunction pre0(n) { return (n < 10 ? '0' : '') + n; }\n\tfunction _pretty_time(h, m) {\n\t\tif (opt.time_show_am_pm) {\n\t\t\tvar h12 = h % 12; if (h12 == 0) h12 = 12;\n\t\t\tvar m_str = ((m == 0) && opt.abbrev_00_minutes ) ? '' : ':' + pre0(m);\n\t\t\treturn h12 + m_str + (h < 12 ? 'am' : 'pm');\n\t\t} else {\n\t\t\treturn pre0(h) + ':' + pre0(m);\n\t\t}\n\t}\n\topt = opt || {};\n\tif (t instanceof Date) {\n\t\treturn _pretty_time(t.getHours(), t.getMinutes());\n\t} else if (typeof t == 'string' || t instanceof String) {\n\t\tif (opt.time_show_am_pm) {\n\t\t\tvar a = t.split(':'); // hh:mm\n\t\t\treturn _pretty_time(parseInt(a[0], 10), parseInt(a[1], 10));\n\t\t} else return t;\n\t} else return '';\n}\n\nKonOpas.pretty_time_diff = function(t) {\n\tvar d = (Date.now() - t) / 1e3,\n\t    a = Math.abs(d),\n\t    s = [1, 60, 60, 24, 7, 4.333, 12, 1e9];\n\tif (a < 20) return i18n.txt('just now');\n\tfor (var i = 0, l = s.length; i < l; ++i) {\n\t\tif ((a /= s[i]) < 2) return i18n.txt('time_diff', { 'T':~~(a *= s[i]), 'T_UNIT':i-1, 'T_PAST':d>0 });\n\t}\n}\n\nKonOpas.parse_date = function(day_str) {\n\tif (!day_str) return false;\n\tvar a = day_str.match(/(\\d+)/g); if (!a || (a.length < 3)) return false;\n\tvar y = parseInt(a[0], 10), m = parseInt(a[1], 10), d = parseInt(a[2], 10);\n\tif (!y || !m || !d) return false;\n\treturn new Date(y, m - 1, d, 12);\n}\n\nKonOpas.data_date = function(d) {\n\tfunction pre0(n) { return (n < 10 ? '0' : '') + n; }\n\tvar t = (d instanceof Date) ? d : KonOpas.parse_date(d);\n\treturn t.getFullYear() + '-' + pre0(t.getMonth() + 1) + '-' + pre0(t.getDate());\n}\n\nKonOpas.pretty_date = function(d, opt) {\n\topt = opt || {};\n\tvar o = { weekday: \"long\", month: \"long\", day: \"numeric\" },\n\t    t = (d instanceof Date) ? d : KonOpas.parse_date(d);\n\tif (!t) return d;\n\tif (Math.abs(t - Date.now()) > 1000*3600*24*60) o.year = \"numeric\";\n\tvar s = t.toLocaleDateString(opt.lc, o);\n\treturn s.charAt(0).toUpperCase() + s.slice(1);\n}\n\nKonOpas.time_sum = function(t0_str, m_str) {\n\tvar t = 60 * t0_str.substr(0,2) + 1 * t0_str.substr(3,2) + 1 * m_str,\n\t    h = (t / 60) >> 0,\n\t    m = t - 60 * h;\n\treturn '' + (h % 24) + ':' + (m<10?'0':'') + m;\n}\n"]}